; generated by ARM C/C++ Compiler, 4.1 [Build 481]
; commandline ArmCC [--debug -c --asm --interleave -o.\rvmdk\listview_setsort.o --depend=.\rvmdk\listview_setsort.d --cpu=Cortex-M3 --apcs=interwork -O1 -Otime -I. -I..\BSP -I..\..\..\..\..\uCOS-II\Ports\arm-cortex-m3\Generic\RealView -I..\..\..\..\..\uCOS-II\Source -I..\..\..\..\..\CPU\ST\STM32\inc -I..\..\..\..\..\uC-CPU -I..\..\..\..\..\uC-CPU\Arm-Cortex-M3\RealView -I..\..\..\..\..\uC-LIB -I..\..\..\..\..\uC-Probe\Target\Plugins\uCOS-II -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\Source -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Ports\ST\STM32 -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Source -I..\..\..\..\..\User\inc -I..\..\..\..\..\uCGUI\Config -I..\..\..\..\..\uCGUI\GUIDemo -I..\..\..\..\..\uCGUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\AntiAlias -I..\..\..\..\..\uCGUI\GUI\ConvertColor -I..\..\..\..\..\uCGUI\GUI\ConvertMono -I..\..\..\..\..\uCGUI\GUI\Core -I..\..\..\..\..\uCGUI\GUI\Font -I..\..\..\..\..\uCGUI\GUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\MemDev -I..\..\..\..\..\uCGUI\GUI\MultiLayer -I..\..\..\..\..\uCGUI\GUI\Widget -I..\..\..\..\..\uCGUI\GUI\WM -Id:\Keil-stm32\ARM\INC -Id:\Keil-stm32\ARM\INC\ST\STM32F10x -D__MICROLIB --omf_browse=.\rvmdk\listview_setsort.crf ..\..\..\..\..\uCGUI\GUI\Widget\LISTVIEW_SetSort.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  _Free PROC
;;;52     */
;;;53     static void _Free(WM_HMEM hObj) {
000000  b510              PUSH     {r4,lr}
000002  4604              MOV      r4,r0
;;;54       LISTVIEW_SORT * pSort;
;;;55       pSort = (LISTVIEW_SORT *)GUI_ALLOC_h2p(hObj);
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       GUI_ALLOC_h2p
;;;56       GUI_ALLOC_Free(pSort->hSortArray);
00000a  f9b00000          LDRSH    r0,[r0,#0]
00000e  f7fffffe          BL       GUI_ALLOC_Free
;;;57       GUI_ALLOC_Free(hObj);
000012  4620              MOV      r0,r4
000014  e8bd4010          POP      {r4,lr}
000018  f7ffbffe          B.W      GUI_ALLOC_Free
;;;58     }
;;;59     
                          ENDP

                  _GetSelUnsorted PROC
;;;63     */
;;;64     static int _GetSelUnsorted(LISTVIEW_Obj * pObj) {
00001c  b570              PUSH     {r4-r6,lr}
00001e  4604              MOV      r4,r0
;;;65       int r;
;;;66       if ((LISTVIEW__GetSel(pObj) >= 0) && (pObj->hSort)) {
000020  4620              MOV      r0,r4
000022  f7fffffe          BL       LISTVIEW__GetSel
000026  2800              CMP      r0,#0
000028  db16              BLT      |L1.88|
00002a  f9b40092          LDRSH    r0,[r4,#0x92]
00002e  b198              CBZ      r0,|L1.88|
;;;67         LISTVIEW_SORT * pSort;
;;;68         pSort = (LISTVIEW_SORT *)GUI_ALLOC_h2p(pObj->hSort);
000030  f7fffffe          BL       GUI_ALLOC_h2p
;;;69         if (!pSort->SortArrayNumItems) {
000034  8841              LDRH     r1,[r0,#2]
000036  b151              CBZ      r1,|L1.78|
;;;70           r = LISTVIEW__GetSel(pObj);
;;;71         } else {
;;;72           SORT_TYPE * paSortArray;
;;;73           paSortArray = (SORT_TYPE *)GUI_ALLOC_h2p(pSort->hSortArray);
000038  f9b00000          LDRSH    r0,[r0,#0]
00003c  f7fffffe          BL       GUI_ALLOC_h2p
000040  4605              MOV      r5,r0
;;;74           r = *(paSortArray + LISTVIEW__GetSel(pObj));
000042  4620              MOV      r0,r4
000044  f7fffffe          BL       LISTVIEW__GetSel
000048  f8350010          LDRH     r0,[r5,r0,LSL #1]
;;;75         }
;;;76       } else {
;;;77         r = LISTVIEW__GetSel(pObj);
;;;78       }
;;;79       return r;
;;;80     }
00004c  bd70              POP      {r4-r6,pc}
                  |L1.78|
00004e  4620              MOV      r0,r4                 ;70
000050  e8bd4070          POP      {r4-r6,lr}            ;70
000054  f7ffbffe          B.W      LISTVIEW__GetSel
                  |L1.88|
000058  4620              MOV      r0,r4                 ;77
00005a  e8bd4070          POP      {r4-r6,lr}            ;77
00005e  f7ffbffe          B.W      LISTVIEW__GetSel
;;;81     
                          ENDP

                  _SetSelUnsorted PROC
;;;85     */
;;;86     static void _SetSelUnsorted(LISTVIEW_Handle hObj, LISTVIEW_Obj * pObj, int Sel) {
000062  e92d41f0          PUSH     {r4-r8,lr}
000066  4607              MOV      r7,r0
000068  460e              MOV      r6,r1
00006a  4615              MOV      r5,r2
;;;87       int i, NumItems;
;;;88       if (pObj->hSort) {
00006c  f9b60092          LDRSH    r0,[r6,#0x92]
000070  b1c0              CBZ      r0,|L1.164|
;;;89         LISTVIEW_SORT * pSort;
;;;90         SORT_TYPE * paSortArray;
;;;91         pSort = (LISTVIEW_SORT *)GUI_ALLOC_h2p(pObj->hSort);
000072  f7fffffe          BL       GUI_ALLOC_h2p
;;;92         NumItems = pSort->SortArrayNumItems;
000076  8844              LDRH     r4,[r0,#2]
;;;93         paSortArray = (SORT_TYPE *)GUI_ALLOC_h2p(pSort->hSortArray);
000078  f9b00000          LDRSH    r0,[r0,#0]
00007c  f7fffffe          BL       GUI_ALLOC_h2p
;;;94         for (i = 0; i < NumItems; i++) {
000080  2200              MOVS     r2,#0
000082  2c00              CMP      r4,#0
000084  dd0c              BLE      |L1.160|
                  |L1.134|
;;;95           if (*(paSortArray + i) == Sel) {
000086  f8301012          LDRH     r1,[r0,r2,LSL #1]
00008a  42a9              CMP      r1,r5
00008c  d105              BNE      |L1.154|
;;;96             LISTVIEW__SetSel(hObj, pObj, i);
00008e  4631              MOV      r1,r6
000090  4638              MOV      r0,r7
000092  e8bd41f0          POP      {r4-r8,lr}
000096  f7ffbffe          B.W      LISTVIEW__SetSel
                  |L1.154|
00009a  1c52              ADDS     r2,r2,#1              ;94
00009c  42a2              CMP      r2,r4                 ;94
00009e  dbf2              BLT      |L1.134|
                  |L1.160|
;;;97             break;
;;;98           }
;;;99         }
;;;100      } else {
;;;101        LISTVIEW__SetSel(hObj, pObj, Sel);
;;;102      }
;;;103    }
0000a0  e8bd81f0          POP      {r4-r8,pc}
                  |L1.164|
0000a4  462a              MOV      r2,r5                 ;101
0000a6  4631              MOV      r1,r6                 ;101
0000a8  4638              MOV      r0,r7                 ;101
0000aa  e8bd41f0          POP      {r4-r8,lr}            ;101
0000ae  f7ffbffe          B.W      LISTVIEW__SetSel
;;;104    
                          ENDP

                  _Compare PROC
;;;108    */
;;;109    static int _Compare(unsigned lb, unsigned ub, SORT_OBJECT * pSortObject) {
0000b2  b570              PUSH     {r4-r6,lr}
0000b4  4614              MOV      r4,r2
;;;110      char * p0, * p1;
;;;111      LISTVIEW_ROW  * pRow0, * pRow1;
;;;112      LISTVIEW_COLUMN * pColumn;
;;;113      SORT_TYPE i0, i1;
;;;114      int Result;
;;;115      i0 = *(pSortObject->paSortArray + lb);
0000b6  68a2              LDR      r2,[r4,#8]
0000b8  f8323010          LDRH     r3,[r2,r0,LSL #1]
;;;116      i1 = *(pSortObject->paSortArray + ub);
0000bc  f8326011          LDRH     r6,[r2,r1,LSL #1]
;;;117      pRow0   = (LISTVIEW_ROW *)   GUI_ARRAY_GetpItem(&pSortObject->pObj->RowArray,  i0);
0000c0  6820              LDR      r0,[r4,#0]
0000c2  4619              MOV      r1,r3
0000c4  302a              ADDS     r0,r0,#0x2a
0000c6  f7fffffe          BL       GUI_ARRAY_GetpItem
0000ca  4605              MOV      r5,r0
;;;118      pRow1   = (LISTVIEW_ROW *)   GUI_ARRAY_GetpItem(&pSortObject->pObj->RowArray,  i1);
0000cc  6820              LDR      r0,[r4,#0]
0000ce  4631              MOV      r1,r6
0000d0  302a              ADDS     r0,r0,#0x2a
0000d2  f7fffffe          BL       GUI_ARRAY_GetpItem
0000d6  4606              MOV      r6,r0
;;;119      p0      = ((LISTVIEW_CELL *) GUI_ARRAY_GetpItem(&pRow0->CellArray, pSortObject->pObj->SortIndex))->acText;
0000d8  6820              LDR      r0,[r4,#0]
0000da  6e81              LDR      r1,[r0,#0x68]
0000dc  4628              MOV      r0,r5
0000de  f7fffffe          BL       GUI_ARRAY_GetpItem
0000e2  1c85              ADDS     r5,r0,#2
;;;120      p1      = ((LISTVIEW_CELL *) GUI_ARRAY_GetpItem(&pRow1->CellArray, pSortObject->pObj->SortIndex))->acText;
0000e4  6820              LDR      r0,[r4,#0]
0000e6  6e81              LDR      r1,[r0,#0x68]
0000e8  4630              MOV      r0,r6
0000ea  f7fffffe          BL       GUI_ARRAY_GetpItem
0000ee  1c86              ADDS     r6,r0,#2
;;;121      pColumn = (LISTVIEW_COLUMN *)GUI_ARRAY_GetpItem(&pSortObject->pObj->ColumnArray, pSortObject->pObj->SortIndex);
0000f0  6820              LDR      r0,[r4,#0]
0000f2  6e81              LDR      r1,[r0,#0x68]
0000f4  302e              ADDS     r0,r0,#0x2e
0000f6  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;122      if (!pColumn) {
0000fa  b148              CBZ      r0,|L1.272|
;;;123        return 0;
;;;124      }
;;;125      Result = pColumn->fpCompare(p0, p1);
0000fc  6842              LDR      r2,[r0,#4]
0000fe  4631              MOV      r1,r6
000100  4628              MOV      r0,r5
000102  4790              BLX      r2
;;;126      if (pSortObject->pSort->Reverse) {
000104  6861              LDR      r1,[r4,#4]
000106  7b09              LDRB     r1,[r1,#0xc]
000108  2900              CMP      r1,#0
00010a  d000              BEQ      |L1.270|
;;;127        Result *= -1;
00010c  4240              RSBS     r0,r0,#0
                  |L1.270|
;;;128      }
;;;129      return Result;
;;;130    }
00010e  bd70              POP      {r4-r6,pc}
                  |L1.272|
000110  2000              MOVS     r0,#0                 ;123
000112  bd70              POP      {r4-r6,pc}
;;;131    
                          ENDP

                  _Swap PROC
;;;135    */
;;;136    static void _Swap(unsigned lb, unsigned ub, SORT_OBJECT * pSortObject) {
000114  b410              PUSH     {r4}
;;;137      int Temp;
;;;138      Temp = *(pSortObject->paSortArray + lb);
000116  6893              LDR      r3,[r2,#8]
000118  f833c010          LDRH     r12,[r3,r0,LSL #1]
;;;139      *(pSortObject->paSortArray + lb) = *(pSortObject->paSortArray + ub);
00011c  f8334011          LDRH     r4,[r3,r1,LSL #1]
000120  f8234010          STRH     r4,[r3,r0,LSL #1]
;;;140      *(pSortObject->paSortArray + ub) = Temp;
000124  6890              LDR      r0,[r2,#8]
000126  f820c011          STRH     r12,[r0,r1,LSL #1]
;;;141    }
00012a  bc10              POP      {r4}
00012c  4770              BX       lr
;;;142    
                          ENDP

                  _BubbleSort PROC
;;;149    */
;;;150    static void _BubbleSort(unsigned lb, unsigned ub, SORT_OBJECT * pSortObject) {
00012e  e92d41f0          PUSH     {r4-r8,lr}
000132  4606              MOV      r6,r0
000134  460f              MOV      r7,r1
000136  4690              MOV      r8,r2
                  |L1.312|
;;;151      int Swapped;
;;;152      do {
;;;153        unsigned i;
;;;154        Swapped = 0;
000138  2500              MOVS     r5,#0
;;;155        for (i = ub; i > lb; i--) {
00013a  463c              MOV      r4,r7
00013c  42b4              CMP      r4,r6
00013e  d90f              BLS      |L1.352|
                  |L1.320|
;;;156          if (_Compare(i - 1, i, pSortObject) > 0) {
000140  4642              MOV      r2,r8
000142  4621              MOV      r1,r4
000144  1e60              SUBS     r0,r4,#1
000146  f7fffffe          BL       _Compare
00014a  2800              CMP      r0,#0
00014c  dd05              BLE      |L1.346|
;;;157            _Swap(i - 1, i, pSortObject);
00014e  4642              MOV      r2,r8
000150  4621              MOV      r1,r4
000152  1e60              SUBS     r0,r4,#1
000154  f7fffffe          BL       _Swap
;;;158            Swapped = 1;
000158  2501              MOVS     r5,#1
                  |L1.346|
00015a  1e64              SUBS     r4,r4,#1              ;155
00015c  42b4              CMP      r4,r6                 ;155
00015e  d8ef              BHI      |L1.320|
                  |L1.352|
;;;159          }
;;;160        }
;;;161      } while (Swapped);
000160  2d00              CMP      r5,#0
000162  d1e9              BNE      |L1.312|
;;;162    }
000164  e8bd81f0          POP      {r4-r8,pc}
;;;163    
                          ENDP

                  _Reverse PROC
;;;170    */
;;;171    static void _Reverse(SORT_OBJECT * pSortObject) {
000168  b430              PUSH     {r4,r5}
;;;172      int i, NumItems;
;;;173      NumItems = pSortObject->pSort->SortArrayNumItems;
00016a  6841              LDR      r1,[r0,#4]
00016c  884b              LDRH     r3,[r1,#2]
;;;174      for (i = 0; i < NumItems / 2; i++) {
00016e  2100              MOVS     r1,#0
000170  eb0374d3          ADD      r4,r3,r3,LSR #31
000174  ebb10f64          CMP      r1,r4,ASR #1
000178  da15              BGE      |L1.422|
                  |L1.378|
;;;175        int Temp;
;;;176        Temp                                           = *(pSortObject->paSortArray + i);
00017a  6882              LDR      r2,[r0,#8]
00017c  f832c011          LDRH     r12,[r2,r1,LSL #1]
;;;177        *(pSortObject->paSortArray + i)                = *(pSortObject->paSortArray + NumItems - i - 1);
000180  eb020543          ADD      r5,r2,r3,LSL #1
000184  eba50541          SUB      r5,r5,r1,LSL #1
000188  f8355c02          LDRH     r5,[r5,#-2]
00018c  f8225011          STRH     r5,[r2,r1,LSL #1]
;;;178        *(pSortObject->paSortArray + NumItems - i - 1) = Temp;
000190  6882              LDR      r2,[r0,#8]
000192  eb020243          ADD      r2,r2,r3,LSL #1
000196  eba20241          SUB      r2,r2,r1,LSL #1
00019a  f822cc02          STRH     r12,[r2,#-2]
00019e  1c49              ADDS     r1,r1,#1              ;174
0001a0  ebb10f64          CMP      r1,r4,ASR #1          ;174
0001a4  dbe9              BLT      |L1.378|
                  |L1.422|
;;;179      }
;;;180    }
0001a6  bc30              POP      {r4,r5}
0001a8  4770              BX       lr
;;;181    
                          ENDP

                  _Sort PROC
;;;190    */
;;;191    static int _Sort(LISTVIEW_Handle hObj) {
0001aa  e92d41f0          PUSH     {r4-r8,lr}
0001ae  b084              SUB      sp,sp,#0x10
0001b0  4606              MOV      r6,r0
;;;192      WM_HMEM hSortArray;
;;;193      SORT_OBJECT SortObject;
;;;194      int NumItems, NumItemsReq, i, Sel;
;;;195      SortObject.pObj = LISTVIEW_H2P(hObj);
0001b2  4630              MOV      r0,r6
0001b4  f7fffffe          BL       GUI_ALLOC_h2p
0001b8  9001              STR      r0,[sp,#4]
;;;196      if (((SortObject.pObj->IsPresorted) && (SortObject.pObj->IsSorted)) || (SortObject.pObj->hSort == 0)) {
0001ba  9801              LDR      r0,[sp,#4]
0001bc  f8900095          LDRB     r0,[r0,#0x95]
0001c0  b118              CBZ      r0,|L1.458|
0001c2  9801              LDR      r0,[sp,#4]
0001c4  f8900094          LDRB     r0,[r0,#0x94]
0001c8  bbf0              CBNZ     r0,|L1.584|
                  |L1.458|
0001ca  9801              LDR      r0,[sp,#4]
0001cc  f9b00092          LDRSH    r0,[r0,#0x92]
0001d0  b3d0              CBZ      r0,|L1.584|
;;;197        return 0;
;;;198      }
;;;199      SortObject.pSort = (LISTVIEW_SORT *)GUI_ALLOC_h2p(SortObject.pObj->hSort);
0001d2  f7fffffe          BL       GUI_ALLOC_h2p
0001d6  9002              STR      r0,[sp,#8]
;;;200      NumItemsReq = SortObject.pObj->RowArray.NumItems;
0001d8  9801              LDR      r0,[sp,#4]
0001da  8d44              LDRH     r4,[r0,#0x2a]
;;;201      NumItems    = SortObject.pSort->SortArrayNumItems;
0001dc  9802              LDR      r0,[sp,#8]
0001de  8845              LDRH     r5,[r0,#2]
;;;202      Sel = _GetSelUnsorted(SortObject.pObj);
0001e0  9801              LDR      r0,[sp,#4]
0001e2  f7fffffe          BL       _GetSelUnsorted
0001e6  4607              MOV      r7,r0
;;;203      /* Adjust number of items in sort array */
;;;204      if (NumItems != NumItemsReq) {
0001e8  42a5              CMP      r5,r4
0001ea  d017              BEQ      |L1.540|
;;;205        if (!SortObject.pSort->hSortArray) {
0001ec  9802              LDR      r0,[sp,#8]
0001ee  f9b00000          LDRSH    r0,[r0,#0]
0001f2  b350              CBZ      r0,|L1.586|
;;;206          hSortArray = GUI_ALLOC_AllocZero(sizeof(SORT_TYPE) * NumItemsReq);
;;;207        } else {
;;;208          hSortArray = GUI_ALLOC_Realloc(SortObject.pSort->hSortArray, sizeof(SORT_TYPE) * NumItemsReq);
0001f4  0061              LSLS     r1,r4,#1
0001f6  f7fffffe          BL       GUI_ALLOC_Realloc
0001fa  4680              MOV      r8,r0
                  |L1.508|
;;;209        }
;;;210        if (!hSortArray) {
0001fc  f1b80f00          CMP      r8,#0
000200  d030              BEQ      |L1.612|
;;;211          return 1;
;;;212        }
;;;213        SortObject.pObj = LISTVIEW_H2P(hObj);
000202  4630              MOV      r0,r6
000204  f7fffffe          BL       GUI_ALLOC_h2p
000208  9001              STR      r0,[sp,#4]
;;;214        SortObject.pSort = (LISTVIEW_SORT *)GUI_ALLOC_h2p(SortObject.pObj->hSort);
00020a  9801              LDR      r0,[sp,#4]
00020c  f9b00092          LDRSH    r0,[r0,#0x92]
000210  f7fffffe          BL       GUI_ALLOC_h2p
000214  9002              STR      r0,[sp,#8]
;;;215        SortObject.pSort->hSortArray = hSortArray;
000216  9802              LDR      r0,[sp,#8]
000218  f8a08000          STRH     r8,[r0,#0]
                  |L1.540|
;;;216      }
;;;217      SortObject.paSortArray = (SORT_TYPE *)GUI_ALLOC_h2p(SortObject.pSort->hSortArray);
00021c  9802              LDR      r0,[sp,#8]
00021e  f9b00000          LDRSH    r0,[r0,#0]
000222  f7fffffe          BL       GUI_ALLOC_h2p
000226  9003              STR      r0,[sp,#0xc]
;;;218      if (SortObject.pObj->IsPresorted) {
000228  9801              LDR      r0,[sp,#4]
00022a  f8901095          LDRB     r1,[r0,#0x95]
00022e  2000              MOVS     r0,#0                 ;196
000230  b1e1              CBZ      r1,|L1.620|
;;;219        /* Add new indices */
;;;220        if (NumItems < NumItemsReq) {
000232  42a5              CMP      r5,r4
000234  da26              BGE      |L1.644|
;;;221          SortObject.pObj->ReverseSort = 0; /* Reverse sort only allowed if listview is presorted and no rows are added */
000236  9901              LDR      r1,[sp,#4]
000238  f8810096          STRB     r0,[r1,#0x96]
                  |L1.572|
;;;222          for (i = NumItems; i < NumItemsReq; i++) {
;;;223            *(SortObject.paSortArray + i) = i;
00023c  9803              LDR      r0,[sp,#0xc]
00023e  f8205015          STRH     r5,[r0,r5,LSL #1]
000242  1c6d              ADDS     r5,r5,#1              ;222
000244  42a5              CMP      r5,r4                 ;222
000246  e001              B        |L1.588|
                  |L1.584|
000248  e002              B        |L1.592|
                  |L1.586|
00024a  e005              B        |L1.600|
                  |L1.588|
00024c  dbf6              BLT      |L1.572|
00024e  e019              B        |L1.644|
                  |L1.592|
;;;224          }
;;;225        }
;;;226      } else {
;;;227        SortObject.pObj->ReverseSort = 0; /* Reverse sort only allowed if listview is presorted */
;;;228        /* Fill with indices if not presorted */
;;;229        for (i = 0; i < NumItemsReq; i++) {
;;;230          *(SortObject.paSortArray + i) = i;
;;;231        }
;;;232      }
;;;233      SortObject.pSort->SortArrayNumItems = NumItemsReq;
;;;234      /* Sort only if more than one item is available */
;;;235      if (NumItemsReq > 1) {
;;;236        if (SortObject.pObj->ReverseSort) {
;;;237          _Reverse(&SortObject);
;;;238        } else {
;;;239          _BubbleSort(0, NumItemsReq - 1, &SortObject);
;;;240        }
;;;241        _SetSelUnsorted(hObj, SortObject.pObj, Sel);
;;;242      }
;;;243      SortObject.pObj->IsPresorted = 1;
;;;244      SortObject.pObj->IsSorted    = 1;
;;;245      HEADER_SetDirIndicator(SortObject.pObj->hHeader, SortObject.pObj->SortIndex, SortObject.pSort->Reverse);
;;;246      return 0;
;;;247    }
000250  b004              ADD      sp,sp,#0x10
000252  2000              MOVS     r0,#0                 ;197
000254  e8bd81f0          POP      {r4-r8,pc}
                  |L1.600|
000258  0060              LSLS     r0,r4,#1              ;206
00025a  b200              SXTH     r0,r0                 ;206
00025c  f7fffffe          BL       GUI_ALLOC_AllocZero
000260  4680              MOV      r8,r0                 ;206
000262  e7cb              B        |L1.508|
                  |L1.612|
000264  b004              ADD      sp,sp,#0x10
000266  2001              MOVS     r0,#1                 ;211
000268  e8bd81f0          POP      {r4-r8,pc}
                  |L1.620|
00026c  9901              LDR      r1,[sp,#4]            ;227
00026e  f8810096          STRB     r0,[r1,#0x96]         ;227
000272  2000              MOVS     r0,#0                 ;229
000274  2c00              CMP      r4,#0                 ;229
000276  dd05              BLE      |L1.644|
                  |L1.632|
000278  9903              LDR      r1,[sp,#0xc]          ;230
00027a  f8210010          STRH     r0,[r1,r0,LSL #1]     ;230
00027e  1c40              ADDS     r0,r0,#1              ;229
000280  42a0              CMP      r0,r4                 ;229
000282  dbf9              BLT      |L1.632|
                  |L1.644|
000284  9802              LDR      r0,[sp,#8]            ;233
000286  8044              STRH     r4,[r0,#2]            ;233
000288  2c01              CMP      r4,#1                 ;235
00028a  dd11              BLE      |L1.688|
00028c  9801              LDR      r0,[sp,#4]            ;236
00028e  f8900096          LDRB     r0,[r0,#0x96]         ;236
000292  b118              CBZ      r0,|L1.668|
000294  a801              ADD      r0,sp,#4              ;237
000296  f7fffffe          BL       _Reverse
00029a  e004              B        |L1.678|
                  |L1.668|
00029c  aa01              ADD      r2,sp,#4              ;239
00029e  1e61              SUBS     r1,r4,#1              ;239
0002a0  2000              MOVS     r0,#0                 ;239
0002a2  f7fffffe          BL       _BubbleSort
                  |L1.678|
0002a6  463a              MOV      r2,r7                 ;241
0002a8  4630              MOV      r0,r6                 ;241
0002aa  9901              LDR      r1,[sp,#4]            ;241
0002ac  f7fffffe          BL       _SetSelUnsorted
                  |L1.688|
0002b0  9901              LDR      r1,[sp,#4]            ;243
0002b2  2001              MOVS     r0,#1                 ;243
0002b4  f8810095          STRB     r0,[r1,#0x95]         ;243
0002b8  9901              LDR      r1,[sp,#4]            ;244
0002ba  f8810094          STRB     r0,[r1,#0x94]         ;244
0002be  9802              LDR      r0,[sp,#8]            ;245
0002c0  7b02              LDRB     r2,[r0,#0xc]          ;245
0002c2  9801              LDR      r0,[sp,#4]            ;245
0002c4  6e81              LDR      r1,[r0,#0x68]         ;245
0002c6  f9b00028          LDRSH    r0,[r0,#0x28]         ;245
0002ca  f7fffffe          BL       HEADER_SetDirIndicator
0002ce  b004              ADD      sp,sp,#0x10
0002d0  2000              MOVS     r0,#0                 ;246
0002d2  e8bd81f0          POP      {r4-r8,pc}
;;;248    
                          ENDP

                  _CreateSortObject PROC
;;;252    */
;;;253    static LISTVIEW_SORT * _CreateSortObject(LISTVIEW_Handle hObj, LISTVIEW_Obj * pObj) {
0002d6  b570              PUSH     {r4-r6,lr}
0002d8  4605              MOV      r5,r0
0002da  460c              MOV      r4,r1
;;;254      LISTVIEW_SORT * pSort;
;;;255      if (!pObj->hSort) {
0002dc  f8b40092          LDRH     r0,[r4,#0x92]
0002e0  b958              CBNZ     r0,|L1.762|
;;;256        pObj->hSort = GUI_ALLOC_AllocZero(sizeof(LISTVIEW_SORT));
0002e2  2010              MOVS     r0,#0x10
0002e4  f7fffffe          BL       GUI_ALLOC_AllocZero
0002e8  f8a40092          STRH     r0,[r4,#0x92]
;;;257        pObj = LISTVIEW_H2P(hObj); /* Restore after allocating memory */
0002ec  4628              MOV      r0,r5
0002ee  f7fffffe          BL       GUI_ALLOC_h2p
0002f2  4604              MOV      r4,r0
;;;258        if (!pObj->hSort) {
0002f4  f8b40092          LDRH     r0,[r4,#0x92]
0002f8  b158              CBZ      r0,|L1.786|
                  |L1.762|
;;;259          return NULL;
;;;260        }
;;;261      }
;;;262      pSort = (LISTVIEW_SORT *)GUI_ALLOC_h2p(pObj->hSort);
0002fa  f9b40092          LDRSH    r0,[r4,#0x92]
0002fe  f7fffffe          BL       GUI_ALLOC_h2p
;;;263      pObj->SortIndex      = -1;
000302  f04f31ff          MOV      r1,#0xffffffff
000306  66a1              STR      r1,[r4,#0x68]
;;;264      pSort->fpFree        = _Free;
000308  4990              LDR      r1,|L1.1356|
00030a  6081              STR      r1,[r0,#8]
;;;265      pSort->fpSort        = _Sort;
00030c  4990              LDR      r1,|L1.1360|
00030e  6041              STR      r1,[r0,#4]
;;;266      return pSort;
;;;267    }
000310  bd70              POP      {r4-r6,pc}
                  |L1.786|
000312  2000              MOVS     r0,#0                 ;259
000314  bd70              POP      {r4-r6,pc}
;;;268    
                          ENDP

                  LISTVIEW_CompareText PROC
;;;278    */
;;;279    int LISTVIEW_CompareText(const void * p0, const void * p1) {
000316  460a              MOV      r2,r1
;;;280      return strcmp((const char *)p1, (const char *)p0);
000318  4601              MOV      r1,r0
00031a  4610              MOV      r0,r2
00031c  f7ffbffe          B.W      strcmp
;;;281    }
;;;282    
                          ENDP

                  LISTVIEW_CompareDec PROC
;;;286    */
;;;287    int LISTVIEW_CompareDec(const void * p0, const void * p1) {
000320  b410              PUSH     {r4}
000322  b085              SUB      sp,sp,#0x14
;;;288      int v[2] = {0}, i, d;
000324  2200              MOVS     r2,#0
000326  9202              STR      r2,[sp,#8]
000328  9203              STR      r2,[sp,#0xc]
;;;289      const char * ps[2];
;;;290      char c;
;;;291      ps[0] = (const char *)p0;
00032a  9000              STR      r0,[sp,#0]
;;;292      ps[1] = (const char *)p1;
00032c  9101              STR      r1,[sp,#4]
;;;293      for (i = 0; i < 2; i++) {
00032e  2000              MOVS     r0,#0
000330  466b              MOV      r3,sp                 ;289
000332  f10d0c08          ADD      r12,sp,#8             ;288
                  |L1.822|
;;;294        int Neg = 0;
000336  2400              MOVS     r4,#0
;;;295        if (*ps[i] == '-') {
000338  f8531020          LDR      r1,[r3,r0,LSL #2]
00033c  780a              LDRB     r2,[r1,#0]
00033e  2a2d              CMP      r2,#0x2d
000340  d103              BNE      |L1.842|
;;;296          Neg = 1;
000342  2401              MOVS     r4,#1
;;;297          ps[i]++;
000344  1c49              ADDS     r1,r1,#1
000346  f8431020          STR      r1,[r3,r0,LSL #2]
                  |L1.842|
;;;298        }
;;;299        while ((c = *ps[i]++) != 0) {
00034a  f8532020          LDR      r2,[r3,r0,LSL #2]
00034e  f8121b01          LDRB     r1,[r2],#1
000352  f8432020          STR      r2,[r3,r0,LSL #2]
000356  b191              CBZ      r1,|L1.894|
                  |L1.856|
;;;300          d = c - '0';
000358  3930              SUBS     r1,r1,#0x30
;;;301          if ((d < 0) || (d > 9)) {
00035a  290a              CMP      r1,#0xa
00035c  d20f              BCS      |L1.894|
;;;302            break;
;;;303          }
;;;304          v[i] *= 10;
00035e  f85c2020          LDR      r2,[r12,r0,LSL #2]
000362  eb020282          ADD      r2,r2,r2,LSL #2
000366  0052              LSLS     r2,r2,#1
;;;305          v[i] += d;
000368  4411              ADD      r1,r1,r2
00036a  f84c1020          STR      r1,[r12,r0,LSL #2]
00036e  f8532020          LDR      r2,[r3,r0,LSL #2]     ;299
000372  f8121b01          LDRB     r1,[r2],#1            ;299
000376  f8432020          STR      r2,[r3,r0,LSL #2]     ;299
00037a  2900              CMP      r1,#0                 ;299
00037c  d1ec              BNE      |L1.856|
                  |L1.894|
;;;306        }
;;;307        if (Neg) {
00037e  b124              CBZ      r4,|L1.906|
;;;308          v[i] *= -1;
000380  f85c1020          LDR      r1,[r12,r0,LSL #2]
000384  4249              RSBS     r1,r1,#0
000386  f84c1020          STR      r1,[r12,r0,LSL #2]
                  |L1.906|
00038a  1c40              ADDS     r0,r0,#1              ;293
00038c  2802              CMP      r0,#2                 ;293
00038e  dbd2              BLT      |L1.822|
;;;309        }
;;;310      }
;;;311      if (v[0] > v[1]) {
000390  9903              LDR      r1,[sp,#0xc]
000392  9802              LDR      r0,[sp,#8]
000394  4288              CMP      r0,r1
000396  dd04              BLE      |L1.930|
;;;312        return -1;
;;;313      } else if (v[0] < v[1]) {
;;;314        return 1;
;;;315      }
;;;316      return 0;
;;;317    }
000398  b005              ADD      sp,sp,#0x14
00039a  f04f30ff          MOV      r0,#0xffffffff        ;312
00039e  bc10              POP      {r4}
0003a0  4770              BX       lr
                  |L1.930|
0003a2  da04              BGE      |L1.942|
0003a4  b005              ADD      sp,sp,#0x14
0003a6  f04f0001          MOV      r0,#1                 ;314
0003aa  bc10              POP      {r4}
0003ac  4770              BX       lr
                  |L1.942|
0003ae  b005              ADD      sp,sp,#0x14
0003b0  2000              MOVS     r0,#0                 ;316
0003b2  bc10              POP      {r4}
0003b4  4770              BX       lr
;;;318    
                          ENDP

                  LISTVIEW_GetSelUnsorted PROC
;;;328    */
;;;329    int LISTVIEW_GetSelUnsorted(LISTVIEW_Handle hObj) {
0003b6  b570              PUSH     {r4-r6,lr}
0003b8  4605              MOV      r5,r0
;;;330      int r = -1;
0003ba  f04f34ff          MOV      r4,#0xffffffff
;;;331      if (hObj) {
0003be  b175              CBZ      r5,|L1.990|
;;;332        LISTVIEW_Obj * pObj;
;;;333        WM_LOCK();
0003c0  f7fffffe          BL       GUI_Lock
;;;334        pObj = LISTVIEW_H2P(hObj);
0003c4  4628              MOV      r0,r5
0003c6  f7fffffe          BL       GUI_ALLOC_h2p
0003ca  4604              MOV      r4,r0
;;;335        _Sort(hObj);
0003cc  4628              MOV      r0,r5
0003ce  f7fffffe          BL       _Sort
;;;336        r = _GetSelUnsorted(pObj);
0003d2  4620              MOV      r0,r4
0003d4  f7fffffe          BL       _GetSelUnsorted
0003d8  4604              MOV      r4,r0
;;;337        WM_UNLOCK();
0003da  f7fffffe          BL       GUI_Unlock
                  |L1.990|
;;;338      }
;;;339      return r;
0003de  4620              MOV      r0,r4
;;;340    }
0003e0  bd70              POP      {r4-r6,pc}
;;;341    
                          ENDP

                  LISTVIEW_SetSelUnsorted PROC
;;;351    */
;;;352    void LISTVIEW_SetSelUnsorted(LISTVIEW_Handle hObj, int Sel) {
0003e2  b570              PUSH     {r4-r6,lr}
0003e4  4604              MOV      r4,r0
0003e6  460d              MOV      r5,r1
;;;353      if (hObj) {
0003e8  2c00              CMP      r4,#0
0003ea  d011              BEQ      |L1.1040|
;;;354        LISTVIEW_Obj * pObj;
;;;355        WM_LOCK();
0003ec  f7fffffe          BL       GUI_Lock
;;;356        pObj = LISTVIEW_H2P(hObj);
0003f0  4620              MOV      r0,r4
0003f2  f7fffffe          BL       GUI_ALLOC_h2p
0003f6  4606              MOV      r6,r0
;;;357        _Sort(hObj);
0003f8  4620              MOV      r0,r4
0003fa  f7fffffe          BL       _Sort
;;;358        _SetSelUnsorted(hObj, pObj, Sel);
0003fe  462a              MOV      r2,r5
000400  4631              MOV      r1,r6
000402  4620              MOV      r0,r4
000404  f7fffffe          BL       _SetSelUnsorted
;;;359        WM_UNLOCK();
000408  e8bd4070          POP      {r4-r6,lr}
00040c  f7ffbffe          B.W      GUI_Unlock
                  |L1.1040|
;;;360      }
;;;361    }
000410  bd70              POP      {r4-r6,pc}
;;;362    
                          ENDP

                  LISTVIEW_SetCompareFunc PROC
;;;370    */
;;;371    void LISTVIEW_SetCompareFunc(LISTVIEW_Handle hObj, unsigned Column, int (* fpCompare)(const void * p0, const void * p1)) {
000412  e92d41f0          PUSH     {r4-r8,lr}
000416  4604              MOV      r4,r0
000418  460d              MOV      r5,r1
00041a  4616              MOV      r6,r2
;;;372      int NumColumns;
;;;373      LISTVIEW_Obj    * pObj;
;;;374      LISTVIEW_COLUMN * pColumn;
;;;375      if (hObj) {
00041c  2c00              CMP      r4,#0
00041e  d014              BEQ      |L1.1098|
;;;376        WM_LOCK();
000420  f7fffffe          BL       GUI_Lock
;;;377        pObj       = LISTVIEW_H2P(hObj);
000424  4620              MOV      r0,r4
000426  f7fffffe          BL       GUI_ALLOC_h2p
00042a  4607              MOV      r7,r0
;;;378        NumColumns = LISTVIEW_GetNumColumns(hObj);
00042c  4620              MOV      r0,r4
00042e  f7fffffe          BL       LISTVIEW_GetNumColumns
;;;379        if ((int)Column <= NumColumns) {
000432  4285              CMP      r5,r0
000434  dc05              BGT      |L1.1090|
;;;380          pColumn = (LISTVIEW_COLUMN *)GUI_ARRAY_GetpItem(&pObj->ColumnArray, Column);
000436  4629              MOV      r1,r5
000438  f107002e          ADD      r0,r7,#0x2e
00043c  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;381          pColumn->fpCompare = fpCompare;
000440  6046              STR      r6,[r0,#4]
                  |L1.1090|
;;;382        }
;;;383        WM_UNLOCK();
000442  e8bd41f0          POP      {r4-r8,lr}
000446  f7ffbffe          B.W      GUI_Unlock
                  |L1.1098|
;;;384      }
;;;385    }
00044a  e8bd81f0          POP      {r4-r8,pc}
;;;386    
                          ENDP

                  LISTVIEW_DisableSort PROC
;;;393    */
;;;394    void LISTVIEW_DisableSort(LISTVIEW_Handle hObj) {
00044e  b570              PUSH     {r4-r6,lr}
000450  4605              MOV      r5,r0
;;;395      if (hObj) {
000452  2d00              CMP      r5,#0
000454  d02a              BEQ      |L1.1196|
;;;396        LISTVIEW_Obj * pObj;
;;;397        WM_LOCK();
000456  f7fffffe          BL       GUI_Lock
;;;398        pObj = LISTVIEW_H2P(hObj);
00045a  4628              MOV      r0,r5
00045c  f7fffffe          BL       GUI_ALLOC_h2p
000460  4604              MOV      r4,r0
;;;399        if (pObj->hSort) {
000462  f8b40092          LDRH     r0,[r4,#0x92]
000466  b1e8              CBZ      r0,|L1.1188|
;;;400          int Sel = _GetSelUnsorted(pObj);
000468  4620              MOV      r0,r4
00046a  f7fffffe          BL       _GetSelUnsorted
00046e  4606              MOV      r6,r0
;;;401          _Free(pObj->hSort);
000470  f9b40092          LDRSH    r0,[r4,#0x92]
000474  f7fffffe          BL       _Free
;;;402          pObj->hSort       = 0;
000478  2000              MOVS     r0,#0
00047a  f8a40092          STRH     r0,[r4,#0x92]
;;;403          pObj->SortIndex   = -1;
00047e  1e41              SUBS     r1,r0,#1
000480  66a1              STR      r1,[r4,#0x68]
;;;404          pObj->IsPresorted = 0;
000482  f8840095          STRB     r0,[r4,#0x95]
;;;405          pObj->IsSorted    = 0;
000486  f8840094          STRB     r0,[r4,#0x94]
;;;406          HEADER_SetDirIndicator(pObj->hHeader, -1, 0);
00048a  f9b40028          LDRSH    r0,[r4,#0x28]
00048e  2200              MOVS     r2,#0
000490  f7fffffe          BL       HEADER_SetDirIndicator
;;;407          LISTVIEW_SetSel(hObj, Sel);
000494  4631              MOV      r1,r6
000496  4628              MOV      r0,r5
000498  f7fffffe          BL       LISTVIEW_SetSel
;;;408          LISTVIEW__InvalidateInsideArea(hObj, pObj);
00049c  4621              MOV      r1,r4
00049e  4628              MOV      r0,r5
0004a0  f7fffffe          BL       LISTVIEW__InvalidateInsideArea
                  |L1.1188|
;;;409        }
;;;410        WM_UNLOCK();
0004a4  e8bd4070          POP      {r4-r6,lr}
0004a8  f7ffbffe          B.W      GUI_Unlock
                  |L1.1196|
;;;411      }
;;;412    }
0004ac  bd70              POP      {r4-r6,pc}
;;;413    
                          ENDP

                  LISTVIEW_EnableSort PROC
;;;420    */
;;;421    void LISTVIEW_EnableSort(LISTVIEW_Handle hObj) {
0004ae  b510              PUSH     {r4,lr}
0004b0  4604              MOV      r4,r0
;;;422      if (hObj) {
0004b2  2c00              CMP      r4,#0
0004b4  d00f              BEQ      |L1.1238|
;;;423        LISTVIEW_Obj * pObj;
;;;424        WM_LOCK();
0004b6  f7fffffe          BL       GUI_Lock
;;;425        pObj = LISTVIEW_H2P(hObj);
0004ba  4620              MOV      r0,r4
0004bc  f7fffffe          BL       GUI_ALLOC_h2p
;;;426        if (!pObj->hSort) {
0004c0  f8b02092          LDRH     r2,[r0,#0x92]
0004c4  b91a              CBNZ     r2,|L1.1230|
;;;427          _CreateSortObject(hObj, pObj);
0004c6  4601              MOV      r1,r0
0004c8  4620              MOV      r0,r4
0004ca  f7fffffe          BL       _CreateSortObject
                  |L1.1230|
;;;428        }
;;;429        WM_UNLOCK();
0004ce  e8bd4010          POP      {r4,lr}
0004d2  f7ffbffe          B.W      GUI_Unlock
                  |L1.1238|
;;;430      }
;;;431    }
0004d6  bd10              POP      {r4,pc}
;;;432    
                          ENDP

                  LISTVIEW_SetSort PROC
;;;445    */
;;;446    unsigned LISTVIEW_SetSort(LISTVIEW_Handle hObj, unsigned Column, unsigned Reverse) {
0004d8  e92d41f0          PUSH     {r4-r8,lr}
0004dc  4680              MOV      r8,r0
0004de  460d              MOV      r5,r1
0004e0  4617              MOV      r7,r2
;;;447      LISTVIEW_Obj    * pObj;
;;;448      LISTVIEW_SORT   * pSort;
;;;449      LISTVIEW_COLUMN * pColumn;
;;;450      unsigned NumColumns, Error = 0;
0004e2  2400              MOVS     r4,#0
;;;451      if (!hObj) {
0004e4  f1b80f00          CMP      r8,#0
0004e8  d007              BEQ      |L1.1274|
;;;452        return 1;
;;;453      }
;;;454      NumColumns = LISTVIEW_GetNumColumns(hObj);
0004ea  4640              MOV      r0,r8
0004ec  f7fffffe          BL       LISTVIEW_GetNumColumns
;;;455      if (Column >= NumColumns) {
0004f0  4285              CMP      r5,r0
0004f2  d305              BCC      |L1.1280|
;;;456        return 1;
0004f4  2001              MOVS     r0,#1
;;;457      }
;;;458      WM_LOCK();
;;;459      pObj    = LISTVIEW_H2P(hObj);
;;;460      pColumn = (LISTVIEW_COLUMN *)GUI_ARRAY_GetpItem(&pObj->ColumnArray, Column);
;;;461      if (pColumn->fpCompare) {
;;;462        pSort = _CreateSortObject(hObj, pObj);
;;;463        pObj  = LISTVIEW_H2P(hObj); /* Restore after allocating memory */
;;;464        if (pSort) {
;;;465          pObj->SortIndex = Column;
;;;466          pSort->Reverse  = Reverse;
;;;467          LISTVIEW__InvalidateInsideArea(hObj, pObj);
;;;468        } else {
;;;469          Error = 1;
;;;470        }
;;;471      } else {
;;;472        Error = 1;
;;;473      }
;;;474      WM_UNLOCK();
;;;475      return Error;
;;;476    }
0004f6  e8bd81f0          POP      {r4-r8,pc}
                  |L1.1274|
0004fa  2001              MOVS     r0,#1                 ;452
0004fc  e8bd81f0          POP      {r4-r8,pc}
                  |L1.1280|
000500  f7fffffe          BL       GUI_Lock
000504  4640              MOV      r0,r8                 ;459
000506  f7fffffe          BL       GUI_ALLOC_h2p
00050a  4606              MOV      r6,r0                 ;459
00050c  4629              MOV      r1,r5                 ;460
00050e  f106002e          ADD      r0,r6,#0x2e           ;460
000512  f7fffffe          BL       GUI_ARRAY_GetpItem
000516  6840              LDR      r0,[r0,#4]            ;461
000518  b188              CBZ      r0,|L1.1342|
00051a  4631              MOV      r1,r6                 ;462
00051c  4640              MOV      r0,r8                 ;462
00051e  f7fffffe          BL       _CreateSortObject
000522  4606              MOV      r6,r0                 ;462
000524  4640              MOV      r0,r8                 ;463
000526  f7fffffe          BL       GUI_ALLOC_h2p
00052a  b136              CBZ      r6,|L1.1338|
00052c  6685              STR      r5,[r0,#0x68]         ;465
00052e  7337              STRB     r7,[r6,#0xc]          ;466
000530  4601              MOV      r1,r0                 ;467
000532  4640              MOV      r0,r8                 ;467
000534  f7fffffe          BL       LISTVIEW__InvalidateInsideArea
000538  e002              B        |L1.1344|
                  |L1.1338|
00053a  2401              MOVS     r4,#1                 ;469
00053c  e000              B        |L1.1344|
                  |L1.1342|
00053e  2401              MOVS     r4,#1                 ;472
                  |L1.1344|
000540  f7fffffe          BL       GUI_Unlock
000544  4620              MOV      r0,r4                 ;475
000546  e8bd81f0          POP      {r4-r8,pc}
;;;477    
                          ENDP

00054a  0000              DCW      0x0000
                  |L1.1356|
                          DCD      _Free
                  |L1.1360|
                          DCD      _Sort
