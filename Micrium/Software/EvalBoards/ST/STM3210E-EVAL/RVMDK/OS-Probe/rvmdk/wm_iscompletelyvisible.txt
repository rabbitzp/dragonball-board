; generated by ARM C/C++ Compiler, 4.1 [Build 481]
; commandline ArmCC [--debug -c --asm --interleave -o.\rvmdk\wm_iscompletelyvisible.o --depend=.\rvmdk\wm_iscompletelyvisible.d --cpu=Cortex-M3 --apcs=interwork -O1 -Otime -I. -I..\BSP -I..\..\..\..\..\uCOS-II\Ports\arm-cortex-m3\Generic\RealView -I..\..\..\..\..\uCOS-II\Source -I..\..\..\..\..\CPU\ST\STM32\inc -I..\..\..\..\..\uC-CPU -I..\..\..\..\..\uC-CPU\Arm-Cortex-M3\RealView -I..\..\..\..\..\uC-LIB -I..\..\..\..\..\uC-Probe\Target\Plugins\uCOS-II -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\Source -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Ports\ST\STM32 -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Source -I..\..\..\..\..\User\inc -I..\..\..\..\..\uCGUI\Config -I..\..\..\..\..\uCGUI\GUIDemo -I..\..\..\..\..\uCGUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\AntiAlias -I..\..\..\..\..\uCGUI\GUI\ConvertColor -I..\..\..\..\..\uCGUI\GUI\ConvertMono -I..\..\..\..\..\uCGUI\GUI\Core -I..\..\..\..\..\uCGUI\GUI\Font -I..\..\..\..\..\uCGUI\GUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\MemDev -I..\..\..\..\..\uCGUI\GUI\MultiLayer -I..\..\..\..\..\uCGUI\GUI\Widget -I..\..\..\..\..\uCGUI\GUI\WM -Id:\Keil-stm32\ARM\INC -Id:\Keil-stm32\ARM\INC\ST\STM32F10x -D__MICROLIB --omf_browse=.\rvmdk\wm_iscompletelyvisible.crf ..\..\..\..\..\uCGUI\GUI\WM\WM_IsCompletelyVisible.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=1

                  _CompareRect PROC
;;;36     */
;;;37     static char _CompareRect(const GUI_RECT * pRect0, const GUI_RECT * pRect1 ) {
000000  f9b02000          LDRSH    r2,[r0,#0]
;;;38       if (pRect0->x0 != pRect1->x0) {
000004  f9b13000          LDRSH    r3,[r1,#0]
000008  429a              CMP      r2,r3
00000a  d001              BEQ      |L1.16|
;;;39         return 1;                          /* Not equal */
00000c  2001              MOVS     r0,#1
;;;40       }
;;;41       if (pRect0->x1 != pRect1->x1) {
;;;42         return 1;                          /* Not equal */
;;;43       }
;;;44       if (pRect0->y0 != pRect1->y0) {
;;;45         return 1;                          /* Not equal */
;;;46       }
;;;47       if (pRect0->y1 != pRect1->y1) {
;;;48         return 1;                          /* Not equal */
;;;49       }
;;;50       return 0;                            /* Equal */
;;;51     }
00000e  4770              BX       lr
                  |L1.16|
000010  f9b02004          LDRSH    r2,[r0,#4]            ;41
000014  f9b13004          LDRSH    r3,[r1,#4]            ;41
000018  429a              CMP      r2,r3                 ;41
00001a  d001              BEQ      |L1.32|
00001c  2001              MOVS     r0,#1                 ;42
00001e  4770              BX       lr
                  |L1.32|
000020  f9b02002          LDRSH    r2,[r0,#2]            ;44
000024  f9b13002          LDRSH    r3,[r1,#2]            ;44
000028  429a              CMP      r2,r3                 ;44
00002a  d001              BEQ      |L1.48|
00002c  2001              MOVS     r0,#1                 ;45
00002e  4770              BX       lr
                  |L1.48|
000030  f9b00006          LDRSH    r0,[r0,#6]            ;47
000034  f9b11006          LDRSH    r1,[r1,#6]            ;47
000038  4288              CMP      r0,r1                 ;47
00003a  d001              BEQ      |L1.64|
00003c  2001              MOVS     r0,#1                 ;48
00003e  4770              BX       lr
                  |L1.64|
000040  2000              MOVS     r0,#0                 ;50
000042  4770              BX       lr
;;;52     
                          ENDP

                  _WindowSiblingsOverlapRect PROC
;;;57     */
;;;58     static char _WindowSiblingsOverlapRect(WM_HWIN iWin, GUI_RECT* pRect) {
000044  b570              PUSH     {r4-r6,lr}
000046  460d              MOV      r5,r1
;;;59       WM_Obj* pWin;
;;;60       for (; iWin; iWin = pWin->hNext) { 
000048  b188              CBZ      r0,|L1.110|
                  |L1.74|
;;;61         int Status = (pWin = WM_H2P(iWin))->Status;
00004a  f7fffffe          BL       GUI_ALLOC_h2p
00004e  4604              MOV      r4,r0
000050  8b80              LDRH     r0,[r0,#0x1c]
;;;62         /* Check if this window affects us at all */    
;;;63         if (Status & WM_SF_ISVIS) {
000052  f0100f02          TST      r0,#2
000056  d006              BEQ      |L1.102|
;;;64           /* Check if this window affects us at all */    
;;;65           if (GUI_RectsIntersect(pRect, &pWin->Rect)) {
000058  4621              MOV      r1,r4
00005a  4628              MOV      r0,r5
00005c  f7fffffe          BL       GUI_RectsIntersect
000060  b108              CBZ      r0,|L1.102|
;;;66             return 1;
000062  2001              MOVS     r0,#1
;;;67           }
;;;68         }
;;;69       }
;;;70       return 0;
;;;71     }
000064  bd70              POP      {r4-r6,pc}
                  |L1.102|
000066  f9b4001a          LDRSH    r0,[r4,#0x1a]         ;60
00006a  2800              CMP      r0,#0                 ;60
00006c  d1ed              BNE      |L1.74|
                  |L1.110|
00006e  2000              MOVS     r0,#0                 ;70
000070  bd70              POP      {r4-r6,pc}
;;;72     
                          ENDP

                  _HasOverlap PROC
;;;77     */
;;;78     static int _HasOverlap(WM_Obj * pWin, GUI_RECT * pRect) {
000072  b570              PUSH     {r4-r6,lr}
000074  4604              MOV      r4,r0
000076  460d              MOV      r5,r1
;;;79       WM_Obj * pParent;
;;;80       WM_HMEM hParent;
;;;81       /* Step 1:
;;;82        Check if there are any visible children. If this is so, then the
;;;83        window has an overlap.
;;;84        */
;;;85       /* Check all children */
;;;86       if (_WindowSiblingsOverlapRect(pWin->hFirstChild, pRect)) {
000078  f9b40018          LDRSH    r0,[r4,#0x18]
00007c  4629              MOV      r1,r5
00007e  f7fffffe          BL       _WindowSiblingsOverlapRect
000082  b108              CBZ      r0,|L1.136|
;;;87         return 1;
000084  2001              MOVS     r0,#1
;;;88       }
;;;89     
;;;90       /* STEP 2:
;;;91            Find out the max. height (r.y1) if we are at the left border.
;;;92            Since we are using the same height for all IVRs at the same y0,
;;;93            we do this only for the leftmost one.
;;;94       */
;;;95     
;;;96       /* Iterate over all windows which are above */
;;;97       /* Check all siblings above (Iterate over Parents and top siblings (hNext) */
;;;98       for (hParent = pWin->hParent; hParent; hParent = pParent->hParent) {
;;;99         pParent = WM_H2P(hParent);
;;;100        if (_WindowSiblingsOverlapRect(pParent->hNext, pRect)) {
;;;101          return 1;
;;;102        }
;;;103      }
;;;104      return 0;
;;;105    }
000086  bd70              POP      {r4-r6,pc}
                  |L1.136|
000088  f9b40016          LDRSH    r0,[r4,#0x16]         ;98
00008c  b170              CBZ      r0,|L1.172|
                  |L1.142|
00008e  f7fffffe          BL       GUI_ALLOC_h2p
000092  4604              MOV      r4,r0                 ;99
000094  4629              MOV      r1,r5                 ;100
000096  f9b4001a          LDRSH    r0,[r4,#0x1a]         ;100
00009a  f7fffffe          BL       _WindowSiblingsOverlapRect
00009e  b108              CBZ      r0,|L1.164|
0000a0  2001              MOVS     r0,#1                 ;101
0000a2  bd70              POP      {r4-r6,pc}
                  |L1.164|
0000a4  f9b40016          LDRSH    r0,[r4,#0x16]         ;98
0000a8  2800              CMP      r0,#0                 ;98
0000aa  d1f0              BNE      |L1.142|
                  |L1.172|
0000ac  2000              MOVS     r0,#0                 ;104
0000ae  bd70              POP      {r4-r6,pc}
;;;106    
                          ENDP

                  _IsCompletelyVisible PROC
;;;111    */
;;;112    static char _IsCompletelyVisible(WM_HWIN hWin) {
0000b0  b530              PUSH     {r4,r5,lr}
0000b2  b083              SUB      sp,sp,#0xc
0000b4  4605              MOV      r5,r0
;;;113      WM_Obj * pWin;
;;;114      GUI_RECT Rect;
;;;115    
;;;116      pWin = WM_H2P(hWin);
0000b6  4628              MOV      r0,r5
0000b8  f7fffffe          BL       GUI_ALLOC_h2p
0000bc  4604              MOV      r4,r0
;;;117      Rect = pWin->Rect;
0000be  6861              LDR      r1,[r4,#4]
0000c0  6820              LDR      r0,[r4,#0]
0000c2  9101              STR      r1,[sp,#4]
0000c4  9000              STR      r0,[sp,#0]
;;;118      if (WM__ClipAtParentBorders(&Rect, hWin) == 0) {
0000c6  4629              MOV      r1,r5
0000c8  4668              MOV      r0,sp
0000ca  f7fffffe          BL       WM__ClipAtParentBorders
0000ce  b138              CBZ      r0,|L1.224|
;;;119        return 0;                 /* Nothing is left */
;;;120      }
;;;121      /* Check if the window is still the original one */
;;;122      if (_CompareRect(&Rect, &pWin->Rect)) {
0000d0  4621              MOV      r1,r4
0000d2  4668              MOV      r0,sp
0000d4  f7fffffe          BL       _CompareRect
0000d8  b128              CBZ      r0,|L1.230|
;;;123        return 0;                 /* Not completely visible */
;;;124      }
;;;125      /* Now the difficult part ...
;;;126         Find the rectangles.
;;;127      */
;;;128      if (_HasOverlap(pWin, &Rect)) {
;;;129        return 0;
;;;130      }
;;;131      return 1;                   /* Is completely visible */
;;;132    }
0000da  b003              ADD      sp,sp,#0xc
0000dc  2000              MOVS     r0,#0                 ;123
0000de  bd30              POP      {r4,r5,pc}
                  |L1.224|
0000e0  b003              ADD      sp,sp,#0xc
0000e2  2000              MOVS     r0,#0                 ;119
0000e4  bd30              POP      {r4,r5,pc}
                  |L1.230|
0000e6  4669              MOV      r1,sp                 ;128
0000e8  4620              MOV      r0,r4                 ;128
0000ea  f7fffffe          BL       _HasOverlap
0000ee  b110              CBZ      r0,|L1.246|
0000f0  b003              ADD      sp,sp,#0xc
0000f2  2000              MOVS     r0,#0                 ;129
0000f4  bd30              POP      {r4,r5,pc}
                  |L1.246|
0000f6  b003              ADD      sp,sp,#0xc
0000f8  2001              MOVS     r0,#1                 ;131
0000fa  bd30              POP      {r4,r5,pc}
;;;133    
                          ENDP

                  WM_IsCompletelyVisible PROC
;;;145    */
;;;146    char WM_IsCompletelyVisible(WM_HWIN hWin) {
0000fc  b570              PUSH     {r4-r6,lr}
0000fe  4605              MOV      r5,r0
;;;147      int r = 0;
000100  2400              MOVS     r4,#0
;;;148      if (hWin) {
000102  b13d              CBZ      r5,|L1.276|
;;;149        WM_LOCK();
000104  f7fffffe          BL       GUI_Lock
;;;150        r = _IsCompletelyVisible(hWin);
000108  4628              MOV      r0,r5
00010a  f7fffffe          BL       _IsCompletelyVisible
00010e  4604              MOV      r4,r0
;;;151        WM_UNLOCK();
000110  f7fffffe          BL       GUI_Unlock
                  |L1.276|
;;;152      }
;;;153      return r;
000114  b2e0              UXTB     r0,r4
;;;154    }
000116  bd70              POP      {r4-r6,pc}
;;;155    
                          ENDP

