; generated by ARM C/C++ Compiler, 4.1 [Build 481]
; commandline ArmCC [--debug -c --asm --interleave -o.\rvmdk\menu.o --depend=.\rvmdk\menu.d --cpu=Cortex-M3 --apcs=interwork -O1 -Otime -I. -I..\BSP -I..\..\..\..\..\uCOS-II\Ports\arm-cortex-m3\Generic\RealView -I..\..\..\..\..\uCOS-II\Source -I..\..\..\..\..\CPU\ST\STM32\inc -I..\..\..\..\..\uC-CPU -I..\..\..\..\..\uC-CPU\Arm-Cortex-M3\RealView -I..\..\..\..\..\uC-LIB -I..\..\..\..\..\uC-Probe\Target\Plugins\uCOS-II -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\Source -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Ports\ST\STM32 -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Source -I..\..\..\..\..\User\inc -I..\..\..\..\..\uCGUI\Config -I..\..\..\..\..\uCGUI\GUIDemo -I..\..\..\..\..\uCGUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\AntiAlias -I..\..\..\..\..\uCGUI\GUI\ConvertColor -I..\..\..\..\..\uCGUI\GUI\ConvertMono -I..\..\..\..\..\uCGUI\GUI\Core -I..\..\..\..\..\uCGUI\GUI\Font -I..\..\..\..\..\uCGUI\GUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\MemDev -I..\..\..\..\..\uCGUI\GUI\MultiLayer -I..\..\..\..\..\uCGUI\GUI\Widget -I..\..\..\..\..\uCGUI\GUI\WM -Id:\Keil-stm32\ARM\INC -Id:\Keil-stm32\ARM\INC\ST\STM32F10x -D__MICROLIB --omf_browse=.\rvmdk\menu.crf ..\..\..\..\..\uCGUI\GUI\Widget\MENU.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  MENU__SendMenuMessage PROC
;;;1338   */
;;;1339   int MENU__SendMenuMessage(MENU_Handle hObj, WM_HWIN hDestWin, U16 MsgType, U16 ItemId) {
000000  b500              PUSH     {lr}
000002  4684              MOV      r12,r0
000004  b085              SUB      sp,sp,#0x14
000006  4608              MOV      r0,r1
;;;1340     MENU_MSG_DATA MsgData;
;;;1341     WM_MESSAGE    Msg = {0};
000008  2100              MOVS     r1,#0
00000a  9102              STR      r1,[sp,#8]
;;;1342     MsgData.MsgType   = MsgType;
00000c  f8ad2010          STRH     r2,[sp,#0x10]
;;;1343     MsgData.ItemId    = ItemId;
000010  f8ad3012          STRH     r3,[sp,#0x12]
;;;1344     Msg.MsgId         = WM_MENU;
000014  212c              MOVS     r1,#0x2c
000016  9101              STR      r1,[sp,#4]
;;;1345     Msg.Data.p        = &MsgData;
000018  a904              ADD      r1,sp,#0x10
00001a  9103              STR      r1,[sp,#0xc]
;;;1346     Msg.hWinSrc       = hObj;
00001c  f8adc00a          STRH     r12,[sp,#0xa]
;;;1347     if (!hDestWin) {
000020  b910              CBNZ     r0,|L1.40|
;;;1348       hDestWin = WM_GetParent(hObj);
000022  4660              MOV      r0,r12
000024  f7fffffe          BL       WM_GetParent
                  |L1.40|
;;;1349     }
;;;1350     if (hDestWin) {
000028  b128              CBZ      r0,|L1.54|
;;;1351       WM__SendMessage(hDestWin, &Msg);
00002a  a901              ADD      r1,sp,#4
00002c  f7fffffe          BL       WM__SendMessage
;;;1352       return Msg.Data.v;
000030  9803              LDR      r0,[sp,#0xc]
;;;1353     }
;;;1354     return 0;
;;;1355   }
000032  b005              ADD      sp,sp,#0x14
000034  bd00              POP      {pc}
                  |L1.54|
000036  b005              ADD      sp,sp,#0x14
000038  2000              MOVS     r0,#0                 ;1354
00003a  bd00              POP      {pc}
;;;1356   
                          ENDP

                  _IsTopLevelMenu PROC
;;;153    */
;;;154    static char _IsTopLevelMenu(MENU_Handle hObj, const MENU_Obj* pObj) {
00003c  b510              PUSH     {r4,lr}
;;;155      if (MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_IS_MENU, 0) == 0) {
00003e  f9b1105c          LDRSH    r1,[r1,#0x5c]
000042  2300              MOVS     r3,#0
000044  2205              MOVS     r2,#5
000046  f7fffffe          BL       MENU__SendMenuMessage
00004a  b108              CBZ      r0,|L1.80|
;;;156        return 1;
;;;157      }
;;;158      return 0;
00004c  2000              MOVS     r0,#0
;;;159    }
00004e  bd10              POP      {r4,pc}
                  |L1.80|
000050  2001              MOVS     r0,#1                 ;156
000052  bd10              POP      {r4,pc}
;;;160    
                          ENDP

                  _GetTopLevelMenu PROC
;;;173    */
;;;174    static void _GetTopLevelMenu(MENU_Handle hObj, MENU_Obj * pObj, MENU_Handle * phObjTopLevel, MENU_Obj ** ppObjTopLevel, int * pSubSel) {
000054  e92d41f0          PUSH     {r4-r8,lr}
000058  4606              MOV      r6,r0
00005a  9d06              LDR      r5,[sp,#0x18]
00005c  460c              MOV      r4,r1
00005e  4617              MOV      r7,r2
000060  4698              MOV      r8,r3
;;;175      MENU_Handle hObjTopLevel;
;;;176      MENU_Obj * pObjTopLevel;
;;;177      pObjTopLevel = pObj;
;;;178      if (_IsTopLevelMenu(hObj, pObj)) {
000062  4621              MOV      r1,r4
000064  4630              MOV      r0,r6
000066  f7fffffe          BL       _IsTopLevelMenu
00006a  b950              CBNZ     r0,|L1.130|
                  |L1.108|
;;;179        hObjTopLevel = hObj;
;;;180        pObjTopLevel = pObj;
;;;181      } else {
;;;182        do {
;;;183          hObjTopLevel = pObjTopLevel->hOwner;
00006c  f9b4605c          LDRSH    r6,[r4,#0x5c]
;;;184          pObjTopLevel = (MENU_Obj *)GUI_ALLOC_h2p(hObjTopLevel);
000070  4630              MOV      r0,r6
000072  f7fffffe          BL       GUI_ALLOC_h2p
000076  4604              MOV      r4,r0
;;;185          if (_IsTopLevelMenu(hObjTopLevel, pObjTopLevel)) {
000078  4621              MOV      r1,r4
00007a  4630              MOV      r0,r6
00007c  f7fffffe          BL       _IsTopLevelMenu
000080  b120              CBZ      r0,|L1.140|
                  |L1.130|
;;;186            break;
;;;187          } else {
;;;188            if (pSubSel) {
;;;189              *pSubSel = pObjTopLevel->Sel;
;;;190            }
;;;191          }
;;;192        } while (1);
;;;193      }
;;;194      *phObjTopLevel = hObjTopLevel;
000082  803e              STRH     r6,[r7,#0]
;;;195      *ppObjTopLevel = pObjTopLevel;
000084  f8c84000          STR      r4,[r8,#0]
;;;196    }
000088  e8bd81f0          POP      {r4-r8,pc}
                  |L1.140|
00008c  2d00              CMP      r5,#0                 ;188
00008e  d0ed              BEQ      |L1.108|
000090  6ee0              LDR      r0,[r4,#0x6c]         ;189
000092  6028              STR      r0,[r5,#0]            ;189
000094  e7ea              B        |L1.108|
;;;197    
                          ENDP

                  _HasEffect PROC
;;;201    */
;;;202    static int _HasEffect(MENU_Handle hObj, MENU_Obj* pObj) {
000096  b510              PUSH     {r4,lr}
;;;203      if (!(pObj->Flags & MENU_SF_POPUP)) {
000098  f8b1205e          LDRH     r2,[r1,#0x5e]
00009c  f0120f80          TST      r2,#0x80
0000a0  d104              BNE      |L1.172|
;;;204        if (_IsTopLevelMenu(hObj, pObj)) {
0000a2  f7fffffe          BL       _IsTopLevelMenu
0000a6  b108              CBZ      r0,|L1.172|
;;;205          return 0;
0000a8  2000              MOVS     r0,#0
;;;206        }
;;;207      }
;;;208      return 1;
;;;209    }
0000aa  bd10              POP      {r4,pc}
                  |L1.172|
0000ac  2001              MOVS     r0,#1                 ;208
0000ae  bd10              POP      {r4,pc}
;;;210    
                          ENDP

                  _GetEffectSize PROC
;;;214    */
;;;215    static int _GetEffectSize(MENU_Handle hObj, MENU_Obj* pObj) {
0000b0  b570              PUSH     {r4-r6,lr}
0000b2  460d              MOV      r5,r1
;;;216      int r = 0;
0000b4  2400              MOVS     r4,#0
;;;217      if (_HasEffect(hObj, pObj)) { 
0000b6  4629              MOV      r1,r5
0000b8  f7fffffe          BL       _HasEffect
0000bc  b108              CBZ      r0,|L1.194|
;;;218        r = pObj->Widget.pEffect->EffectSize;
0000be  6a28              LDR      r0,[r5,#0x20]
0000c0  6944              LDR      r4,[r0,#0x14]
                  |L1.194|
;;;219      }
;;;220      return r;
0000c2  4620              MOV      r0,r4
;;;221    }
0000c4  bd70              POP      {r4-r6,pc}
;;;222    
                          ENDP

                  _CalcTextWidth PROC
;;;226    */
;;;227    static int _CalcTextWidth(MENU_Obj* pObj, const char GUI_UNI_PTR* sText) {
0000c6  b570              PUSH     {r4-r6,lr}
0000c8  460d              MOV      r5,r1
;;;228      int TextWidth = 0;
0000ca  2400              MOVS     r4,#0
;;;229      if (sText) {
0000cc  b155              CBZ      r5,|L1.228|
;;;230        const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;231        pOldFont  = GUI_SetFont(pObj->Props.pFont);
0000ce  6d40              LDR      r0,[r0,#0x54]
0000d0  f7fffffe          BL       GUI_SetFont
0000d4  4606              MOV      r6,r0
;;;232        TextWidth = GUI_GetStringDistX(sText);
0000d6  4628              MOV      r0,r5
0000d8  f7fffffe          BL       GUI_GetStringDistX
0000dc  4604              MOV      r4,r0
;;;233        GUI_SetFont(pOldFont);
0000de  4630              MOV      r0,r6
0000e0  f7fffffe          BL       GUI_SetFont
                  |L1.228|
;;;234      }
;;;235      return TextWidth;
0000e4  4620              MOV      r0,r4
;;;236    }
0000e6  bd70              POP      {r4-r6,pc}
;;;237    
                          ENDP

                  _GetItemWidth PROC
;;;241    */
;;;242    static int _GetItemWidth(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
0000e8  b510              PUSH     {r4,lr}
0000ea  460c              MOV      r4,r1
;;;243      int ItemWidth;
;;;244      if (pObj->Width && (pObj->Flags & MENU_SF_VERTICAL)) {
0000ec  6e61              LDR      r1,[r4,#0x64]
0000ee  b159              CBZ      r1,|L1.264|
0000f0  f8b4105e          LDRH     r1,[r4,#0x5e]
0000f4  f0110f01          TST      r1,#1
0000f8  d006              BEQ      |L1.264|
;;;245        ItemWidth = pObj->Width - (_GetEffectSize(hObj, pObj) << 1);
0000fa  4621              MOV      r1,r4
0000fc  f7fffffe          BL       _GetEffectSize
000100  6e61              LDR      r1,[r4,#0x64]
000102  eba10040          SUB      r0,r1,r0,LSL #1
;;;246      } else {
;;;247        MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
;;;248        if ((pObj->Flags & MENU_SF_VERTICAL) || !(pItem->Flags & MENU_IF_SEPARATOR)) {
;;;249          ItemWidth = pItem->TextWidth;
;;;250        } else {
;;;251          ItemWidth = 3;
;;;252       }
;;;253        ItemWidth += pObj->Props.aBorder[MENU_BI_LEFT] + pObj->Props.aBorder[MENU_BI_RIGHT];
;;;254      }
;;;255      return ItemWidth;
;;;256    }
000106  bd10              POP      {r4,pc}
                  |L1.264|
000108  4611              MOV      r1,r2                 ;247
00010a  f1040058          ADD      r0,r4,#0x58           ;247
00010e  f7fffffe          BL       GUI_ARRAY_GetpItem
000112  f8b4105e          LDRH     r1,[r4,#0x5e]         ;248
000116  f0110f01          TST      r1,#1                 ;248
00011a  d10b              BNE      |L1.308|
00011c  8881              LDRH     r1,[r0,#4]            ;248
00011e  f0110f02          TST      r1,#2                 ;248
000122  d007              BEQ      |L1.308|
000124  2003              MOVS     r0,#3                 ;251
                  |L1.294|
000126  f8941050          LDRB     r1,[r4,#0x50]         ;253
00012a  f8942051          LDRB     r2,[r4,#0x51]         ;253
00012e  4411              ADD      r1,r1,r2              ;253
000130  4408              ADD      r0,r0,r1              ;253
000132  bd10              POP      {r4,pc}
                  |L1.308|
000134  6880              LDR      r0,[r0,#8]            ;249
000136  e7f6              B        |L1.294|
;;;257    
                          ENDP

                  _GetItemHeight PROC
;;;261    */
;;;262    static int _GetItemHeight(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000138  b570              PUSH     {r4-r6,lr}
00013a  460c              MOV      r4,r1
00013c  4616              MOV      r6,r2
;;;263      int ItemHeight;
;;;264      if (pObj->Height && !(pObj->Flags & MENU_SF_VERTICAL)) {
00013e  6ea1              LDR      r1,[r4,#0x68]
000140  b121              CBZ      r1,|L1.332|
000142  f8b4105e          LDRH     r1,[r4,#0x5e]
000146  f0110f01          TST      r1,#1
00014a  d019              BEQ      |L1.384|
                  |L1.332|
;;;265        ItemHeight = pObj->Height - (_GetEffectSize(hObj, pObj) << 1);
;;;266      } else {
;;;267        ItemHeight = GUI_GetYDistOfFont(pObj->Props.pFont);
00014c  6d60              LDR      r0,[r4,#0x54]
00014e  f7fffffe          BL       GUI_GetYDistOfFont
000152  4605              MOV      r5,r0
;;;268        if (pObj->Flags & MENU_SF_VERTICAL) {
000154  f8b4005e          LDRH     r0,[r4,#0x5e]
000158  f0100f01          TST      r0,#1
00015c  d009              BEQ      |L1.370|
;;;269          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00015e  4631              MOV      r1,r6
000160  f1040058          ADD      r0,r4,#0x58
000164  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;270          if (pItem->Flags & MENU_IF_SEPARATOR) {
000168  8880              LDRH     r0,[r0,#4]
00016a  f0100f02          TST      r0,#2
00016e  d000              BEQ      |L1.370|
;;;271            ItemHeight = 3;
000170  2503              MOVS     r5,#3
                  |L1.370|
;;;272          }
;;;273        }
;;;274        ItemHeight += pObj->Props.aBorder[MENU_BI_TOP] + pObj->Props.aBorder[MENU_BI_BOTTOM];
000172  f8940052          LDRB     r0,[r4,#0x52]
000176  f8941053          LDRB     r1,[r4,#0x53]
00017a  4408              ADD      r0,r0,r1
00017c  4428              ADD      r0,r0,r5
;;;275      }
;;;276      return ItemHeight;
;;;277    }
00017e  bd70              POP      {r4-r6,pc}
                  |L1.384|
000180  4621              MOV      r1,r4                 ;265
000182  f7fffffe          BL       _GetEffectSize
000186  6ea1              LDR      r1,[r4,#0x68]         ;265
000188  eba10040          SUB      r0,r1,r0,LSL #1       ;265
00018c  bd70              POP      {r4-r6,pc}
;;;278    
                          ENDP

                  MENU__GetNumItems PROC
;;;1253   */
;;;1254   unsigned MENU__GetNumItems(MENU_Obj* pObj) {
00018e  3058              ADDS     r0,r0,#0x58
;;;1255     return GUI_ARRAY_GetNumItems(&pObj->ItemArray);
000190  f7ffbffe          B.W      GUI_ARRAY_GetNumItems
;;;1256   }
;;;1257   
                          ENDP

                  _CalcMenuSizeX PROC
;;;282    */
;;;283    static int _CalcMenuSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
000194  e92d41f0          PUSH     {r4-r8,lr}
000198  4680              MOV      r8,r0
00019a  460f              MOV      r7,r1
;;;284      unsigned i, NumItems = MENU__GetNumItems(pObj);
00019c  4638              MOV      r0,r7
00019e  f7fffffe          BL       MENU__GetNumItems
0001a2  4606              MOV      r6,r0
;;;285      int xSize = 0;
0001a4  2400              MOVS     r4,#0
;;;286      if (pObj->Flags & MENU_SF_VERTICAL) {
0001a6  f8b7005e          LDRH     r0,[r7,#0x5e]
0001aa  f0100f01          TST      r0,#1
0001ae  d00e              BEQ      |L1.462|
;;;287        int ItemWidth;
;;;288        for (i = 0; i < NumItems; i++) {
0001b0  2500              MOVS     r5,#0
0001b2  2e00              CMP      r6,#0
0001b4  d917              BLS      |L1.486|
                  |L1.438|
;;;289          ItemWidth = _GetItemWidth(hObj, pObj, i);
0001b6  462a              MOV      r2,r5
0001b8  4639              MOV      r1,r7
0001ba  4640              MOV      r0,r8
0001bc  f7fffffe          BL       _GetItemWidth
;;;290          if (ItemWidth > xSize) {
0001c0  42a0              CMP      r0,r4
0001c2  dd00              BLE      |L1.454|
;;;291            xSize = ItemWidth;
0001c4  4604              MOV      r4,r0
                  |L1.454|
0001c6  1c6d              ADDS     r5,r5,#1              ;288
0001c8  42b5              CMP      r5,r6                 ;288
0001ca  d3f4              BCC      |L1.438|
0001cc  e00b              B        |L1.486|
                  |L1.462|
;;;292          }
;;;293        }
;;;294      } else {
;;;295        for (i = 0; i < NumItems; i++) {
0001ce  2500              MOVS     r5,#0
0001d0  2e00              CMP      r6,#0
0001d2  d908              BLS      |L1.486|
                  |L1.468|
;;;296          xSize += _GetItemWidth(hObj, pObj, i);
0001d4  462a              MOV      r2,r5
0001d6  4639              MOV      r1,r7
0001d8  4640              MOV      r0,r8
0001da  f7fffffe          BL       _GetItemWidth
0001de  4404              ADD      r4,r4,r0
0001e0  1c6d              ADDS     r5,r5,#1              ;295
0001e2  42b5              CMP      r5,r6                 ;295
0001e4  d3f6              BCC      |L1.468|
                  |L1.486|
;;;297        }
;;;298      }
;;;299      xSize += (_GetEffectSize(hObj, pObj) << 1);
0001e6  4639              MOV      r1,r7
0001e8  4640              MOV      r0,r8
0001ea  f7fffffe          BL       _GetEffectSize
0001ee  eb040040          ADD      r0,r4,r0,LSL #1
;;;300      return xSize;
;;;301    }
0001f2  e8bd81f0          POP      {r4-r8,pc}
;;;302    
                          ENDP

                  _CalcMenuSizeY PROC
;;;306    */
;;;307    static int _CalcMenuSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
0001f6  e92d41f0          PUSH     {r4-r8,lr}
0001fa  4680              MOV      r8,r0
0001fc  460f              MOV      r7,r1
;;;308      unsigned i, NumItems = MENU__GetNumItems(pObj);
0001fe  4638              MOV      r0,r7
000200  f7fffffe          BL       MENU__GetNumItems
000204  4606              MOV      r6,r0
;;;309      int ySize = 0;
000206  2400              MOVS     r4,#0
;;;310      if (pObj->Flags & MENU_SF_VERTICAL) {
000208  f8b7005e          LDRH     r0,[r7,#0x5e]
00020c  f0100f01          TST      r0,#1
000210  d00c              BEQ      |L1.556|
;;;311        for (i = 0; i < NumItems; i++) {
000212  2500              MOVS     r5,#0
000214  2e00              CMP      r6,#0
000216  d917              BLS      |L1.584|
                  |L1.536|
;;;312          ySize += _GetItemHeight(hObj, pObj, i);
000218  462a              MOV      r2,r5
00021a  4639              MOV      r1,r7
00021c  4640              MOV      r0,r8
00021e  f7fffffe          BL       _GetItemHeight
000222  4404              ADD      r4,r4,r0
000224  1c6d              ADDS     r5,r5,#1              ;311
000226  42b5              CMP      r5,r6                 ;311
000228  d3f6              BCC      |L1.536|
00022a  e00d              B        |L1.584|
                  |L1.556|
;;;313        }
;;;314      } else {
;;;315        int ItemHeight;
;;;316        for (i = 0; i < NumItems; i++) {
00022c  2500              MOVS     r5,#0
00022e  2e00              CMP      r6,#0
000230  d90a              BLS      |L1.584|
                  |L1.562|
;;;317          ItemHeight = _GetItemHeight(hObj, pObj, i);
000232  462a              MOV      r2,r5
000234  4639              MOV      r1,r7
000236  4640              MOV      r0,r8
000238  f7fffffe          BL       _GetItemHeight
;;;318          if (ItemHeight > ySize) {
00023c  42a0              CMP      r0,r4
00023e  dd00              BLE      |L1.578|
;;;319            ySize = ItemHeight;
000240  4604              MOV      r4,r0
                  |L1.578|
000242  1c6d              ADDS     r5,r5,#1              ;316
000244  42b5              CMP      r5,r6                 ;316
000246  d3f4              BCC      |L1.562|
                  |L1.584|
;;;320          }
;;;321        }
;;;322      }
;;;323      ySize += (_GetEffectSize(hObj, pObj) << 1);
000248  4639              MOV      r1,r7
00024a  4640              MOV      r0,r8
00024c  f7fffffe          BL       _GetEffectSize
000250  eb040040          ADD      r0,r4,r0,LSL #1
;;;324      return ySize;
;;;325    }
000254  e8bd81f0          POP      {r4-r8,pc}
;;;326    
                          ENDP

                  _CalcWindowSizeX PROC
;;;330    */
;;;331    static int _CalcWindowSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
000258  4602              MOV      r2,r0
;;;332      int xSize = pObj->Width;
00025a  6e48              LDR      r0,[r1,#0x64]
;;;333      if (xSize == 0) {
00025c  2800              CMP      r0,#0
00025e  d101              BNE      |L1.612|
;;;334        xSize = _CalcMenuSizeX(hObj, pObj);
000260  4610              MOV      r0,r2
000262  e7fe              B        _CalcMenuSizeX
                  |L1.612|
;;;335      }
;;;336      return xSize;
;;;337    }
000264  4770              BX       lr
;;;338    
                          ENDP

                  _CalcWindowSizeY PROC
;;;342    */
;;;343    static int _CalcWindowSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
000266  4602              MOV      r2,r0
;;;344      int ySize = pObj->Height;
000268  6e88              LDR      r0,[r1,#0x68]
;;;345      if (ySize == 0) {
00026a  2800              CMP      r0,#0
00026c  d101              BNE      |L1.626|
;;;346        ySize = _CalcMenuSizeY(hObj, pObj);
00026e  4610              MOV      r0,r2
000270  e7fe              B        _CalcMenuSizeY
                  |L1.626|
;;;347      }
;;;348      return ySize;
;;;349    }
000272  4770              BX       lr
;;;350    
                          ENDP

                  _GetItemFromPos PROC
;;;361    */
;;;362    static int _GetItemFromPos(MENU_Handle hObj, MENU_Obj* pObj, int x, int y) {
000274  e92d5ff0          PUSH     {r4-r12,lr}
000278  4681              MOV      r9,r0
00027a  460f              MOV      r7,r1
00027c  4692              MOV      r10,r2
00027e  461e              MOV      r6,r3
;;;363      int xSize, ySize, EffectSize, r = -1;
000280  f04f38ff          MOV      r8,#0xffffffff
;;;364      ySize = _CalcMenuSizeY(hObj, pObj);
000284  4639              MOV      r1,r7
000286  4648              MOV      r0,r9
000288  f7fffffe          BL       _CalcMenuSizeY
00028c  4605              MOV      r5,r0
;;;365      if ((pObj->Height) && (pObj->Height < ySize)) {
00028e  6eb8              LDR      r0,[r7,#0x68]
000290  b110              CBZ      r0,|L1.664|
000292  42a8              CMP      r0,r5
000294  da00              BGE      |L1.664|
;;;366        ySize = pObj->Height;
000296  4605              MOV      r5,r0
                  |L1.664|
;;;367      }
;;;368      xSize = _CalcMenuSizeX(hObj, pObj);
000298  4639              MOV      r1,r7
00029a  4648              MOV      r0,r9
00029c  f7fffffe          BL       _CalcMenuSizeX
0002a0  4604              MOV      r4,r0
;;;369      if ((pObj->Width) && (pObj->Width < xSize)) {
0002a2  6e78              LDR      r0,[r7,#0x64]
0002a4  b110              CBZ      r0,|L1.684|
0002a6  42a0              CMP      r0,r4
0002a8  da00              BGE      |L1.684|
;;;370        xSize = pObj->Width;
0002aa  4604              MOV      r4,r0
                  |L1.684|
;;;371      }
;;;372      EffectSize = _GetEffectSize(hObj, pObj);
0002ac  4639              MOV      r1,r7
0002ae  4648              MOV      r0,r9
0002b0  f7fffffe          BL       _GetEffectSize
;;;373      x     -= EffectSize;
0002b4  ebaa0a00          SUB      r10,r10,r0
;;;374      y     -= EffectSize;
0002b8  eba60b00          SUB      r11,r6,r0
;;;375      xSize -= (EffectSize << 1);
0002bc  eba40140          SUB      r1,r4,r0,LSL #1
;;;376      ySize -= (EffectSize << 1);
0002c0  eba50040          SUB      r0,r5,r0,LSL #1
;;;377      if ((x >= 0) && (y >= 0) && (x < xSize) && (y < ySize)) {
0002c4  f1ba0f00          CMP      r10,#0
0002c8  db32              BLT      |L1.816|
0002ca  f1bb0f00          CMP      r11,#0
0002ce  db2f              BLT      |L1.816|
0002d0  458a              CMP      r10,r1
0002d2  da2d              BGE      |L1.816|
0002d4  4583              CMP      r11,r0
0002d6  da2b              BGE      |L1.816|
;;;378        unsigned i, NumItems = MENU__GetNumItems(pObj);
0002d8  4638              MOV      r0,r7
0002da  f7fffffe          BL       MENU__GetNumItems
0002de  4606              MOV      r6,r0
;;;379        if (pObj->Flags & MENU_SF_VERTICAL) {
0002e0  f8b7005e          LDRH     r0,[r7,#0x5e]
0002e4  f0100f01          TST      r0,#1
0002e8  d011              BEQ      |L1.782|
;;;380          int yPos = 0;
0002ea  2500              MOVS     r5,#0
;;;381          for (i = 0; i < NumItems; i++) {
0002ec  2400              MOVS     r4,#0
0002ee  2e00              CMP      r6,#0
0002f0  d91e              BLS      |L1.816|
                  |L1.754|
;;;382            yPos += _GetItemHeight(hObj, pObj, i);
0002f2  4622              MOV      r2,r4
0002f4  4639              MOV      r1,r7
0002f6  4648              MOV      r0,r9
0002f8  f7fffffe          BL       _GetItemHeight
0002fc  4405              ADD      r5,r5,r0
;;;383            if (y < yPos) {
0002fe  45ab              CMP      r11,r5
000300  da01              BGE      |L1.774|
;;;384              r = i;
000302  46a0              MOV      r8,r4
;;;385              break;
000304  e014              B        |L1.816|
                  |L1.774|
000306  1c64              ADDS     r4,r4,#1              ;381
000308  42b4              CMP      r4,r6                 ;381
00030a  d3f2              BCC      |L1.754|
00030c  e010              B        |L1.816|
                  |L1.782|
;;;386            }
;;;387          }
;;;388        } else {
;;;389          int xPos = 0;
00030e  2500              MOVS     r5,#0
;;;390          for (i = 0; i < NumItems; i++) {
000310  2400              MOVS     r4,#0
000312  2e00              CMP      r6,#0
000314  d90c              BLS      |L1.816|
                  |L1.790|
;;;391            xPos += _GetItemWidth(hObj, pObj, i);
000316  4622              MOV      r2,r4
000318  4639              MOV      r1,r7
00031a  4648              MOV      r0,r9
00031c  f7fffffe          BL       _GetItemWidth
000320  4405              ADD      r5,r5,r0
;;;392            if (x < xPos) {
000322  45aa              CMP      r10,r5
000324  da01              BGE      |L1.810|
;;;393              r = i;
000326  46a0              MOV      r8,r4
;;;394              break;
000328  e002              B        |L1.816|
                  |L1.810|
00032a  1c64              ADDS     r4,r4,#1              ;390
00032c  42b4              CMP      r4,r6                 ;390
00032e  d3f2              BCC      |L1.790|
                  |L1.816|
;;;395            }
;;;396          }
;;;397        }
;;;398      }
;;;399      return r;
000330  4640              MOV      r0,r8
;;;400    }
000332  e8bd9ff0          POP      {r4-r12,pc}
;;;401    
                          ENDP

                  _GetItemPos PROC
;;;405    */
;;;406    static void _GetItemPos(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, int* px, int* py) {
000336  e92d5ff0          PUSH     {r4-r12,lr}
00033a  4682              MOV      r10,r0
00033c  9f0a              LDR      r7,[sp,#0x28]
00033e  4689              MOV      r9,r1
000340  4615              MOV      r5,r2
000342  4698              MOV      r8,r3
;;;407      int i, EffectSize;
;;;408      EffectSize = _GetEffectSize(hObj, pObj);
000344  4649              MOV      r1,r9
000346  4650              MOV      r0,r10
000348  f7fffffe          BL       _GetEffectSize
00034c  4606              MOV      r6,r0
;;;409      if (pObj->Flags & MENU_SF_VERTICAL) {
00034e  f8b9005e          LDRH     r0,[r9,#0x5e]
000352  f0100f01          TST      r0,#1
000356  d014              BEQ      |L1.898|
;;;410        int yPos = 0;
000358  f04f0b00          MOV      r11,#0
;;;411        for (i = 0; i < (int)Index; i++) {
00035c  2400              MOVS     r4,#0
00035e  2d00              CMP      r5,#0
000360  dd08              BLE      |L1.884|
                  |L1.866|
;;;412          yPos += _GetItemHeight(hObj, pObj, i);
000362  4622              MOV      r2,r4
000364  4649              MOV      r1,r9
000366  4650              MOV      r0,r10
000368  f7fffffe          BL       _GetItemHeight
00036c  4483              ADD      r11,r11,r0
00036e  1c64              ADDS     r4,r4,#1              ;411
000370  42ac              CMP      r4,r5                 ;411
000372  dbf6              BLT      |L1.866|
                  |L1.884|
;;;413        }
;;;414        *px = EffectSize;
000374  f8c86000          STR      r6,[r8,#0]
;;;415        *py = EffectSize + yPos;
000378  eb06000b          ADD      r0,r6,r11
00037c  6038              STR      r0,[r7,#0]
;;;416      } else {
;;;417        int xPos = 0;
;;;418        for (i = 0; i < (int)Index; i++) {
;;;419          xPos += _GetItemWidth(hObj, pObj, i);
;;;420        }
;;;421        *px = EffectSize + xPos;
;;;422        *py = EffectSize;
;;;423      }
;;;424    }
00037e  e8bd9ff0          POP      {r4-r12,pc}
                  |L1.898|
000382  f04f0b00          MOV      r11,#0                ;417
000386  2400              MOVS     r4,#0                 ;418
000388  2d00              CMP      r5,#0                 ;418
00038a  dd08              BLE      |L1.926|
                  |L1.908|
00038c  4622              MOV      r2,r4                 ;419
00038e  4649              MOV      r1,r9                 ;419
000390  4650              MOV      r0,r10                ;419
000392  f7fffffe          BL       _GetItemWidth
000396  4483              ADD      r11,r11,r0            ;419
000398  1c64              ADDS     r4,r4,#1              ;418
00039a  42ac              CMP      r4,r5                 ;418
00039c  dbf6              BLT      |L1.908|
                  |L1.926|
00039e  eb06000b          ADD      r0,r6,r11             ;421
0003a2  f8c80000          STR      r0,[r8,#0]            ;421
0003a6  603e              STR      r6,[r7,#0]            ;422
0003a8  e8bd9ff0          POP      {r4-r12,pc}
;;;425    
                          ENDP

                  _SetCapture PROC
;;;429    */
;;;430    static void _SetCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
0003ac  b510              PUSH     {r4,lr}
0003ae  4604              MOV      r4,r0
;;;431      if (pObj->IsSubmenuActive == 0) {
0003b0  f8910060          LDRB     r0,[r1,#0x60]
0003b4  2800              CMP      r0,#0
0003b6  d10a              BNE      |L1.974|
;;;432        if (WM_HasCaptured(hObj) == 0) {
0003b8  4620              MOV      r0,r4
0003ba  f7fffffe          BL       WM_HasCaptured
0003be  2800              CMP      r0,#0
0003c0  d105              BNE      |L1.974|
;;;433          WM_SetCapture(hObj, 0);
0003c2  4620              MOV      r0,r4
0003c4  e8bd4010          POP      {r4,lr}
0003c8  2100              MOVS     r1,#0
0003ca  f7ffbffe          B.W      WM_SetCapture
                  |L1.974|
;;;434        }
;;;435      }
;;;436    }
0003ce  bd10              POP      {r4,pc}
;;;437    
                          ENDP

                  _ReleaseCapture PROC
;;;441    */
;;;442    static void _ReleaseCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
0003d0  b570              PUSH     {r4-r6,lr}
0003d2  4605              MOV      r5,r0
0003d4  460c              MOV      r4,r1
;;;443      if (WM_HasCaptured(hObj)) {
0003d6  4628              MOV      r0,r5
0003d8  f7fffffe          BL       WM_HasCaptured
0003dc  2800              CMP      r0,#0
0003de  d00e              BEQ      |L1.1022|
;;;444        if (_IsTopLevelMenu(hObj, pObj) && !(pObj->Flags & MENU_SF_POPUP)) {
0003e0  4621              MOV      r1,r4
0003e2  4628              MOV      r0,r5
0003e4  f7fffffe          BL       _IsTopLevelMenu
0003e8  2800              CMP      r0,#0
0003ea  d008              BEQ      |L1.1022|
0003ec  f8b4005e          LDRH     r0,[r4,#0x5e]
0003f0  f0100f80          TST      r0,#0x80
0003f4  d103              BNE      |L1.1022|
;;;445          WM_ReleaseCapture();
0003f6  e8bd4070          POP      {r4-r6,lr}
0003fa  f7ffbffe          B.W      WM_ReleaseCapture
                  |L1.1022|
;;;446        }
;;;447      }
;;;448    }
0003fe  bd70              POP      {r4-r6,pc}
;;;449    
                          ENDP

                  MENU__InvalidateItem PROC
;;;1261   */
;;;1262   void MENU__InvalidateItem(MENU_Handle hObj, const MENU_Obj* pObj, unsigned Index) {
000400  f7ffbffe          B.W      WM_InvalidateWindow
;;;1263     GUI_USE_PARA(pObj);
;;;1264     GUI_USE_PARA(Index);
;;;1265     WM_InvalidateWindow(hObj);  /* Can be optimized, no need to invalidate all items */
;;;1266   }
;;;1267   
                          ENDP

                  _CloseSubmenu PROC
;;;453    */
;;;454    static void _CloseSubmenu(MENU_Handle hObj, MENU_Obj* pObj) {
000404  b570              PUSH     {r4-r6,lr}
000406  4606              MOV      r6,r0
000408  460c              MOV      r4,r1
;;;455      if (pObj->Flags & MENU_SF_ACTIVE) {
00040a  f8b4005e          LDRH     r0,[r4,#0x5e]
00040e  f0100f40          TST      r0,#0x40
000412  d021              BEQ      |L1.1112|
;;;456        if (pObj->IsSubmenuActive) {
000414  f8940060          LDRB     r0,[r4,#0x60]
000418  2800              CMP      r0,#0
00041a  d01d              BEQ      |L1.1112|
;;;457          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, pObj->Sel);
00041c  f1040058          ADD      r0,r4,#0x58
000420  6ee1              LDR      r1,[r4,#0x6c]
000422  f7fffffe          BL       GUI_ARRAY_GetpItem
000426  4605              MOV      r5,r0
;;;458          /* Inform submenu about its deactivation and detach it */
;;;459          MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_CLOSE, 0);
000428  2300              MOVS     r3,#0
00042a  f9b51000          LDRSH    r1,[r5,#0]
00042e  2204              MOVS     r2,#4
000430  4630              MOV      r0,r6
000432  f7fffffe          BL       MENU__SendMenuMessage
;;;460          WM_DetachWindow(pItem->hSubmenu);
000436  f9b50000          LDRSH    r0,[r5,#0]
00043a  f7fffffe          BL       WM_DetachWindow
;;;461          pObj->IsSubmenuActive = 0;
00043e  2000              MOVS     r0,#0
000440  f8840060          STRB     r0,[r4,#0x60]
;;;462          /*
;;;463           * Keep capture in menu widget. The capture may only released
;;;464           * by clicking outside the menu or when mouse moved out.
;;;465           * And it may only released from a top level menu.
;;;466           */
;;;467          _SetCapture(hObj, pObj);
000444  4621              MOV      r1,r4
000446  4630              MOV      r0,r6
000448  f7fffffe          BL       _SetCapture
;;;468          /* Invalidate menu item. This is needed because the appearance may have changed */
;;;469          MENU__InvalidateItem(hObj, pObj, pObj->Sel);
00044c  4621              MOV      r1,r4
00044e  4630              MOV      r0,r6
000450  6ee2              LDR      r2,[r4,#0x6c]
000452  e8bd4070          POP      {r4-r6,lr}
000456  e7fe              B        MENU__InvalidateItem
                  |L1.1112|
;;;470        }
;;;471      }
;;;472    }
000458  bd70              POP      {r4-r6,pc}
;;;473    
                          ENDP

                  MENU_SetOwner PROC
;;;1390   */
;;;1391   void MENU_SetOwner(MENU_Handle hObj, WM_HWIN hOwner) {
00045a  b570              PUSH     {r4-r6,lr}
00045c  4605              MOV      r5,r0
00045e  460c              MOV      r4,r1
;;;1392     if (hObj) {
000460  2d00              CMP      r5,#0
000462  d00b              BEQ      |L1.1148|
;;;1393       MENU_Obj* pObj;
;;;1394       WM_LOCK();
000464  f7fffffe          BL       GUI_Lock
;;;1395       pObj = MENU_H2P(hObj);
000468  4628              MOV      r0,r5
00046a  f7fffffe          BL       GUI_ALLOC_h2p
;;;1396       if (pObj) {
00046e  b108              CBZ      r0,|L1.1140|
;;;1397         pObj->hOwner = hOwner;
000470  f8a0405c          STRH     r4,[r0,#0x5c]
                  |L1.1140|
;;;1398       }
;;;1399       WM_UNLOCK();
000474  e8bd4070          POP      {r4-r6,lr}
000478  f7ffbffe          B.W      GUI_Unlock
                  |L1.1148|
;;;1400     }
;;;1401   }
00047c  bd70              POP      {r4-r6,pc}
;;;1402   
                          ENDP

                  _OpenSubmenu PROC
;;;477    */
;;;478    static void _OpenSubmenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
00047e  e92d47f0          PUSH     {r4-r10,lr}
000482  b084              SUB      sp,sp,#0x10
000484  4680              MOV      r8,r0
000486  460c              MOV      r4,r1
000488  4691              MOV      r9,r2
;;;479      if (pObj->Flags & MENU_SF_ACTIVE) {
00048a  f8b4005e          LDRH     r0,[r4,#0x5e]
00048e  f0100f40          TST      r0,#0x40
000492  d07e              BEQ      |L1.1426|
;;;480        MENU_ITEM* pItem;
;;;481        char PrevActiveSubmenu;
;;;482        PrevActiveSubmenu = pObj->IsSubmenuActive;
000494  f8947060          LDRB     r7,[r4,#0x60]
;;;483        /* Close previous submenu (if needed) */
;;;484        _CloseSubmenu(hObj, pObj);
000498  4621              MOV      r1,r4
00049a  4640              MOV      r0,r8
00049c  f7fffffe          BL       _CloseSubmenu
;;;485        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
0004a0  4649              MOV      r1,r9
0004a2  f1040058          ADD      r0,r4,#0x58
0004a6  f7fffffe          BL       GUI_ARRAY_GetpItem
0004aa  4605              MOV      r5,r0
;;;486        if (pItem->hSubmenu) {
0004ac  8828              LDRH     r0,[r5,#0]
0004ae  2800              CMP      r0,#0
0004b0  d078              BEQ      |L1.1444|
;;;487          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
0004b2  88a8              LDRH     r0,[r5,#4]
0004b4  f0100f01          TST      r0,#1
0004b8  d174              BNE      |L1.1444|
;;;488            int x, y, EffectSize;
;;;489            /* Calculate position of submenu */
;;;490            EffectSize = _GetEffectSize(hObj, pObj);
0004ba  4621              MOV      r1,r4
0004bc  4640              MOV      r0,r8
0004be  f7fffffe          BL       _GetEffectSize
0004c2  4606              MOV      r6,r0
;;;491            _GetItemPos(hObj, pObj, Index, &x, &y);
0004c4  ab02              ADD      r3,sp,#8
0004c6  9300              STR      r3,[sp,#0]
0004c8  ab03              ADD      r3,sp,#0xc
0004ca  464a              MOV      r2,r9
0004cc  4621              MOV      r1,r4
0004ce  4640              MOV      r0,r8
0004d0  f7fffffe          BL       _GetItemPos
;;;492            if (pObj->Flags & MENU_SF_VERTICAL) {
0004d4  f8b4005e          LDRH     r0,[r4,#0x5e]
0004d8  f0100f01          TST      r0,#1
0004dc  d011              BEQ      |L1.1282|
;;;493              x += _CalcMenuSizeX(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
0004de  4621              MOV      r1,r4
0004e0  4640              MOV      r0,r8
0004e2  f7fffffe          BL       _CalcMenuSizeX
0004e6  4682              MOV      r10,r0
0004e8  4621              MOV      r1,r4
0004ea  4640              MOV      r0,r8
0004ec  f7fffffe          BL       _GetEffectSize
0004f0  9903              LDR      r1,[sp,#0xc]
0004f2  ebaa0040          SUB      r0,r10,r0,LSL #1
0004f6  4408              ADD      r0,r0,r1
0004f8  9003              STR      r0,[sp,#0xc]
;;;494              y -= EffectSize;
0004fa  9802              LDR      r0,[sp,#8]
0004fc  1b80              SUBS     r0,r0,r6
0004fe  9002              STR      r0,[sp,#8]
000500  e010              B        |L1.1316|
                  |L1.1282|
;;;495            } else {
;;;496              y += _CalcMenuSizeY(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
000502  4621              MOV      r1,r4
000504  4640              MOV      r0,r8
000506  f7fffffe          BL       _CalcMenuSizeY
00050a  4682              MOV      r10,r0
00050c  4621              MOV      r1,r4
00050e  4640              MOV      r0,r8
000510  f7fffffe          BL       _GetEffectSize
000514  9902              LDR      r1,[sp,#8]
000516  ebaa0040          SUB      r0,r10,r0,LSL #1
00051a  4408              ADD      r0,r0,r1
00051c  9002              STR      r0,[sp,#8]
;;;497              x -= EffectSize;
00051e  9803              LDR      r0,[sp,#0xc]
000520  1b80              SUBS     r0,r0,r6
000522  9003              STR      r0,[sp,#0xc]
                  |L1.1316|
;;;498            }
;;;499            x += WM_GetWindowOrgX(hObj);
000524  4640              MOV      r0,r8
000526  f7fffffe          BL       WM_GetWindowOrgX
00052a  9903              LDR      r1,[sp,#0xc]
00052c  4408              ADD      r0,r0,r1
00052e  9003              STR      r0,[sp,#0xc]
;;;500            y += WM_GetWindowOrgY(hObj);
000530  4640              MOV      r0,r8
000532  f7fffffe          BL       WM_GetWindowOrgY
000536  9902              LDR      r1,[sp,#8]
000538  4408              ADD      r0,r0,r1
00053a  9002              STR      r0,[sp,#8]
;;;501            /*
;;;502             * Notify owner window when for the first time open a menu (when no
;;;503             * other submenu was open), so it can initialize the menu items.
;;;504             */
;;;505            if (PrevActiveSubmenu == 0) {
00053c  b95f              CBNZ     r7,|L1.1366|
;;;506              if (_IsTopLevelMenu(hObj, pObj)) {
00053e  4621              MOV      r1,r4
000540  4640              MOV      r0,r8
000542  f7fffffe          BL       _IsTopLevelMenu
000546  b130              CBZ      r0,|L1.1366|
;;;507                MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITMENU, 0);
000548  f9b4105c          LDRSH    r1,[r4,#0x5c]
00054c  2300              MOVS     r3,#0
00054e  2201              MOVS     r2,#1
000550  4640              MOV      r0,r8
000552  f7fffffe          BL       MENU__SendMenuMessage
                  |L1.1366|
;;;508              }
;;;509            }
;;;510            /* Notify owner window when a submenu opens, so it can initialize the menu items. */
;;;511            MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITSUBMENU, pItem->Id);
000556  886b              LDRH     r3,[r5,#2]
000558  f9b4105c          LDRSH    r1,[r4,#0x5c]
00055c  2202              MOVS     r2,#2
00055e  4640              MOV      r0,r8
000560  f7fffffe          BL       MENU__SendMenuMessage
;;;512            /* Set active menu as owner of submenu. */
;;;513            MENU_SetOwner(pItem->hSubmenu, hObj);
000564  f9b50000          LDRSH    r0,[r5,#0]
000568  4641              MOV      r1,r8
00056a  f7fffffe          BL       MENU_SetOwner
;;;514            /* Attach submenu and inform it about its activation. */
;;;515            WM_AttachWindowAt(pItem->hSubmenu, WM_HBKWIN, x, y);
00056e  f7fffffe          BL       WM_GetDesktopWindow
000572  f9b5c000          LDRSH    r12,[r5,#0]
000576  4601              MOV      r1,r0
000578  4660              MOV      r0,r12
00057a  9b02              LDR      r3,[sp,#8]
00057c  9a03              LDR      r2,[sp,#0xc]
00057e  f7fffffe          BL       WM_AttachWindowAt
;;;516            MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_OPEN, 0);
000582  f9b51000          LDRSH    r1,[r5,#0]
000586  2300              MOVS     r3,#0
000588  2203              MOVS     r2,#3
00058a  4640              MOV      r0,r8
00058c  f7fffffe          BL       MENU__SendMenuMessage
;;;517            pObj->IsSubmenuActive = 1;
000590  e000              B        |L1.1428|
                  |L1.1426|
000592  e007              B        |L1.1444|
                  |L1.1428|
000594  2001              MOVS     r0,#1
000596  f8840060          STRB     r0,[r4,#0x60]
;;;518            /* Invalidate menu item. This is needed because the appearance may have changed. */
;;;519            MENU__InvalidateItem(hObj, pObj, Index);
00059a  464a              MOV      r2,r9
00059c  4621              MOV      r1,r4
00059e  4640              MOV      r0,r8
0005a0  f7fffffe          BL       MENU__InvalidateItem
                  |L1.1444|
;;;520          }
;;;521        }
;;;522      }
;;;523    }
0005a4  b004              ADD      sp,sp,#0x10
0005a6  e8bd87f0          POP      {r4-r10,pc}
;;;524    
                          ENDP

                  _ClosePopup PROC
;;;528    */
;;;529    static void _ClosePopup(MENU_Handle hObj, MENU_Obj* pObj) {
0005aa  b510              PUSH     {r4,lr}
;;;530      if (pObj->Flags & MENU_SF_POPUP) {
0005ac  f8b1205e          LDRH     r2,[r1,#0x5e]
0005b0  f0120f80          TST      r2,#0x80
0005b4  d009              BEQ      |L1.1482|
;;;531        pObj->Flags &= ~(MENU_SF_POPUP);
0005b6  f0220280          BIC      r2,r2,#0x80
0005ba  f8a1205e          STRH     r2,[r1,#0x5e]
;;;532        WM_DetachWindow(hObj);
0005be  f7fffffe          BL       WM_DetachWindow
;;;533        WM_ReleaseCapture();
0005c2  e8bd4010          POP      {r4,lr}
0005c6  f7ffbffe          B.W      WM_ReleaseCapture
                  |L1.1482|
;;;534      }
;;;535    }
0005ca  bd10              POP      {r4,pc}
;;;536    
                          ENDP

                  _SetSelection PROC
;;;540    */
;;;541    static void _SetSelection(MENU_Handle hObj, MENU_Obj* pObj, int Index) {
0005cc  b570              PUSH     {r4-r6,lr}
0005ce  4606              MOV      r6,r0
0005d0  460d              MOV      r5,r1
0005d2  4614              MOV      r4,r2
;;;542      if (Index != pObj->Sel) {
0005d4  6ee8              LDR      r0,[r5,#0x6c]
0005d6  42a0              CMP      r0,r4
0005d8  d00b              BEQ      |L1.1522|
;;;543        pObj->Sel = Index;
0005da  4622              MOV      r2,r4
0005dc  66ec              STR      r4,[r5,#0x6c]
;;;544        MENU__InvalidateItem(hObj, pObj, pObj->Sel); /* Invalidate previous selection */
0005de  4629              MOV      r1,r5
0005e0  4630              MOV      r0,r6
0005e2  f7fffffe          BL       MENU__InvalidateItem
;;;545        MENU__InvalidateItem(hObj, pObj, Index);     /* Invalidate new selection */
0005e6  4622              MOV      r2,r4
0005e8  4629              MOV      r1,r5
0005ea  4630              MOV      r0,r6
0005ec  e8bd4070          POP      {r4-r6,lr}
0005f0  e7fe              B        MENU__InvalidateItem
                  |L1.1522|
;;;546      }
;;;547    }
0005f2  bd70              POP      {r4-r6,pc}
;;;548    
                          ENDP

                  _SelectItem PROC
;;;552    */
;;;553    static void _SelectItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
0005f4  b570              PUSH     {r4-r6,lr}
0005f6  4606              MOV      r6,r0
0005f8  460d              MOV      r5,r1
0005fa  4614              MOV      r4,r2
;;;554      if (pObj->Sel != (int)Index) {
0005fc  6eeb              LDR      r3,[r5,#0x6c]
0005fe  42a3              CMP      r3,r4
000600  d00e              BEQ      |L1.1568|
;;;555        _SetCapture(hObj, pObj);
000602  4629              MOV      r1,r5
000604  4630              MOV      r0,r6
000606  f7fffffe          BL       _SetCapture
;;;556        _OpenSubmenu(hObj, pObj, Index);
00060a  4622              MOV      r2,r4
00060c  4629              MOV      r1,r5
00060e  4630              MOV      r0,r6
000610  f7fffffe          BL       _OpenSubmenu
;;;557        _SetSelection(hObj, pObj, Index);
000614  4622              MOV      r2,r4
000616  4629              MOV      r1,r5
000618  4630              MOV      r0,r6
00061a  e8bd4070          POP      {r4-r6,lr}
00061e  e7fe              B        _SetSelection
                  |L1.1568|
;;;558      }
;;;559    }
000620  bd70              POP      {r4-r6,pc}
;;;560    
                          ENDP

                  _DeselectItem PROC
;;;564    */
;;;565    static void _DeselectItem(MENU_Handle hObj, MENU_Obj* pObj) {
000622  b570              PUSH     {r4-r6,lr}
000624  4605              MOV      r5,r0
000626  460c              MOV      r4,r1
;;;566      if (pObj->IsSubmenuActive == 0) {
000628  f8942060          LDRB     r2,[r4,#0x60]
00062c  2a00              CMP      r2,#0
00062e  d109              BNE      |L1.1604|
;;;567        _SetSelection(hObj, pObj, -1);
000630  1e52              SUBS     r2,r2,#1
000632  4621              MOV      r1,r4
000634  4628              MOV      r0,r5
000636  f7fffffe          BL       _SetSelection
;;;568        _ReleaseCapture(hObj, pObj);
00063a  4621              MOV      r1,r4
00063c  4628              MOV      r0,r5
00063e  e8bd4070          POP      {r4-r6,lr}
000642  e7fe              B        _ReleaseCapture
                  |L1.1604|
;;;569      }
;;;570    }
000644  bd70              POP      {r4-r6,pc}
;;;571    
                          ENDP

                  _ActivateItem PROC
;;;575    */
;;;576    static void _ActivateItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000646  b570              PUSH     {r4-r6,lr}
000648  460d              MOV      r5,r1
00064a  4606              MOV      r6,r0
00064c  4611              MOV      r1,r2
;;;577      MENU_ITEM* pItem;
;;;578      pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00064e  f1050058          ADD      r0,r5,#0x58
000652  f7fffffe          BL       GUI_ARRAY_GetpItem
000656  4604              MOV      r4,r0
;;;579      if (pItem->hSubmenu == 0) {
000658  8820              LDRH     r0,[r4,#0]
00065a  2800              CMP      r0,#0
00065c  d10f              BNE      |L1.1662|
;;;580        if ((pItem->Flags & (MENU_IF_DISABLED | MENU_IF_SEPARATOR)) == 0) {
00065e  88a0              LDRH     r0,[r4,#4]
000660  f0100f03          TST      r0,#3
000664  d10b              BNE      |L1.1662|
;;;581          _ClosePopup(hObj, pObj);
000666  4629              MOV      r1,r5
000668  4630              MOV      r0,r6
00066a  f7fffffe          BL       _ClosePopup
;;;582          /* Send item select message to owner. */
;;;583          MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_ITEMSELECT, pItem->Id);
00066e  8863              LDRH     r3,[r4,#2]
000670  f9b5105c          LDRSH    r1,[r5,#0x5c]
000674  4630              MOV      r0,r6
000676  e8bd4070          POP      {r4-r6,lr}
00067a  2200              MOVS     r2,#0
00067c  e7fe              B        MENU__SendMenuMessage
                  |L1.1662|
;;;584        }
;;;585      }
;;;586    }
00067e  bd70              POP      {r4-r6,pc}
;;;587    
                          ENDP

                  _ActivateMenu PROC
;;;591    */
;;;592    static void _ActivateMenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000680  b570              PUSH     {r4-r6,lr}
000682  4606              MOV      r6,r0
000684  460c              MOV      r4,r1
000686  4615              MOV      r5,r2
;;;593      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
000688  f8b4005e          LDRH     r0,[r4,#0x5e]
00068c  f0100f02          TST      r0,#2
000690  d120              BNE      |L1.1748|
;;;594        MENU_ITEM* pItem;
;;;595        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000692  4629              MOV      r1,r5
000694  f1040058          ADD      r0,r4,#0x58
000698  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;596        if (pItem->hSubmenu) {
00069c  8801              LDRH     r1,[r0,#0]
00069e  2900              CMP      r1,#0
0006a0  d018              BEQ      |L1.1748|
;;;597          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
0006a2  8880              LDRH     r0,[r0,#4]
0006a4  f0100f01          TST      r0,#1
0006a8  d114              BNE      |L1.1748|
;;;598            if ((pObj->Flags & MENU_SF_ACTIVE) == 0) {
0006aa  f8b4005e          LDRH     r0,[r4,#0x5e]
0006ae  f0100f40          TST      r0,#0x40
0006b2  d010              BEQ      |L1.1750|
;;;599              pObj->Flags |= MENU_SF_ACTIVE;
;;;600              _OpenSubmenu(hObj, pObj, Index);
;;;601              _SetSelection(hObj, pObj, Index);
;;;602            } else if (pObj->Flags & MENU_SF_CLOSE_ON_SECOND_CLICK) {
0006b4  f0100f04          TST      r0,#4
0006b8  d00c              BEQ      |L1.1748|
;;;603              if ((int)Index == pObj->Sel) {
0006ba  6ee0              LDR      r0,[r4,#0x6c]
0006bc  42a8              CMP      r0,r5
0006be  d109              BNE      |L1.1748|
;;;604                _CloseSubmenu(hObj, pObj);
0006c0  4621              MOV      r1,r4
0006c2  4630              MOV      r0,r6
0006c4  f7fffffe          BL       _CloseSubmenu
;;;605                pObj->Flags &= ~MENU_SF_ACTIVE;
0006c8  f8b4005e          LDRH     r0,[r4,#0x5e]
0006cc  f0200040          BIC      r0,r0,#0x40
0006d0  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L1.1748|
;;;606              }
;;;607            }
;;;608          }
;;;609        }
;;;610      }
;;;611    }
0006d4  bd70              POP      {r4-r6,pc}
                  |L1.1750|
0006d6  f0400040          ORR      r0,r0,#0x40           ;599
0006da  f8a4005e          STRH     r0,[r4,#0x5e]         ;599
0006de  462a              MOV      r2,r5                 ;600
0006e0  4621              MOV      r1,r4                 ;600
0006e2  4630              MOV      r0,r6                 ;600
0006e4  f7fffffe          BL       _OpenSubmenu
0006e8  462a              MOV      r2,r5                 ;601
0006ea  4621              MOV      r1,r4                 ;601
0006ec  4630              MOV      r0,r6                 ;601
0006ee  e8bd4070          POP      {r4-r6,lr}            ;601
0006f2  e7fe              B        _SetSelection
;;;612    
                          ENDP

                  _DeactivateMenu PROC
;;;616    */
;;;617    static void _DeactivateMenu(MENU_Handle hObj, MENU_Obj* pObj) {
0006f4  b510              PUSH     {r4,lr}
0006f6  460c              MOV      r4,r1
;;;618      _CloseSubmenu(hObj, pObj);
0006f8  4621              MOV      r1,r4
0006fa  f7fffffe          BL       _CloseSubmenu
;;;619      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
0006fe  f8b4005e          LDRH     r0,[r4,#0x5e]
000702  f0100f02          TST      r0,#2
000706  d103              BNE      |L1.1808|
;;;620        pObj->Flags &= ~MENU_SF_ACTIVE;
000708  f0200040          BIC      r0,r0,#0x40
00070c  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L1.1808|
;;;621      }
;;;622    }
000710  bd10              POP      {r4,pc}
;;;623    
                          ENDP

                  _HandlePID PROC
;;;662    */
;;;663    static char _HandlePID(MENU_Handle hObj, MENU_Obj* pObj, int x, int y, int Pressed) {
000712  e92d43f0          PUSH     {r4-r9,lr}
000716  b087              SUB      sp,sp,#0x1c
000718  4681              MOV      r9,r0
00071a  9c0e              LDR      r4,[sp,#0x38]
00071c  460d              MOV      r5,r1
00071e  4617              MOV      r7,r2
000720  4698              MOV      r8,r3
;;;664      GUI_PID_STATE PrevState;
;;;665      char XYInWidget = 0;
000722  2600              MOVS     r6,#0
;;;666      WM_PID__GetPrevState(&PrevState);
000724  a804              ADD      r0,sp,#0x10
000726  f7fffffe          BL       WM_PID__GetPrevState
;;;667      /*
;;;668       * Check if coordinates are inside the widget.
;;;669       */
;;;670      if ((x >= 0) && (y >= 0)) {
00072a  2f00              CMP      r7,#0
00072c  db0f              BLT      |L1.1870|
00072e  f1b80f00          CMP      r8,#0
000732  db0c              BLT      |L1.1870|
;;;671        GUI_RECT r;
;;;672        WM__GetClientRectWin(&pObj->Widget.Win, &r);
000734  a902              ADD      r1,sp,#8
000736  4628              MOV      r0,r5
000738  f7fffffe          BL       WM__GetClientRectWin
;;;673        if ((x <= r.x1) && (y <= r.y1)) {
00073c  f9bd000c          LDRSH    r0,[sp,#0xc]
000740  42b8              CMP      r0,r7
000742  db04              BLT      |L1.1870|
000744  f9bd000e          LDRSH    r0,[sp,#0xe]
000748  4540              CMP      r0,r8
00074a  db00              BLT      |L1.1870|
;;;674          XYInWidget = 1;
00074c  2601              MOVS     r6,#1
                  |L1.1870|
;;;675        }
;;;676      }
;;;677    
;;;678      if (XYInWidget) {
00074e  b3de              CBZ      r6,|L1.1992|
;;;679        int ItemIndex;
;;;680        ItemIndex = _GetItemFromPos(hObj, pObj, x, y);
000750  4643              MOV      r3,r8
000752  463a              MOV      r2,r7
000754  4629              MOV      r1,r5
000756  4648              MOV      r0,r9
000758  f7fffffe          BL       _GetItemFromPos
00075c  4606              MOV      r6,r0
;;;681        /* 
;;;682         * Handle PID when coordinates are inside the widget.
;;;683         */
;;;684        if (ItemIndex >= 0) {
00075e  2e00              CMP      r6,#0
000760  db24              BLT      |L1.1964|
;;;685          /* 
;;;686           * Coordinates are inside the menu.
;;;687           */
;;;688          if (Pressed > 0) {
000762  2c00              CMP      r4,#0
000764  dd0f              BLE      |L1.1926|
;;;689            if ((PrevState.Pressed == 0) && (Pressed == 1)) {  /* Clicked */
000766  f89d0018          LDRB     r0,[sp,#0x18]
00076a  b930              CBNZ     r0,|L1.1914|
00076c  2c01              CMP      r4,#1
00076e  d104              BNE      |L1.1914|
;;;690              _ActivateMenu(hObj, pObj, ItemIndex);
000770  4632              MOV      r2,r6
000772  4629              MOV      r1,r5
000774  4648              MOV      r0,r9
000776  f7fffffe          BL       _ActivateMenu
                  |L1.1914|
;;;691            }
;;;692            _SelectItem(hObj, pObj, ItemIndex);
00077a  4632              MOV      r2,r6
00077c  4629              MOV      r1,r5
00077e  4648              MOV      r0,r9
000780  f7fffffe          BL       _SelectItem
000784  e02a              B        |L1.2012|
                  |L1.1926|
;;;693          } else if ((Pressed == 0) && (PrevState.Pressed == 1)) {  /* Released */
000786  d103              BNE      |L1.1936|
000788  f89d0018          LDRB     r0,[sp,#0x18]
00078c  2801              CMP      r0,#1
00078e  d007              BEQ      |L1.1952|
                  |L1.1936|
;;;694            _ActivateItem(hObj, pObj, ItemIndex);
;;;695          } else if (Pressed < 0) {  /* Mouse moved */
000790  2c00              CMP      r4,#0
000792  da23              BGE      |L1.2012|
;;;696            #if (GUI_SUPPORT_MOUSE)
;;;697              if (_ForwardMouseOverMsg(hObj, pObj, x, y) != 0) {
;;;698                _DeselectItem(hObj, pObj);
;;;699              } else
;;;700            #endif
;;;701            {
;;;702              _SelectItem(hObj, pObj, ItemIndex);
000794  4632              MOV      r2,r6
000796  4629              MOV      r1,r5
000798  4648              MOV      r0,r9
00079a  f7fffffe          BL       _SelectItem
00079e  e01d              B        |L1.2012|
                  |L1.1952|
0007a0  4632              MOV      r2,r6                 ;694
0007a2  4629              MOV      r1,r5                 ;694
0007a4  4648              MOV      r0,r9                 ;694
0007a6  f7fffffe          BL       _ActivateItem
0007aa  e017              B        |L1.2012|
                  |L1.1964|
;;;703            }
;;;704          }
;;;705        } else {
;;;706          /* 
;;;707           * Coordinates are outside the menu but inside the widget.
;;;708           */
;;;709          if (Pressed > 0) {
0007ac  2c00              CMP      r4,#0
0007ae  dd0c              BLE      |L1.1994|
;;;710            if (PrevState.Pressed == 0) {  /* Clicked */
0007b0  f89d0018          LDRB     r0,[sp,#0x18]
0007b4  b918              CBNZ     r0,|L1.1982|
;;;711              /* 
;;;712               * User has clicked outside the menu. Close the active submenu.
;;;713               * The widget itself must be closed (if needed) by the owner.
;;;714               */
;;;715              _DeactivateMenu(hObj, pObj);
0007b6  4629              MOV      r1,r5
0007b8  4648              MOV      r0,r9
0007ba  f7fffffe          BL       _DeactivateMenu
                  |L1.1982|
;;;716            }
;;;717            _DeselectItem(hObj, pObj);
0007be  4629              MOV      r1,r5
0007c0  4648              MOV      r0,r9
0007c2  f7fffffe          BL       _DeselectItem
0007c6  e009              B        |L1.2012|
                  |L1.1992|
0007c8  e00c              B        |L1.2020|
                  |L1.1994|
;;;718          } else if (Pressed < 0) {  /* Moved out or mouse moved */
0007ca  da07              BGE      |L1.2012|
;;;719            if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
0007cc  8ce8              LDRH     r0,[r5,#0x26]
0007ce  f0100f01          TST      r0,#1
0007d2  d103              BNE      |L1.2012|
;;;720              _DeselectItem(hObj, pObj);
0007d4  4629              MOV      r1,r5
0007d6  4648              MOV      r0,r9
0007d8  f7fffffe          BL       _DeselectItem
                  |L1.2012|
;;;721            }
;;;722          }
;;;723        }
;;;724        return 0;
;;;725      } else {
;;;726        /* 
;;;727         * Handle PID when coordinates are outside the widget.
;;;728         */
;;;729        if ((Pressed > 0) && (PrevState.Pressed == 0)) {
;;;730          /* 
;;;731           * User has clicked outside the menu. Close the active submenu.
;;;732           * The widget itself must be closed (if needed) by the owner.
;;;733           */
;;;734          _DeselectItem(hObj, pObj);
;;;735          _DeactivateMenu(hObj, pObj);
;;;736          _ClosePopup(hObj, pObj);
;;;737          _SetSelection(hObj, pObj, -1);
;;;738          if (pObj->Widget.State & WIDGET_STATE_FOCUS) {
;;;739            MENU_Handle hObjTopLevel; 
;;;740            MENU_Obj *  pObjTopLevel;
;;;741            _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, 0);
;;;742            WM_SetFocus(hObjTopLevel);
;;;743            _SetSelection(hObjTopLevel, pObjTopLevel, -1);
;;;744            _ReleaseCapture(hObjTopLevel, pObjTopLevel);
;;;745          }
;;;746        }
;;;747        if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
;;;748          _DeselectItem(hObj, pObj);
;;;749        }
;;;750        #if (GUI_SUPPORT_MOUSE)
;;;751          _ForwardMouseOverMsg(hObj, pObj, x, y);
;;;752        #endif
;;;753      }
;;;754      return 1;   /* Coordinates are not in widget, we need to forward PID message to owner */
;;;755    }
0007dc  b007              ADD      sp,sp,#0x1c
0007de  2000              MOVS     r0,#0                 ;724
0007e0  e8bd83f0          POP      {r4-r9,pc}
                  |L1.2020|
0007e4  2c00              CMP      r4,#0                 ;729
0007e6  dd30              BLE      |L1.2122|
0007e8  f89d0018          LDRB     r0,[sp,#0x18]         ;729
0007ec  bb68              CBNZ     r0,|L1.2122|
0007ee  4629              MOV      r1,r5                 ;734
0007f0  4648              MOV      r0,r9                 ;734
0007f2  f7fffffe          BL       _DeselectItem
0007f6  4629              MOV      r1,r5                 ;735
0007f8  4648              MOV      r0,r9                 ;735
0007fa  f7fffffe          BL       _DeactivateMenu
0007fe  4629              MOV      r1,r5                 ;736
000800  4648              MOV      r0,r9                 ;736
000802  f7fffffe          BL       _ClosePopup
000806  f04f32ff          MOV      r2,#0xffffffff        ;737
00080a  4629              MOV      r1,r5                 ;737
00080c  4648              MOV      r0,r9                 ;737
00080e  f7fffffe          BL       _SetSelection
000812  8ce8              LDRH     r0,[r5,#0x26]         ;738
000814  f0100f01          TST      r0,#1                 ;738
000818  d017              BEQ      |L1.2122|
00081a  2300              MOVS     r3,#0                 ;741
00081c  9300              STR      r3,[sp,#0]            ;741
00081e  ab02              ADD      r3,sp,#8              ;741
000820  aa03              ADD      r2,sp,#0xc            ;741
000822  4629              MOV      r1,r5                 ;741
000824  4648              MOV      r0,r9                 ;741
000826  f7fffffe          BL       _GetTopLevelMenu
00082a  f9bd000c          LDRSH    r0,[sp,#0xc]          ;742
00082e  f7fffffe          BL       WM_SetFocus
000832  f04f32ff          MOV      r2,#0xffffffff        ;743
000836  f9bd000c          LDRSH    r0,[sp,#0xc]          ;743
00083a  9902              LDR      r1,[sp,#8]            ;743
00083c  f7fffffe          BL       _SetSelection
000840  f9bd000c          LDRSH    r0,[sp,#0xc]          ;744
000844  9902              LDR      r1,[sp,#8]            ;744
000846  f7fffffe          BL       _ReleaseCapture
                  |L1.2122|
00084a  8ce8              LDRH     r0,[r5,#0x26]         ;747
00084c  f0100f01          TST      r0,#1                 ;747
000850  d103              BNE      |L1.2138|
000852  4629              MOV      r1,r5                 ;748
000854  4648              MOV      r0,r9                 ;748
000856  f7fffffe          BL       _DeselectItem
                  |L1.2138|
00085a  b007              ADD      sp,sp,#0x1c
00085c  2001              MOVS     r0,#1                 ;754
00085e  e8bd83f0          POP      {r4-r9,pc}
;;;756    
                          ENDP

                  _ForwardPIDMsgToOwner PROC
;;;760    */
;;;761    static void _ForwardPIDMsgToOwner(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000862  e92d41f0          PUSH     {r4-r8,lr}
000866  4607              MOV      r7,r0
000868  460c              MOV      r4,r1
00086a  4616              MOV      r6,r2
;;;762      if (_IsTopLevelMenu(hObj, pObj) == 0) {
00086c  4621              MOV      r1,r4
00086e  4638              MOV      r0,r7
000870  f7fffffe          BL       _IsTopLevelMenu
000874  2800              CMP      r0,#0
000876  d127              BNE      |L1.2248|
;;;763        WM_HWIN hOwner;
;;;764        hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
000878  f9b4005c          LDRSH    r0,[r4,#0x5c]
00087c  b910              CBNZ     r0,|L1.2180|
00087e  4638              MOV      r0,r7
000880  f7fffffe          BL       WM_GetParent
                  |L1.2180|
000884  4605              MOV      r5,r0
;;;765        if (hOwner) {
000886  2d00              CMP      r5,#0
000888  d01e              BEQ      |L1.2248|
;;;766          if (pMsg->Data.p) {
00088a  68b4              LDR      r4,[r6,#8]
00088c  b1b4              CBZ      r4,|L1.2236|
;;;767            GUI_PID_STATE* pState;
;;;768            pState = (GUI_PID_STATE*)pMsg->Data.p;
;;;769            pState->x += WM_GetWindowOrgX(hObj) - WM_GetWindowOrgX(hOwner);
00088e  4638              MOV      r0,r7
000890  f7fffffe          BL       WM_GetWindowOrgX
000894  4680              MOV      r8,r0
000896  4628              MOV      r0,r5
000898  f7fffffe          BL       WM_GetWindowOrgX
00089c  6821              LDR      r1,[r4,#0]
00089e  eba80000          SUB      r0,r8,r0
0008a2  4408              ADD      r0,r0,r1
0008a4  6020              STR      r0,[r4,#0]
;;;770            pState->y += WM_GetWindowOrgY(hObj) - WM_GetWindowOrgY(hOwner);
0008a6  4638              MOV      r0,r7
0008a8  f7fffffe          BL       WM_GetWindowOrgY
0008ac  4607              MOV      r7,r0
0008ae  4628              MOV      r0,r5
0008b0  f7fffffe          BL       WM_GetWindowOrgY
0008b4  6861              LDR      r1,[r4,#4]
0008b6  1a38              SUBS     r0,r7,r0
0008b8  4408              ADD      r0,r0,r1
0008ba  6060              STR      r0,[r4,#4]
                  |L1.2236|
;;;771          }
;;;772          WM__SendMessage(hOwner, pMsg);
0008bc  4631              MOV      r1,r6
0008be  4628              MOV      r0,r5
0008c0  e8bd41f0          POP      {r4-r8,lr}
0008c4  f7ffbffe          B.W      WM__SendMessage
                  |L1.2248|
;;;773        }
;;;774      }
;;;775    }
0008c8  e8bd81f0          POP      {r4-r8,pc}
;;;776    
                          ENDP

                  MENU__ResizeMenu PROC
;;;1288   */
;;;1289   void MENU__ResizeMenu(MENU_Handle hObj, MENU_Obj* pObj) {
0008cc  b570              PUSH     {r4-r6,lr}
0008ce  4604              MOV      r4,r0
0008d0  460d              MOV      r5,r1
;;;1290     int xSize, ySize;
;;;1291     xSize = _CalcWindowSizeX(hObj, pObj);
0008d2  4629              MOV      r1,r5
0008d4  4620              MOV      r0,r4
0008d6  f7fffffe          BL       _CalcWindowSizeX
0008da  4606              MOV      r6,r0
;;;1292     ySize = _CalcWindowSizeY(hObj, pObj);
0008dc  4629              MOV      r1,r5
0008de  4620              MOV      r0,r4
0008e0  f7fffffe          BL       _CalcWindowSizeY
;;;1293     WM_SetSize(hObj, xSize, ySize);
0008e4  4602              MOV      r2,r0
0008e6  4631              MOV      r1,r6
0008e8  4620              MOV      r0,r4
0008ea  f7fffffe          BL       WM_SetSize
;;;1294     WM_InvalidateWindow(hObj);
0008ee  4620              MOV      r0,r4
0008f0  e8bd4070          POP      {r4-r6,lr}
0008f4  f7ffbffe          B.W      WM_InvalidateWindow
;;;1295   }
;;;1296   
                          ENDP

                  _OnMenu PROC
;;;786    */
;;;787    static void _OnMenu(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
0008f8  b570              PUSH     {r4-r6,lr}
0008fa  4606              MOV      r6,r0
0008fc  460c              MOV      r4,r1
0008fe  4615              MOV      r5,r2
;;;788      const MENU_MSG_DATA* pData = (const MENU_MSG_DATA*)pMsg->Data.p;
000900  68a8              LDR      r0,[r5,#8]
;;;789      if (pData) {
000902  2800              CMP      r0,#0
000904  d03d              BEQ      |L1.2434|
;;;790        switch (pData->MsgType) {
000906  8800              LDRH     r0,[r0,#0]
000908  2806              CMP      r0,#6
00090a  d23a              BCS      |L1.2434|
00090c  e8dff000          TBB      [pc,r0]
000910  030f0f1d          DCB      0x03,0x0f,0x0f,0x1d
000914  3237              DCB      0x32,0x37
;;;791        case MENU_ON_ITEMSELECT:
;;;792          _DeactivateMenu(hObj, pObj);
000916  4621              MOV      r1,r4
000918  4630              MOV      r0,r6
00091a  f7fffffe          BL       _DeactivateMenu
;;;793          _DeselectItem(hObj, pObj);
00091e  4621              MOV      r1,r4
000920  4630              MOV      r0,r6
000922  f7fffffe          BL       _DeselectItem
;;;794          _ClosePopup(hObj, pObj);
000926  4621              MOV      r1,r4
000928  4630              MOV      r0,r6
00092a  f7fffffe          BL       _ClosePopup
;;;795          /* No break here. We need to forward message to owner. */
;;;796        case MENU_ON_INITMENU:
;;;797        case MENU_ON_INITSUBMENU:
;;;798          /* Forward message to owner. */
;;;799          {
;;;800            WM_HWIN hOwner;
;;;801            hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
00092e  f9b4005c          LDRSH    r0,[r4,#0x5c]
000932  b910              CBNZ     r0,|L1.2362|
000934  4630              MOV      r0,r6
000936  f7fffffe          BL       WM_GetParent
                  |L1.2362|
;;;802            if (hOwner) {
00093a  2800              CMP      r0,#0
00093c  d021              BEQ      |L1.2434|
;;;803              pMsg->hWinSrc = hObj;
00093e  80ee              STRH     r6,[r5,#6]
;;;804              WM__SendMessage(hOwner, pMsg);
000940  4629              MOV      r1,r5
000942  e8bd4070          POP      {r4-r6,lr}
000946  f7ffbffe          B.W      WM__SendMessage
;;;805            }
;;;806          }
;;;807          break;
;;;808        case MENU_ON_OPEN:
;;;809          pObj->Sel = -1;
00094a  f04f30ff          MOV      r0,#0xffffffff
00094e  66e0              STR      r0,[r4,#0x6c]
;;;810          pObj->IsSubmenuActive = 0;
000950  2000              MOVS     r0,#0
000952  f8840060          STRB     r0,[r4,#0x60]
;;;811          pObj->Flags |= MENU_SF_ACTIVE | MENU_SF_OPEN_ON_POINTEROVER;
000956  f8b4005e          LDRH     r0,[r4,#0x5e]
00095a  f0400042          ORR      r0,r0,#0x42
00095e  f8a4005e          STRH     r0,[r4,#0x5e]
;;;812          _SetCapture(hObj, pObj);
000962  4621              MOV      r1,r4
000964  4630              MOV      r0,r6
000966  f7fffffe          BL       _SetCapture
;;;813          MENU__ResizeMenu(hObj, pObj);
00096a  4621              MOV      r1,r4
00096c  4630              MOV      r0,r6
00096e  e8bd4070          POP      {r4-r6,lr}
000972  e7fe              B        MENU__ResizeMenu
;;;814          break;
;;;815        case MENU_ON_CLOSE:
;;;816          _CloseSubmenu(hObj, pObj);
000974  4621              MOV      r1,r4
000976  4630              MOV      r0,r6
000978  e8bd4070          POP      {r4-r6,lr}
00097c  e7fe              B        _CloseSubmenu
;;;817          break;
;;;818        case MENU_IS_MENU:
;;;819          pMsg->Data.v = 1;
00097e  2001              MOVS     r0,#1
000980  60a8              STR      r0,[r5,#8]
                  |L1.2434|
;;;820          break;
;;;821        }
;;;822      }
;;;823    }
000982  bd70              POP      {r4-r6,pc}
;;;824    
                          ENDP

                  _OnTouch PROC
;;;828    */
;;;829    static char _OnTouch(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000984  b508              PUSH     {r3,lr}
;;;830      const GUI_PID_STATE* pState = (const GUI_PID_STATE*)pMsg->Data.p;
000986  6892              LDR      r2,[r2,#8]
;;;831      if (pState) {  /* Something happened in our area (pressed or released) */
000988  b132              CBZ      r2,|L1.2456|
;;;832        return _HandlePID(hObj, pObj, pState->x, pState->y, pState->Pressed);
00098a  7a13              LDRB     r3,[r2,#8]
00098c  9300              STR      r3,[sp,#0]
00098e  6853              LDR      r3,[r2,#4]
000990  6812              LDR      r2,[r2,#0]
000992  f7fffffe          BL       _HandlePID
;;;833      }
;;;834      return _HandlePID(hObj, pObj, -1, -1, -1); /* Moved out */
;;;835    }
000996  bd08              POP      {r3,pc}
                  |L1.2456|
000998  f04f33ff          MOV      r3,#0xffffffff        ;834
00099c  461a              MOV      r2,r3                 ;834
00099e  9300              STR      r3,[sp,#0]            ;834
0009a0  f7fffffe          BL       _HandlePID
0009a4  bd08              POP      {r3,pc}
;;;836    
                          ENDP

                  _SetPaintColors PROC
;;;854    */
;;;855    static void _SetPaintColors(const MENU_Obj* pObj, const MENU_ITEM* pItem, int ItemIndex) {
0009a6  b510              PUSH     {r4,lr}
;;;856      char Selected;
;;;857      unsigned ColorIndex;
;;;858      Selected = (ItemIndex == pObj->Sel) ? 1 : 0;
0009a8  6ec3              LDR      r3,[r0,#0x6c]
0009aa  4293              CMP      r3,r2
0009ac  d101              BNE      |L1.2482|
0009ae  2201              MOVS     r2,#1
0009b0  e000              B        |L1.2484|
                  |L1.2482|
0009b2  2200              MOVS     r2,#0
                  |L1.2484|
;;;859      if (pObj->IsSubmenuActive && Selected) {
0009b4  f8903060          LDRB     r3,[r0,#0x60]
0009b8  b113              CBZ      r3,|L1.2496|
0009ba  b10a              CBZ      r2,|L1.2496|
;;;860        ColorIndex = MENU_CI_ACTIVE_SUBMENU;
0009bc  2104              MOVS     r1,#4
0009be  e014              B        |L1.2538|
                  |L1.2496|
;;;861      } else if (pItem->Flags & MENU_IF_SEPARATOR) {
0009c0  888b              LDRH     r3,[r1,#4]
0009c2  f0130f02          TST      r3,#2
0009c6  d001              BEQ      |L1.2508|
;;;862        ColorIndex = MENU_CI_ENABLED;
0009c8  2100              MOVS     r1,#0
0009ca  e00e              B        |L1.2538|
                  |L1.2508|
;;;863      } else {
;;;864        ColorIndex = (Selected) ? MENU_CI_SELECTED : MENU_CI_ENABLED;
0009cc  b10a              CBZ      r2,|L1.2514|
0009ce  2101              MOVS     r1,#1
0009d0  e000              B        |L1.2516|
                  |L1.2514|
0009d2  2100              MOVS     r1,#0
                  |L1.2516|
;;;865        if (pItem->Flags & MENU_IF_DISABLED) {
0009d4  f0130f01          TST      r3,#1
0009d8  d007              BEQ      |L1.2538|
;;;866          if (pObj->Flags & MENU_CF_HIDE_DISABLED_SEL) {
0009da  f8b0205e          LDRH     r2,[r0,#0x5e]
0009de  f0120f08          TST      r2,#8
0009e2  d001              BEQ      |L1.2536|
;;;867            ColorIndex = MENU_CI_DISABLED;
0009e4  2102              MOVS     r1,#2
0009e6  e000              B        |L1.2538|
                  |L1.2536|
;;;868          } else {
;;;869            ColorIndex += MENU_CI_DISABLED;
0009e8  1c89              ADDS     r1,r1,#2
                  |L1.2538|
;;;870          }
;;;871        }
;;;872      }
;;;873      GUI_SetBkColor(pObj->Props.aBkColor[ColorIndex]);
0009ea  eb000481          ADD      r4,r0,r1,LSL #2
0009ee  6be0              LDR      r0,[r4,#0x3c]
0009f0  f7fffffe          BL       GUI_SetBkColor
;;;874      GUI_SetColor(pObj->Props.aTextColor[ColorIndex]);
0009f4  6aa0              LDR      r0,[r4,#0x28]
0009f6  e8bd4010          POP      {r4,lr}
0009fa  f7ffbffe          B.W      GUI_SetColor
;;;875    }
;;;876    
                          ENDP

                  _OnPaint PROC
;;;880    */
;;;881    static void _OnPaint(MENU_Handle hObj, MENU_Obj* pObj) {
0009fe  e92d4ff3          PUSH     {r0,r1,r4-r11,lr}
000a02  b089              SUB      sp,sp,#0x24
000a04  460c              MOV      r4,r1
;;;882      GUI_RECT FillRect, TextRect;
;;;883      MENU_ITEM* pItem;
;;;884      unsigned TextWidth, NumItems, i;
;;;885      U8 BorderLeft   = pObj->Props.aBorder[MENU_BI_LEFT];
000a06  f8949050          LDRB     r9,[r4,#0x50]
;;;886      U8 BorderTop    = pObj->Props.aBorder[MENU_BI_TOP];
000a0a  f8948052          LDRB     r8,[r4,#0x52]
;;;887      int FontHeight  = GUI_GetYDistOfFont(pObj->Props.pFont);
000a0e  6d60              LDR      r0,[r4,#0x54]
000a10  f7fffffe          BL       GUI_GetYDistOfFont
000a14  4607              MOV      r7,r0
;;;888      int EffectSize  = _GetEffectSize(hObj, pObj);
000a16  4621              MOV      r1,r4
000a18  9809              LDR      r0,[sp,#0x24]
000a1a  f7fffffe          BL       _GetEffectSize
000a1e  9003              STR      r0,[sp,#0xc]
;;;889      NumItems = MENU__GetNumItems(pObj);
000a20  4620              MOV      r0,r4
000a22  f7fffffe          BL       MENU__GetNumItems
000a26  4606              MOV      r6,r0
;;;890      WM__GetClientRectWin(&pObj->Widget.Win, &FillRect);
000a28  a906              ADD      r1,sp,#0x18
000a2a  4620              MOV      r0,r4
000a2c  f7fffffe          BL       WM__GetClientRectWin
;;;891      GUI__ReduceRect(&FillRect, &FillRect, EffectSize);
000a30  a906              ADD      r1,sp,#0x18
000a32  a806              ADD      r0,sp,#0x18
000a34  9a03              LDR      r2,[sp,#0xc]
000a36  f7fffffe          BL       GUI__ReduceRect
;;;892      GUI_SetFont(pObj->Props.pFont);
000a3a  6d60              LDR      r0,[r4,#0x54]
000a3c  f7fffffe          BL       GUI_SetFont
;;;893      if (pObj->Flags & MENU_SF_VERTICAL) {
000a40  f8b4005e          LDRH     r0,[r4,#0x5e]
;;;894        int ItemHeight, xSize;
;;;895        xSize = _CalcMenuSizeX(hObj, pObj);
;;;896        FillRect.x1 = xSize - EffectSize - 1;
;;;897        TextRect.x0 = FillRect.x0 + BorderLeft;
;;;898        for (i = 0; i < NumItems; i++) {
;;;899          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
;;;900          ItemHeight = _GetItemHeight(hObj, pObj, i);
;;;901          _SetPaintColors(pObj, pItem, i);
;;;902          FillRect.y1 = FillRect.y0 + ItemHeight - 1;
;;;903          if (pItem->Flags & MENU_IF_SEPARATOR) {
;;;904            GUI_ClearRectEx(&FillRect);
;;;905            GUI_SetColor(0x7C7C7C);
000a44  f8dfa454          LDR      r10,|L1.3740|
000a48  f0100f01          TST      r0,#1                 ;893
000a4c  d05f              BEQ      |L1.2830|
000a4e  4621              MOV      r1,r4                 ;895
000a50  9809              LDR      r0,[sp,#0x24]         ;895
000a52  f7fffffe          BL       _CalcMenuSizeX
000a56  9903              LDR      r1,[sp,#0xc]          ;896
000a58  1a40              SUBS     r0,r0,r1              ;896
000a5a  1e40              SUBS     r0,r0,#1              ;896
000a5c  f8ad001c          STRH     r0,[sp,#0x1c]         ;896
000a60  f8bd0018          LDRH     r0,[sp,#0x18]         ;897
000a64  4448              ADD      r0,r0,r9              ;897
000a66  f8ad0010          STRH     r0,[sp,#0x10]         ;897
000a6a  2500              MOVS     r5,#0                 ;898
000a6c  2e00              CMP      r6,#0                 ;898
000a6e  d94d              BLS      |L1.2828|
;;;906            GUI_DrawHLine(FillRect.y0 + BorderTop + 1, FillRect.x0 + 2, FillRect.x1 - 2);
000a70  f1080901          ADD      r9,r8,#1
;;;907          } else {
;;;908            TextWidth = pItem->TextWidth;
;;;909            TextRect.x1 = TextRect.x0 + TextWidth - 1;
;;;910            TextRect.y0 = FillRect.y0 + BorderTop;
;;;911            TextRect.y1 = TextRect.y0 + FontHeight - 1;
000a74  f1a70b01          SUB      r11,r7,#1
                  |L1.2680|
000a78  4629              MOV      r1,r5                 ;899
000a7a  f1040058          ADD      r0,r4,#0x58           ;899
000a7e  f7fffffe          BL       GUI_ARRAY_GetpItem
000a82  4607              MOV      r7,r0                 ;899
000a84  462a              MOV      r2,r5                 ;900
000a86  4621              MOV      r1,r4                 ;900
000a88  9809              LDR      r0,[sp,#0x24]         ;900
000a8a  f7fffffe          BL       _GetItemHeight
000a8e  4682              MOV      r10,r0                ;900
000a90  462a              MOV      r2,r5                 ;901
000a92  4639              MOV      r1,r7                 ;901
000a94  4620              MOV      r0,r4                 ;901
000a96  f7fffffe          BL       _SetPaintColors
000a9a  f9bd001a          LDRSH    r0,[sp,#0x1a]         ;902
000a9e  f1aa0101          SUB      r1,r10,#1             ;902
000aa2  4401              ADD      r1,r1,r0              ;902
000aa4  f8ad101e          STRH     r1,[sp,#0x1e]         ;902
000aa8  88b9              LDRH     r1,[r7,#4]            ;903
000aaa  f0110f02          TST      r1,#2                 ;903
000aae  d011              BEQ      |L1.2772|
000ab0  a806              ADD      r0,sp,#0x18           ;904
000ab2  f7fffffe          BL       GUI_ClearRectEx
000ab6  48f9              LDR      r0,|L1.3740|
000ab8  f7fffffe          BL       GUI_SetColor
000abc  f9bd001c          LDRSH    r0,[sp,#0x1c]         ;906
000ac0  1e82              SUBS     r2,r0,#2              ;906
000ac2  f9bd0018          LDRSH    r0,[sp,#0x18]         ;906
000ac6  1c81              ADDS     r1,r0,#2              ;906
000ac8  f9bd001a          LDRSH    r0,[sp,#0x1a]         ;906
000acc  4448              ADD      r0,r0,r9              ;906
000ace  f7fffffe          BL       GUI_DrawHLine
000ad2  e013              B        |L1.2812|
                  |L1.2772|
000ad4  68b9              LDR      r1,[r7,#8]            ;908
000ad6  f8bd2010          LDRH     r2,[sp,#0x10]         ;909
000ada  1e49              SUBS     r1,r1,#1              ;909
000adc  4411              ADD      r1,r1,r2              ;909
000ade  f8ad1014          STRH     r1,[sp,#0x14]         ;909
000ae2  4440              ADD      r0,r0,r8              ;910
000ae4  f8ad0012          STRH     r0,[sp,#0x12]         ;910
000ae8  4458              ADD      r0,r0,r11
000aea  f8ad0016          STRH     r0,[sp,#0x16]
;;;912            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
000aee  ab04              ADD      r3,sp,#0x10
000af0  aa04              ADD      r2,sp,#0x10
000af2  a906              ADD      r1,sp,#0x18
000af4  f107000c          ADD      r0,r7,#0xc
000af8  f7fffffe          BL       WIDGET__FillStringInRect
                  |L1.2812|
;;;913          }
;;;914          FillRect.y0 += ItemHeight;
000afc  f8bd001a          LDRH     r0,[sp,#0x1a]
000b00  4450              ADD      r0,r0,r10
000b02  f8ad001a          STRH     r0,[sp,#0x1a]
000b06  1c6d              ADDS     r5,r5,#1              ;898
000b08  42b5              CMP      r5,r6                 ;898
000b0a  d3b5              BCC      |L1.2680|
                  |L1.2828|
000b0c  e05b              B        |L1.3014|
                  |L1.2830|
;;;915        }
;;;916      } else {
;;;917        int ItemWidth, ySize;
;;;918        ySize = _CalcMenuSizeY(hObj, pObj);
000b0e  4621              MOV      r1,r4
000b10  9809              LDR      r0,[sp,#0x24]
000b12  f7fffffe          BL       _CalcMenuSizeY
;;;919        FillRect.y1 = ySize - EffectSize - 1;
000b16  9903              LDR      r1,[sp,#0xc]
000b18  1a40              SUBS     r0,r0,r1
000b1a  1e40              SUBS     r0,r0,#1
000b1c  f8ad001e          STRH     r0,[sp,#0x1e]
;;;920        TextRect.y0 = FillRect.y0 + BorderTop;
000b20  f8bd001a          LDRH     r0,[sp,#0x1a]
000b24  4440              ADD      r0,r0,r8
000b26  f8ad0012          STRH     r0,[sp,#0x12]
;;;921        TextRect.y1 = TextRect.y0 + FontHeight - 1;
000b2a  1e79              SUBS     r1,r7,#1
000b2c  4408              ADD      r0,r0,r1
000b2e  f8ad0016          STRH     r0,[sp,#0x16]
;;;922        for (i = 0; i < NumItems; i++) {
000b32  2500              MOVS     r5,#0
000b34  2e00              CMP      r6,#0
000b36  d946              BLS      |L1.3014|
;;;923          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
;;;924          ItemWidth = _GetItemWidth(hObj, pObj, i);
;;;925          _SetPaintColors(pObj, pItem, i);
;;;926          FillRect.x1 = FillRect.x0 + ItemWidth - 1;
;;;927          if (pItem->Flags & MENU_IF_SEPARATOR) {
;;;928            GUI_ClearRectEx(&FillRect);
;;;929            GUI_SetColor(0x7C7C7C);
;;;930            GUI_DrawVLine(FillRect.x0 + BorderLeft + 1, FillRect.y0 + 2, FillRect.y1 - 2);
000b38  f1090b01          ADD      r11,r9,#1
                  |L1.2876|
000b3c  4629              MOV      r1,r5                 ;923
000b3e  f1040058          ADD      r0,r4,#0x58           ;923
000b42  f7fffffe          BL       GUI_ARRAY_GetpItem
000b46  4607              MOV      r7,r0                 ;923
000b48  462a              MOV      r2,r5                 ;924
000b4a  4621              MOV      r1,r4                 ;924
000b4c  9809              LDR      r0,[sp,#0x24]         ;924
000b4e  f7fffffe          BL       _GetItemWidth
000b52  4680              MOV      r8,r0                 ;924
000b54  462a              MOV      r2,r5                 ;925
000b56  4639              MOV      r1,r7                 ;925
000b58  4620              MOV      r0,r4                 ;925
000b5a  f7fffffe          BL       _SetPaintColors
000b5e  f9bd0018          LDRSH    r0,[sp,#0x18]         ;926
000b62  f1a80101          SUB      r1,r8,#1              ;926
000b66  4401              ADD      r1,r1,r0              ;926
000b68  f8ad101c          STRH     r1,[sp,#0x1c]         ;926
000b6c  88b9              LDRH     r1,[r7,#4]            ;927
000b6e  f0110f02          TST      r1,#2                 ;927
000b72  d011              BEQ      |L1.2968|
000b74  a806              ADD      r0,sp,#0x18           ;928
000b76  f7fffffe          BL       GUI_ClearRectEx
000b7a  4650              MOV      r0,r10                ;929
000b7c  f7fffffe          BL       GUI_SetColor
000b80  f9bd001e          LDRSH    r0,[sp,#0x1e]
000b84  1e82              SUBS     r2,r0,#2
000b86  f9bd001a          LDRSH    r0,[sp,#0x1a]
000b8a  1c81              ADDS     r1,r0,#2
000b8c  f9bd0018          LDRSH    r0,[sp,#0x18]
000b90  4458              ADD      r0,r0,r11
000b92  f7fffffe          BL       GUI_DrawVLine
000b96  e00e              B        |L1.2998|
                  |L1.2968|
;;;931          } else {
;;;932            TextWidth = pItem->TextWidth;
000b98  68b9              LDR      r1,[r7,#8]
;;;933            TextRect.x0 = FillRect.x0 + BorderLeft;
000b9a  4448              ADD      r0,r0,r9
000b9c  f8ad0010          STRH     r0,[sp,#0x10]
;;;934            TextRect.x1 = TextRect.x0 + TextWidth - 1;
000ba0  1e49              SUBS     r1,r1,#1
000ba2  4408              ADD      r0,r0,r1
000ba4  f8ad0014          STRH     r0,[sp,#0x14]
;;;935            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
000ba8  ab04              ADD      r3,sp,#0x10
000baa  aa04              ADD      r2,sp,#0x10
000bac  a906              ADD      r1,sp,#0x18
000bae  f107000c          ADD      r0,r7,#0xc
000bb2  f7fffffe          BL       WIDGET__FillStringInRect
                  |L1.2998|
;;;936          }
;;;937          FillRect.x0 += ItemWidth;
000bb6  f8bd0018          LDRH     r0,[sp,#0x18]
000bba  4440              ADD      r0,r0,r8
000bbc  f8ad0018          STRH     r0,[sp,#0x18]
000bc0  1c6d              ADDS     r5,r5,#1              ;922
000bc2  42b5              CMP      r5,r6                 ;922
000bc4  d3ba              BCC      |L1.2876|
                  |L1.3014|
;;;938        }
;;;939      }
;;;940      if (pObj->Width || pObj->Height) {
000bc6  6e60              LDR      r0,[r4,#0x64]
000bc8  b908              CBNZ     r0,|L1.3022|
000bca  6ea0              LDR      r0,[r4,#0x68]
000bcc  b1f8              CBZ      r0,|L1.3086|
                  |L1.3022|
;;;941        GUI_RECT r;
;;;942        WM__GetClientRectWin(&pObj->Widget.Win, &r);
000bce  4669              MOV      r1,sp
000bd0  4620              MOV      r0,r4
000bd2  f7fffffe          BL       WM__GetClientRectWin
;;;943        GUI__ReduceRect(&r, &r, EffectSize);
000bd6  4669              MOV      r1,sp
000bd8  4668              MOV      r0,sp
000bda  9a03              LDR      r2,[sp,#0xc]
000bdc  f7fffffe          BL       GUI__ReduceRect
;;;944        GUI_SetBkColor(pObj->Props.aBkColor[MENU_CI_ENABLED]);
000be0  6be0              LDR      r0,[r4,#0x3c]
000be2  f7fffffe          BL       GUI_SetBkColor
;;;945        GUI_ClearRect(FillRect.x1 + 1, EffectSize, r.x1, FillRect.y1);
000be6  f9bd001c          LDRSH    r0,[sp,#0x1c]
000bea  f9bd301e          LDRSH    r3,[sp,#0x1e]
000bee  f9bd2004          LDRSH    r2,[sp,#4]
000bf2  1c40              ADDS     r0,r0,#1
000bf4  9903              LDR      r1,[sp,#0xc]
000bf6  f7fffffe          BL       GUI_ClearRect
;;;946        GUI_ClearRect(EffectSize, FillRect.y1 + 1, r.x1, r.y1);
000bfa  f9bd001e          LDRSH    r0,[sp,#0x1e]
000bfe  f9bd3006          LDRSH    r3,[sp,#6]
000c02  1c41              ADDS     r1,r0,#1
000c04  f9bd2004          LDRSH    r2,[sp,#4]
000c08  9803              LDR      r0,[sp,#0xc]
000c0a  f7fffffe          BL       GUI_ClearRect
                  |L1.3086|
;;;947      }
;;;948      /* Draw 3D effect (if configured) */
;;;949      if (_HasEffect(hObj, pObj)) {
000c0e  4621              MOV      r1,r4
000c10  9809              LDR      r0,[sp,#0x24]
000c12  f7fffffe          BL       _HasEffect
000c16  2800              CMP      r0,#0
000c18  d002              BEQ      |L1.3104|
;;;950        pObj->Widget.pEffect->pfDrawUp();
000c1a  6a20              LDR      r0,[r4,#0x20]
000c1c  6800              LDR      r0,[r0,#0]
000c1e  4780              BLX      r0
                  |L1.3104|
;;;951      }
;;;952    }
000c20  b00b              ADD      sp,sp,#0x2c
000c22  e8bd8ff0          POP      {r4-r11,pc}
;;;953    
                          ENDP

                  _MoveSel PROC
;;;962    */
;;;963    static void _MoveSel(MENU_Handle hObj, int Dir) {
000c26  e92d47f0          PUSH     {r4-r10,lr}
000c2a  4682              MOV      r10,r0
000c2c  4689              MOV      r9,r1
;;;964      MENU_Obj * pObj;
;;;965      int NewIndex, Index, NumItems, Cnt = 0;
000c2e  2500              MOVS     r5,#0
;;;966      pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj);
000c30  4650              MOV      r0,r10
000c32  f7fffffe          BL       GUI_ALLOC_h2p
000c36  4680              MOV      r8,r0
;;;967      Index = pObj->Sel;
000c38  f8d8406c          LDR      r4,[r8,#0x6c]
;;;968      NewIndex = -1;
000c3c  1e6e              SUBS     r6,r5,#1
;;;969      NumItems = pObj->ItemArray.NumItems;
000c3e  f8b87058          LDRH     r7,[r8,#0x58]
                  |L1.3138|
;;;970      do {
;;;971        MENU_ITEM * pItem;
;;;972        Index += Dir;
000c42  444c              ADD      r4,r4,r9
;;;973        if (Index >= NumItems) {
000c44  42bc              CMP      r4,r7
000c46  db02              BLT      |L1.3150|
;;;974          Index = 0;
000c48  2400              MOVS     r4,#0
;;;975          Cnt++;
000c4a  1c6d              ADDS     r5,r5,#1
000c4c  e003              B        |L1.3158|
                  |L1.3150|
;;;976        } else if (Index < 0) {
000c4e  2c00              CMP      r4,#0
000c50  da01              BGE      |L1.3158|
;;;977          Index = NumItems - 1;
000c52  1e7c              SUBS     r4,r7,#1
;;;978          Cnt++;
000c54  1c6d              ADDS     r5,r5,#1
                  |L1.3158|
;;;979        }
;;;980        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000c56  4621              MOV      r1,r4
000c58  f1080058          ADD      r0,r8,#0x58
000c5c  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;981        if (!(pItem->Flags & MENU_IF_SEPARATOR)) {
000c60  8880              LDRH     r0,[r0,#4]
000c62  f0100f02          TST      r0,#2
000c66  d100              BNE      |L1.3178|
;;;982          NewIndex = Index;
000c68  4626              MOV      r6,r4
                  |L1.3178|
;;;983        }
;;;984      } while ((NewIndex < 0) && (Cnt < 2));
000c6a  2e00              CMP      r6,#0
000c6c  da01              BGE      |L1.3186|
000c6e  2d02              CMP      r5,#2
000c70  dbe7              BLT      |L1.3138|
                  |L1.3186|
;;;985      if (NewIndex >= 0) {
000c72  2e00              CMP      r6,#0
000c74  db05              BLT      |L1.3202|
;;;986        _SetSelection(hObj, pObj, Index);
000c76  4622              MOV      r2,r4
000c78  4641              MOV      r1,r8
000c7a  4650              MOV      r0,r10
000c7c  e8bd47f0          POP      {r4-r10,lr}
000c80  e7fe              B        _SetSelection
                  |L1.3202|
;;;987      }
;;;988    }
000c82  e8bd87f0          POP      {r4-r10,pc}
;;;989    
                          ENDP

                  _OpenMenu PROC
;;;993    */
;;;994    static void _OpenMenu(MENU_Handle hObj, MENU_Obj * pObj, int Index, int SubSel) {
000c86  e92d41f0          PUSH     {r4-r8,lr}
000c8a  4680              MOV      r8,r0
000c8c  460c              MOV      r4,r1
000c8e  4617              MOV      r7,r2
000c90  461e              MOV      r6,r3
;;;995      MENU_ITEM * pItem;
;;;996      MENU_Obj  * pSubObj;
;;;997      pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000c92  4639              MOV      r1,r7
000c94  f1040058          ADD      r0,r4,#0x58
000c98  f7fffffe          BL       GUI_ARRAY_GetpItem
000c9c  4605              MOV      r5,r0
;;;998      pObj->Flags |= MENU_SF_ACTIVE;
000c9e  f8b4005e          LDRH     r0,[r4,#0x5e]
000ca2  f0400040          ORR      r0,r0,#0x40
000ca6  f8a4005e          STRH     r0,[r4,#0x5e]
;;;999      _OpenSubmenu(hObj, pObj, Index);
000caa  463a              MOV      r2,r7
000cac  4621              MOV      r1,r4
000cae  4640              MOV      r0,r8
000cb0  f7fffffe          BL       _OpenSubmenu
;;;1000     pSubObj = (MENU_Obj *) GUI_ALLOC_h2p(pItem->hSubmenu);
000cb4  f9b50000          LDRSH    r0,[r5,#0]
000cb8  f7fffffe          BL       GUI_ALLOC_h2p
000cbc  4601              MOV      r1,r0
;;;1001     if (SubSel >= pSubObj->ItemArray.NumItems) {
000cbe  f8b10058          LDRH     r0,[r1,#0x58]
000cc2  42b0              CMP      r0,r6
000cc4  dc00              BGT      |L1.3272|
;;;1002       SubSel = pSubObj->ItemArray.NumItems - 1;
000cc6  1e46              SUBS     r6,r0,#1
                  |L1.3272|
;;;1003     }
;;;1004     _SetSelection(pItem->hSubmenu, pSubObj, SubSel);
000cc8  f9b50000          LDRSH    r0,[r5,#0]
000ccc  4632              MOV      r2,r6
000cce  f7fffffe          BL       _SetSelection
;;;1005     WM_SetFocus(pItem->hSubmenu);
000cd2  f9b50000          LDRSH    r0,[r5,#0]
000cd6  f7fffffe          BL       WM_SetFocus
;;;1006     _SetSelection(hObj, pObj, Index);
000cda  463a              MOV      r2,r7
000cdc  4621              MOV      r1,r4
000cde  4640              MOV      r0,r8
000ce0  e8bd41f0          POP      {r4-r8,lr}
000ce4  e7fe              B        _SetSelection
;;;1007   }
;;;1008   
                          ENDP

                  _OnKey PROC
;;;1012   */
;;;1013   static int _OnKey(MENU_Handle hObj, MENU_Obj * pObj, int Key) {
000ce6  e92d4ff0          PUSH     {r4-r11,lr}
000cea  b085              SUB      sp,sp,#0x14
000cec  4680              MOV      r8,r0
000cee  460d              MOV      r5,r1
000cf0  4614              MOV      r4,r2
;;;1014     int KeyOpen, KeyBack, KeyNext, KeyPrev, Index, SubSel = 0;
000cf2  2000              MOVS     r0,#0
000cf4  9004              STR      r0,[sp,#0x10]
;;;1015     MENU_ITEM * pItem;
;;;1016     MENU_Handle hObjTopLevel;
;;;1017     MENU_Obj * pObjTopLevel;
;;;1018     Index = pObj->Sel;
000cf6  f8d5b06c          LDR      r11,[r5,#0x6c]
;;;1019     _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, &SubSel);
000cfa  ab04              ADD      r3,sp,#0x10
000cfc  9300              STR      r3,[sp,#0]
000cfe  ab02              ADD      r3,sp,#8
000d00  aa03              ADD      r2,sp,#0xc
000d02  4629              MOV      r1,r5
000d04  4640              MOV      r0,r8
000d06  f7fffffe          BL       _GetTopLevelMenu
;;;1020     if (Index < 0) {
000d0a  f1bb0f00          CMP      r11,#0
000d0e  da0e              BGE      |L1.3374|
;;;1021       if (Key != GUI_KEY_ESCAPE) {
000d10  2c1b              CMP      r4,#0x1b
000d12  d008              BEQ      |L1.3366|
;;;1022         _SetSelection(hObj, pObj, 0);
000d14  2200              MOVS     r2,#0
000d16  4629              MOV      r1,r5
000d18  4640              MOV      r0,r8
000d1a  f7fffffe          BL       _SetSelection
;;;1023         _SetCapture(hObj, pObj);
000d1e  4629              MOV      r1,r5
000d20  4640              MOV      r0,r8
000d22  f7fffffe          BL       _SetCapture
                  |L1.3366|
;;;1024       }
;;;1025       return 0;
;;;1026     }
;;;1027     if (pObj->Flags & MENU_CF_VERTICAL) {
;;;1028       KeyOpen = GUI_KEY_RIGHT;
;;;1029       KeyBack = GUI_KEY_LEFT;
;;;1030       KeyNext = GUI_KEY_DOWN;
;;;1031       KeyPrev = GUI_KEY_UP;
;;;1032     } else {
;;;1033       KeyOpen = GUI_KEY_DOWN;
;;;1034       KeyBack = 0;
;;;1035       KeyNext = GUI_KEY_RIGHT;
;;;1036       KeyPrev = GUI_KEY_LEFT;
;;;1037     }
;;;1038     pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
;;;1039     if (pItem->hSubmenu && ((Key == KeyOpen) || (Key == GUI_KEY_ENTER))) {
;;;1040       /*
;;;1041        *  If the current menu item is a submenu and <ENTER> or KeyOpen has been pressed, open the submenu
;;;1042        */
;;;1043       _OpenMenu(hObj, pObj, Index, 0);
;;;1044     } else if (!pItem->hSubmenu && (Key == GUI_KEY_ENTER)) {
;;;1045       /*
;;;1046        *  If the current menu item is not a submenu and <ENTER> has been pressed,
;;;1047        *  set the focus to the top level menu, close the submenus and send an MENU_ON_ITEMSELECT message to the owner
;;;1048        */
;;;1049       WM_SetFocus(hObjTopLevel);
;;;1050       _ActivateItem(hObj, pObj, Index);
;;;1051     } else if (((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyOpen) && (!pItem->hSubmenu)) ||
;;;1052                ((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyBack) && (hObjTopLevel == pObj->hOwner))) {
;;;1053       /*
;;;1054        *  If the current menu is not the top level menu and the top level menu is horizontal
;;;1055        *  and <GUI_KEY_RIGHT> or <GUI_KEY_LEFT> has been pressed close the current submenus,
;;;1056        *  move the selection of the top level menu to next/previous item and open it
;;;1057        */
;;;1058       pObj->Flags &= ~MENU_SF_ACTIVE;
;;;1059       /* Set focus to top level menu */
;;;1060       WM_SetFocus(hObjTopLevel);
;;;1061       /* Move selection of top level menu */
;;;1062       if (Key == KeyOpen) {
;;;1063         _MoveSel(hObjTopLevel, +1);
;;;1064       } else {
;;;1065         _MoveSel(hObjTopLevel, -1);
;;;1066       }
;;;1067       /* Open top level menu */
;;;1068       _OpenMenu(hObjTopLevel, pObjTopLevel, pObjTopLevel->Sel, (Key == KeyBack) ? SubSel : 0);
;;;1069     } else if ((hObjTopLevel != hObj) && 
;;;1070                ((Key == GUI_KEY_ESCAPE) || ((Key == KeyBack) && ((!(pObjTopLevel->Flags & MENU_CF_VERTICAL)) && (!pItem->hSubmenu) && (hObjTopLevel != pObj->hOwner)) || (pObjTopLevel->Flags & MENU_CF_VERTICAL)))) {
;;;1071       /*
;;;1072        *  If the current menu is not the top level menu and the top level menu is vertical and <GUI_KEY_LEFT> has been pressed
;;;1073        *  or the top level menu is vertical or horizontal and <GUI_KEY_ESCAPE> has been pressed,
;;;1074        *  close the current submenu
;;;1075        */
;;;1076       WM_SetFocus(pObj->hOwner);
;;;1077     } else if ((hObjTopLevel == hObj) && (Key == GUI_KEY_ESCAPE)) {
;;;1078       /*
;;;1079        *  If the current menu is the top level menu and <GUI_KEY_ESCAPE> has been pressed,
;;;1080        *  unselect the menu and release capture
;;;1081        */
;;;1082       _SetSelection(hObj, pObj, -1);
;;;1083       _ReleaseCapture(hObj, pObj);
;;;1084     } else if (Key == KeyNext) {
;;;1085       /*
;;;1086        *  If KeyNext has been pressed move the selection to the next menu item
;;;1087        */
;;;1088       _CloseSubmenu(hObj, pObj);
;;;1089       _MoveSel(hObj, +1);
;;;1090     } else if (Key == KeyPrev) {
;;;1091       /*
;;;1092        *  If KeyPrev has been pressed move the selection to the previous menu item
;;;1093        */
;;;1094       _CloseSubmenu(hObj, pObj);
;;;1095       _MoveSel(hObj, -1);
;;;1096     } else {
;;;1097       return 1;
;;;1098     }
;;;1099     return 0;
;;;1100   }
000d26  b005              ADD      sp,sp,#0x14
000d28  2000              MOVS     r0,#0                 ;1025
000d2a  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.3374|
000d2e  f8b5005e          LDRH     r0,[r5,#0x5e]         ;1027
000d32  f0100f01          TST      r0,#1                 ;1027
000d36  d006              BEQ      |L1.3398|
000d38  2612              MOVS     r6,#0x12              ;1028
000d3a  2710              MOVS     r7,#0x10              ;1029
000d3c  f04f0913          MOV      r9,#0x13              ;1030
000d40  f04f0a11          MOV      r10,#0x11             ;1031
000d44  e005              B        |L1.3410|
                  |L1.3398|
000d46  2613              MOVS     r6,#0x13              ;1033
000d48  2700              MOVS     r7,#0                 ;1034
000d4a  f04f0912          MOV      r9,#0x12              ;1035
000d4e  f04f0a10          MOV      r10,#0x10             ;1036
                  |L1.3410|
000d52  4659              MOV      r1,r11                ;1038
000d54  f1050058          ADD      r0,r5,#0x58           ;1038
000d58  f7fffffe          BL       GUI_ARRAY_GetpItem
000d5c  f9b01000          LDRSH    r1,[r0,#0]            ;1039
000d60  b119              CBZ      r1,|L1.3434|
000d62  42b4              CMP      r4,r6                 ;1039
000d64  d003              BEQ      |L1.3438|
000d66  2c0d              CMP      r4,#0xd               ;1039
000d68  d001              BEQ      |L1.3438|
                  |L1.3434|
000d6a  b139              CBZ      r1,|L1.3452|
000d6c  e008              B        |L1.3456|
                  |L1.3438|
000d6e  2300              MOVS     r3,#0                 ;1043
000d70  465a              MOV      r2,r11                ;1043
000d72  4629              MOV      r1,r5                 ;1043
000d74  4640              MOV      r0,r8                 ;1043
000d76  f7fffffe          BL       _OpenMenu
000d7a  e08a              B        |L1.3730|
                  |L1.3452|
000d7c  2c0d              CMP      r4,#0xd               ;1044
000d7e  d00a              BEQ      |L1.3478|
                  |L1.3456|
000d80  f9bd000c          LDRSH    r0,[sp,#0xc]          ;1051
000d84  4540              CMP      r0,r8                 ;1051
000d86  d013              BEQ      |L1.3504|
000d88  9a02              LDR      r2,[sp,#8]            ;1051
000d8a  f8b2205e          LDRH     r2,[r2,#0x5e]         ;1051
000d8e  f0120f01          TST      r2,#1                 ;1051
000d92  d00a              BEQ      |L1.3498|
000d94  e00c              B        |L1.3504|
                  |L1.3478|
000d96  f9bd000c          LDRSH    r0,[sp,#0xc]          ;1049
000d9a  f7fffffe          BL       WM_SetFocus
000d9e  465a              MOV      r2,r11                ;1050
000da0  4629              MOV      r1,r5                 ;1050
000da2  4640              MOV      r0,r8                 ;1050
000da4  f7fffffe          BL       _ActivateItem
000da8  e073              B        |L1.3730|
                  |L1.3498|
000daa  42b4              CMP      r4,r6                 ;1051
000dac  d100              BNE      |L1.3504|
000dae  b169              CBZ      r1,|L1.3532|
                  |L1.3504|
000db0  4540              CMP      r0,r8                 ;1052
000db2  d02d              BEQ      |L1.3600|
000db4  9a02              LDR      r2,[sp,#8]            ;1052
000db6  f8b2205e          LDRH     r2,[r2,#0x5e]         ;1052
000dba  f0120f01          TST      r2,#1                 ;1052
000dbe  d127              BNE      |L1.3600|
000dc0  42bc              CMP      r4,r7                 ;1052
000dc2  d125              BNE      |L1.3600|
000dc4  f9b5205c          LDRSH    r2,[r5,#0x5c]         ;1052
000dc8  4282              CMP      r2,r0                 ;1052
000dca  d121              BNE      |L1.3600|
                  |L1.3532|
000dcc  f8b5105e          LDRH     r1,[r5,#0x5e]         ;1058
000dd0  f0210140          BIC      r1,r1,#0x40           ;1058
000dd4  f8a5105e          STRH     r1,[r5,#0x5e]         ;1058
000dd8  f7fffffe          BL       WM_SetFocus
000ddc  42b4              CMP      r4,r6                 ;1062
000dde  d105              BNE      |L1.3564|
000de0  2101              MOVS     r1,#1                 ;1063
000de2  f9bd000c          LDRSH    r0,[sp,#0xc]          ;1063
000de6  f7fffffe          BL       _MoveSel
000dea  e005              B        |L1.3576|
                  |L1.3564|
000dec  f04f31ff          MOV      r1,#0xffffffff        ;1065
000df0  f9bd000c          LDRSH    r0,[sp,#0xc]          ;1065
000df4  f7fffffe          BL       _MoveSel
                  |L1.3576|
000df8  42bc              CMP      r4,r7                 ;1068
000dfa  d101              BNE      |L1.3584|
000dfc  9b04              LDR      r3,[sp,#0x10]         ;1068
000dfe  e000              B        |L1.3586|
                  |L1.3584|
000e00  2300              MOVS     r3,#0                 ;1068
                  |L1.3586|
000e02  9902              LDR      r1,[sp,#8]            ;1068
000e04  f9bd000c          LDRSH    r0,[sp,#0xc]          ;1068
000e08  6eca              LDR      r2,[r1,#0x6c]         ;1068
000e0a  f7fffffe          BL       _OpenMenu
000e0e  e040              B        |L1.3730|
                  |L1.3600|
000e10  4540              CMP      r0,r8                 ;1069
000e12  d019              BEQ      |L1.3656|
000e14  2c1b              CMP      r4,#0x1b              ;1070
000e16  d012              BEQ      |L1.3646|
000e18  42bc              CMP      r4,r7                 ;1070
000e1a  d10a              BNE      |L1.3634|
000e1c  9a02              LDR      r2,[sp,#8]            ;1070
000e1e  f8b2205e          LDRH     r2,[r2,#0x5e]         ;1070
000e22  f0120f01          TST      r2,#1                 ;1070
000e26  d104              BNE      |L1.3634|
000e28  b919              CBNZ     r1,|L1.3634|
000e2a  f9b5105c          LDRSH    r1,[r5,#0x5c]         ;1070
000e2e  4281              CMP      r1,r0                 ;1070
000e30  d105              BNE      |L1.3646|
                  |L1.3634|
000e32  9902              LDR      r1,[sp,#8]            ;1070
000e34  f8b1105e          LDRH     r1,[r1,#0x5e]         ;1070
000e38  f0110f01          TST      r1,#1                 ;1070
000e3c  d004              BEQ      |L1.3656|
                  |L1.3646|
000e3e  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1076
000e42  f7fffffe          BL       WM_SetFocus
000e46  e024              B        |L1.3730|
                  |L1.3656|
000e48  4540              CMP      r0,r8                 ;1077
000e4a  d101              BNE      |L1.3664|
000e4c  2c1b              CMP      r4,#0x1b              ;1077
000e4e  d00a              BEQ      |L1.3686|
                  |L1.3664|
000e50  454c              CMP      r4,r9                 ;1084
000e52  d113              BNE      |L1.3708|
000e54  4629              MOV      r1,r5                 ;1088
000e56  4640              MOV      r0,r8                 ;1088
000e58  f7fffffe          BL       _CloseSubmenu
000e5c  2101              MOVS     r1,#1                 ;1089
000e5e  4640              MOV      r0,r8                 ;1089
000e60  f7fffffe          BL       _MoveSel
000e64  e015              B        |L1.3730|
                  |L1.3686|
000e66  f04f32ff          MOV      r2,#0xffffffff        ;1082
000e6a  4629              MOV      r1,r5                 ;1082
000e6c  4640              MOV      r0,r8                 ;1082
000e6e  f7fffffe          BL       _SetSelection
000e72  4629              MOV      r1,r5                 ;1083
000e74  4640              MOV      r0,r8                 ;1083
000e76  f7fffffe          BL       _ReleaseCapture
000e7a  e00a              B        |L1.3730|
                  |L1.3708|
000e7c  4554              CMP      r4,r10                ;1090
000e7e  d10f              BNE      |L1.3744|
000e80  4629              MOV      r1,r5                 ;1094
000e82  4640              MOV      r0,r8                 ;1094
000e84  f7fffffe          BL       _CloseSubmenu
000e88  f04f31ff          MOV      r1,#0xffffffff        ;1095
000e8c  4640              MOV      r0,r8                 ;1095
000e8e  f7fffffe          BL       _MoveSel
                  |L1.3730|
000e92  2000              MOVS     r0,#0                 ;1099
                  |L1.3732|
000e94  b005              ADD      sp,sp,#0x14
000e96  e8bd8ff0          POP      {r4-r11,pc}
000e9a  0000              DCW      0x0000
                  |L1.3740|
                          DCD      0x007c7c7c
                  |L1.3744|
000ea0  2001              MOVS     r0,#1                 ;1097
000ea2  e7f7              B        |L1.3732|
;;;1101   
                          ENDP

                  MENU_Callback PROC
;;;1134   */
;;;1135   void MENU_Callback(WM_MESSAGE* pMsg) {
000ea4  e92d41f0          PUSH     {r4-r8,lr}
000ea8  4605              MOV      r5,r0
;;;1136     MENU_Handle hObj;
;;;1137     MENU_Obj* pObj;
;;;1138     int OldWidgetState, Result, HasFocus;
;;;1139     hObj = pMsg->hWin;
000eaa  f9b58004          LDRSH    r8,[r5,#4]
;;;1140     pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
000eae  4640              MOV      r0,r8
000eb0  f7fffffe          BL       GUI_ALLOC_h2p
000eb4  4604              MOV      r4,r0
;;;1141     OldWidgetState = pObj->Widget.State;
000eb6  8ce7              LDRH     r7,[r4,#0x26]
;;;1142     Result = 1;
000eb8  2601              MOVS     r6,#1
;;;1143     if (pMsg->MsgId != WM_PID_STATE_CHANGED) {
000eba  6828              LDR      r0,[r5,#0]
000ebc  2811              CMP      r0,#0x11
000ebe  d004              BEQ      |L1.3786|
;;;1144       /* Let widget handle the standard messages */
;;;1145       Result = WIDGET_HandleActive(hObj, pMsg);
000ec0  4629              MOV      r1,r5
000ec2  4640              MOV      r0,r8
000ec4  f7fffffe          BL       WIDGET_HandleActive
000ec8  4606              MOV      r6,r0
                  |L1.3786|
;;;1146     }
;;;1147     HasFocus = pObj->Widget.State & WIDGET_STATE_FOCUS;
000eca  8ce0              LDRH     r0,[r4,#0x26]
000ecc  f0000001          AND      r0,r0,#1
;;;1148     /* React on focus change */
;;;1149     if ((OldWidgetState & WIDGET_STATE_FOCUS) != HasFocus) {
000ed0  f0070101          AND      r1,r7,#1
000ed4  4281              CMP      r1,r0
000ed6  d021              BEQ      |L1.3868|
;;;1150       if (HasFocus) {
000ed8  b1b0              CBZ      r0,|L1.3848|
;;;1151         _CloseSubmenu(hObj, pObj);
000eda  4621              MOV      r1,r4
000edc  4640              MOV      r0,r8
000ede  f7fffffe          BL       _CloseSubmenu
;;;1152         pObj->Flags &= ~MENU_SF_ACTIVE;
000ee2  f8b4005e          LDRH     r0,[r4,#0x5e]
000ee6  f0200040          BIC      r0,r0,#0x40
000eea  f8a4005e          STRH     r0,[r4,#0x5e]
;;;1153         if (pObj->Sel <= 0) {
000eee  6ee0              LDR      r0,[r4,#0x6c]
000ef0  2800              CMP      r0,#0
000ef2  dc13              BGT      |L1.3868|
;;;1154           _SetSelection(hObj, pObj, 0);
000ef4  2200              MOVS     r2,#0
000ef6  4621              MOV      r1,r4
000ef8  4640              MOV      r0,r8
000efa  f7fffffe          BL       _SetSelection
;;;1155           _SetCapture(hObj, pObj);
000efe  4621              MOV      r1,r4
000f00  4640              MOV      r0,r8
000f02  f7fffffe          BL       _SetCapture
000f06  e009              B        |L1.3868|
                  |L1.3848|
;;;1156         }
;;;1157       } else {
;;;1158         _SetSelection(hObj, pObj, -1);
000f08  f04f32ff          MOV      r2,#0xffffffff
000f0c  4621              MOV      r1,r4
000f0e  4640              MOV      r0,r8
000f10  f7fffffe          BL       _SetSelection
;;;1159         _ReleaseCapture(hObj, pObj);
000f14  4621              MOV      r1,r4
000f16  4640              MOV      r0,r8
000f18  f7fffffe          BL       _ReleaseCapture
                  |L1.3868|
;;;1160       }
;;;1161     }
;;;1162     /* Return if message already has been processed */
;;;1163     if (!Result) {
000f1c  2e00              CMP      r6,#0
000f1e  d038              BEQ      |L1.3986|
;;;1164       return;
;;;1165     }
;;;1166     switch (pMsg->MsgId) {
000f20  6828              LDR      r0,[r5,#0]
000f22  280e              CMP      r0,#0xe
000f24  d01b              BEQ      |L1.3934|
000f26  dc04              BGT      |L1.3890|
000f28  280b              CMP      r0,#0xb
000f2a  d029              BEQ      |L1.3968|
000f2c  280c              CMP      r0,#0xc
000f2e  d12b              BNE      |L1.3976|
000f30  e009              B        |L1.3910|
                  |L1.3890|
000f32  280f              CMP      r0,#0xf
000f34  d01f              BEQ      |L1.3958|
000f36  282c              CMP      r0,#0x2c
000f38  d126              BNE      |L1.3976|
;;;1167     case WM_MENU:
;;;1168       _OnMenu(hObj, pObj, pMsg);
000f3a  462a              MOV      r2,r5
000f3c  4621              MOV      r1,r4
000f3e  4640              MOV      r0,r8
000f40  e8bd41f0          POP      {r4-r8,lr}
000f44  e7fe              B        _OnMenu
                  |L1.3910|
;;;1169       return;     /* Message handled, do not call WM_DefaultProc() here. */
;;;1170     case WM_TOUCH:
;;;1171       if (_OnTouch(hObj, pObj, pMsg)) {
000f46  462a              MOV      r2,r5
000f48  4621              MOV      r1,r4
000f4a  4640              MOV      r0,r8
000f4c  f7fffffe          BL       _OnTouch
000f50  b1d0              CBZ      r0,|L1.3976|
;;;1172         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
000f52  462a              MOV      r2,r5
000f54  4621              MOV      r1,r4
000f56  4640              MOV      r0,r8
000f58  f7fffffe          BL       _ForwardPIDMsgToOwner
000f5c  e014              B        |L1.3976|
                  |L1.3934|
;;;1173       }
;;;1174       break;
;;;1175   #if (GUI_SUPPORT_MOUSE)
;;;1176     case WM_MOUSEOVER:
;;;1177       if (_OnMouseOver(hObj, pObj, pMsg)) {
;;;1178         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
;;;1179       }
;;;1180       break;
;;;1181   #endif
;;;1182     case WM_KEY:
;;;1183       if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt > 0) {
000f5e  68a8              LDR      r0,[r5,#8]
000f60  6841              LDR      r1,[r0,#4]
000f62  2900              CMP      r1,#0
000f64  dd10              BLE      |L1.3976|
;;;1184         if (!_OnKey(hObj, pObj, ((const WM_KEY_INFO*)(pMsg->Data.p))->Key)) {
000f66  6802              LDR      r2,[r0,#0]
000f68  4621              MOV      r1,r4
000f6a  4640              MOV      r0,r8
000f6c  f7fffffe          BL       _OnKey
000f70  2800              CMP      r0,#0
000f72  d00e              BEQ      |L1.3986|
000f74  e008              B        |L1.3976|
                  |L1.3958|
;;;1185           return;
;;;1186         }
;;;1187       }
;;;1188       break;
;;;1189     case WM_PAINT:
;;;1190       _OnPaint(hObj, pObj);
000f76  4621              MOV      r1,r4
000f78  4640              MOV      r0,r8
000f7a  f7fffffe          BL       _OnPaint
;;;1191       break;
000f7e  e003              B        |L1.3976|
                  |L1.3968|
;;;1192     case WM_DELETE:
;;;1193       GUI_ARRAY_Delete(&pObj->ItemArray);
000f80  f1040058          ADD      r0,r4,#0x58
000f84  f7fffffe          BL       GUI_ARRAY_Delete
                  |L1.3976|
;;;1194       break;      /* No return here ... WM_DefaultProc needs to be called */
;;;1195     }
;;;1196     WM_DefaultProc(pMsg);
000f88  4628              MOV      r0,r5
000f8a  e8bd41f0          POP      {r4-r8,lr}
000f8e  f7ffbffe          B.W      WM_DefaultProc
                  |L1.3986|
;;;1197   }
000f92  e8bd81f0          POP      {r4-r8,pc}
;;;1198   
                          ENDP

                  MENU_CreateEx PROC
;;;1208   */
;;;1209   MENU_Handle MENU_CreateEx(int x0, int y0, int xSize, int ySize, WM_HWIN hParent, int WinFlags, int ExFlags, int Id) {
000f96  e92d4ff0          PUSH     {r4-r11,lr}
000f9a  b085              SUB      sp,sp,#0x14
000f9c  4682              MOV      r10,r0
000f9e  468b              MOV      r11,r1
000fa0  4616              MOV      r6,r2
000fa2  461f              MOV      r7,r3
000fa4  f8dd9044          LDR      r9,[sp,#0x44]
000fa8  f8dd8038          LDR      r8,[sp,#0x38]
000fac  9d10              LDR      r5,[sp,#0x40]
000fae  9c0f              LDR      r4,[sp,#0x3c]
;;;1210     MENU_Handle hObj;
;;;1211     /* Create the window */
;;;1212     WM_LOCK();
000fb0  f7fffffe          BL       GUI_Lock
;;;1213     hObj = WM_CreateWindowAsChild(x0, y0, xSize, ySize, hParent, WM_CF_SHOW | WM_CF_STAYONTOP | WinFlags, &MENU_Callback,
000fb4  2350              MOVS     r3,#0x50
000fb6  f2af1213          ADR      r2,MENU_Callback + 1
000fba  b2a0              UXTH     r0,r4
000fbc  f040010a          ORR      r1,r0,#0xa
000fc0  9303              STR      r3,[sp,#0xc]
000fc2  9202              STR      r2,[sp,#8]
000fc4  9101              STR      r1,[sp,#4]
000fc6  f8cd8000          STR      r8,[sp,#0]
000fca  463b              MOV      r3,r7
000fcc  4632              MOV      r2,r6
000fce  4659              MOV      r1,r11
000fd0  4650              MOV      r0,r10
000fd2  f7fffffe          BL       WM_CreateWindowAsChild
000fd6  4680              MOV      r8,r0
;;;1214                                   sizeof(MENU_Obj) - sizeof(WM_Obj));
;;;1215     if (hObj) {
000fd8  f1b80f00          CMP      r8,#0
000fdc  d045              BEQ      |L1.4202|
;;;1216       MENU_Obj* pObj;
;;;1217       pObj = (MENU_Obj*)GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
000fde  4640              MOV      r0,r8
000fe0  f7fffffe          BL       GUI_ALLOC_h2p
000fe4  4604              MOV      r4,r0
;;;1218        /* Init sub-classes */
;;;1219       GUI_ARRAY_CREATE(&pObj->ItemArray);
;;;1220       /* init widget specific variables */
;;;1221       WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
000fe6  2210              MOVS     r2,#0x10
000fe8  4649              MOV      r1,r9
000fea  4620              MOV      r0,r4
000fec  f7fffffe          BL       WIDGET__Init
;;;1222       /* init member variables */
;;;1223       MENU_INIT_ID(pObj);
;;;1224       if (ExFlags & MENU_SF_OPEN_ON_POINTEROVER) {
000ff0  f0150f02          TST      r5,#2
000ff4  d002              BEQ      |L1.4092|
;;;1225         ExFlags |= MENU_SF_ACTIVE;
000ff6  f0450040          ORR      r0,r5,#0x40
000ffa  e001              B        |L1.4096|
                  |L1.4092|
;;;1226       } else {
;;;1227         ExFlags &= ~(MENU_SF_ACTIVE);
000ffc  f0250040          BIC      r0,r5,#0x40
                  |L1.4096|
;;;1228       }
;;;1229       pObj->Props           = MENU__DefaultProps;
001000  4970              LDR      r1,|L1.4548|
001002  f8d1c00c          LDR      r12,[r1,#0xc]  ; MENU__DefaultProps
001006  690d              LDR      r5,[r1,#0x10]  ; MENU__DefaultProps
001008  688b              LDR      r3,[r1,#8]  ; MENU__DefaultProps
00100a  684a              LDR      r2,[r1,#4]  ; MENU__DefaultProps
00100c  f8c4c030          STR      r12,[r4,#0x30]
001010  6365              STR      r5,[r4,#0x34]
001012  62e3              STR      r3,[r4,#0x2c]
001014  62a2              STR      r2,[r4,#0x28]
001016  f8d1c01c          LDR      r12,[r1,#0x1c]  ; MENU__DefaultProps
00101a  6a0d              LDR      r5,[r1,#0x20]  ; MENU__DefaultProps
00101c  698b              LDR      r3,[r1,#0x18]  ; MENU__DefaultProps
00101e  694a              LDR      r2,[r1,#0x14]  ; MENU__DefaultProps
001020  f8c4c040          STR      r12,[r4,#0x40]
001024  6465              STR      r5,[r4,#0x44]
001026  63e3              STR      r3,[r4,#0x3c]
001028  63a2              STR      r2,[r4,#0x38]
00102a  f8d1c02c          LDR      r12,[r1,#0x2c]  ; MENU__DefaultProps
00102e  6b0d              LDR      r5,[r1,#0x30]  ; MENU__DefaultProps
001030  6a8b              LDR      r3,[r1,#0x28]  ; MENU__DefaultProps
001032  6a4a              LDR      r2,[r1,#0x24]  ; MENU__DefaultProps
001034  f8c4c050          STR      r12,[r4,#0x50]
001038  6565              STR      r5,[r4,#0x54]
00103a  64e3              STR      r3,[r4,#0x4c]
00103c  64a2              STR      r2,[r4,#0x48]
;;;1230       pObj->Flags           = ExFlags;
00103e  f8a4005e          STRH     r0,[r4,#0x5e]
;;;1231       pObj->Width           = ((xSize > 0) ? xSize : 0);
001042  2e00              CMP      r6,#0
001044  dc00              BGT      |L1.4168|
001046  2600              MOVS     r6,#0
                  |L1.4168|
001048  6666              STR      r6,[r4,#0x64]
;;;1232       pObj->Height          = ((ySize > 0) ? ySize : 0);
00104a  2f00              CMP      r7,#0
00104c  dc00              BGT      |L1.4176|
00104e  2700              MOVS     r7,#0
                  |L1.4176|
001050  66a7              STR      r7,[r4,#0x68]
;;;1233       pObj->Sel             = -1;
001052  f04f30ff          MOV      r0,#0xffffffff
001056  66e0              STR      r0,[r4,#0x6c]
;;;1234       pObj->hOwner          = 0;
001058  2000              MOVS     r0,#0
00105a  f8a4005c          STRH     r0,[r4,#0x5c]
;;;1235       pObj->IsSubmenuActive = 0;
00105e  f8840060          STRB     r0,[r4,#0x60]
;;;1236       WIDGET_SetEffect(hObj, MENU__pDefaultEffect);
001062  6809              LDR      r1,[r1,#0]  ; MENU__pDefaultEffect
001064  4640              MOV      r0,r8
001066  f7fffffe          BL       WIDGET_SetEffect
                  |L1.4202|
;;;1237     } else {
;;;1238       GUI_DEBUG_ERROROUT_IF(hObj==0, "MENU_CreateEx failed")
;;;1239     }
;;;1240     WM_UNLOCK();
00106a  f7fffffe          BL       GUI_Unlock
;;;1241     return hObj;
;;;1242   }
00106e  b005              ADD      sp,sp,#0x14
001070  4640              MOV      r0,r8                 ;1241
001072  e8bd8ff0          POP      {r4-r11,pc}
;;;1243   
                          ENDP

                  MENU__RecalcTextWidthOfItems PROC
;;;1271   */
;;;1272   void MENU__RecalcTextWidthOfItems(MENU_Obj* pObj) {
001076  e92d41f0          PUSH     {r4-r8,lr}
00107a  4606              MOV      r6,r0
;;;1273     const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;1274     MENU_ITEM* pItem;
;;;1275     unsigned i, NumItems;
;;;1276     NumItems = MENU__GetNumItems(pObj);
00107c  4630              MOV      r0,r6
00107e  f7fffffe          BL       MENU__GetNumItems
001082  4607              MOV      r7,r0
;;;1277     pOldFont  = GUI_SetFont(pObj->Props.pFont);
001084  6d70              LDR      r0,[r6,#0x54]
001086  f7fffffe          BL       GUI_SetFont
00108a  4680              MOV      r8,r0
;;;1278     for (i = 0; i < NumItems; i++) {
00108c  2400              MOVS     r4,#0
00108e  2f00              CMP      r7,#0
001090  d90d              BLS      |L1.4270|
                  |L1.4242|
;;;1279       pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
001092  4621              MOV      r1,r4
001094  f1060058          ADD      r0,r6,#0x58
001098  f7fffffe          BL       GUI_ARRAY_GetpItem
00109c  4605              MOV      r5,r0
;;;1280       pItem->TextWidth = GUI_GetStringDistX(pItem->acText);
00109e  f105000c          ADD      r0,r5,#0xc
0010a2  f7fffffe          BL       GUI_GetStringDistX
0010a6  60a8              STR      r0,[r5,#8]
0010a8  1c64              ADDS     r4,r4,#1              ;1278
0010aa  42bc              CMP      r4,r7                 ;1278
0010ac  d3f1              BCC      |L1.4242|
                  |L1.4270|
;;;1281     }
;;;1282     GUI_SetFont(pOldFont);
0010ae  4640              MOV      r0,r8
0010b0  e8bd41f0          POP      {r4-r8,lr}
0010b4  f7ffbffe          B.W      GUI_SetFont
;;;1283   }
;;;1284   
                          ENDP

                  MENU__SetItem PROC
;;;1300   */
;;;1301   char MENU__SetItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, const MENU_ITEM_DATA* pItemData) {
0010b8  e92d41f0          PUSH     {r4-r8,lr}
0010bc  b084              SUB      sp,sp,#0x10
0010be  4607              MOV      r7,r0
0010c0  460e              MOV      r6,r1
0010c2  4690              MOV      r8,r2
;;;1302     MENU_ITEM Item = {0};
0010c4  2400              MOVS     r4,#0
0010c6  9400              STR      r4,[sp,#0]
0010c8  9401              STR      r4,[sp,#4]
0010ca  9402              STR      r4,[sp,#8]
0010cc  9403              STR      r4,[sp,#0xc]
;;;1303     const char* pText;
;;;1304     pText = pItemData->pText;
0010ce  681d              LDR      r5,[r3,#0]
;;;1305     if (!pText) {
0010d0  b905              CBNZ     r5,|L1.4308|
;;;1306       pText = "";
0010d2  a53d              ADR      r5,|L1.4552|
                  |L1.4308|
;;;1307     }
;;;1308     Item.Id        = pItemData->Id;
0010d4  8898              LDRH     r0,[r3,#4]
0010d6  f8ad0002          STRH     r0,[sp,#2]
;;;1309     Item.Flags     = pItemData->Flags;
0010da  88d8              LDRH     r0,[r3,#6]
0010dc  f8ad0004          STRH     r0,[sp,#4]
;;;1310     Item.hSubmenu  = pItemData->hSubmenu;
0010e0  8918              LDRH     r0,[r3,#8]
0010e2  f8ad0000          STRH     r0,[sp,#0]
;;;1311     Item.TextWidth = _CalcTextWidth(pObj, pText);
0010e6  4629              MOV      r1,r5
0010e8  4630              MOV      r0,r6
0010ea  f7fffffe          BL       _CalcTextWidth
0010ee  9002              STR      r0,[sp,#8]
;;;1312     if (Item.Flags & MENU_IF_SEPARATOR) {
0010f0  f8bd0004          LDRH     r0,[sp,#4]
0010f4  f0100f02          TST      r0,#2
0010f8  d001              BEQ      |L1.4350|
;;;1313       Item.hSubmenu = 0;   /* Ensures that no separator is a submenu */
0010fa  f8ad4000          STRH     r4,[sp,#0]
                  |L1.4350|
;;;1314     }
;;;1315     if (GUI_ARRAY_SetItem(&pObj->ItemArray, Index, &Item, sizeof(MENU_ITEM) + strlen(pText)) != 0) {
0010fe  4628              MOV      r0,r5
001100  f7fffffe          BL       strlen
001104  f1000310          ADD      r3,r0,#0x10
001108  466a              MOV      r2,sp
00110a  4641              MOV      r1,r8
00110c  f1060058          ADD      r0,r6,#0x58
001110  f7fffffe          BL       GUI_ARRAY_SetItem
001114  b1a8              CBZ      r0,|L1.4418|
;;;1316       MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
001116  4641              MOV      r1,r8
001118  f1060058          ADD      r0,r6,#0x58
00111c  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;1317       strcpy(pItem->acText, pText);
001120  4629              MOV      r1,r5
001122  300c              ADDS     r0,r0,#0xc
001124  f7fffffe          BL       strcpy
;;;1318       MENU_SetOwner(Item.hSubmenu, hObj);
001128  f9bd0000          LDRSH    r0,[sp,#0]
00112c  4639              MOV      r1,r7
00112e  f7fffffe          BL       MENU_SetOwner
;;;1319       WM_DetachWindow(Item.hSubmenu);   /* Ensures all submenus are initially closed */
001132  f9bd0000          LDRSH    r0,[sp,#0]
001136  f7fffffe          BL       WM_DetachWindow
;;;1320       return 1;
;;;1321     }
;;;1322     return 0;
;;;1323   }
00113a  b004              ADD      sp,sp,#0x10
00113c  2001              MOVS     r0,#1                 ;1320
00113e  e8bd81f0          POP      {r4-r8,pc}
                  |L1.4418|
001142  b004              ADD      sp,sp,#0x10
001144  2000              MOVS     r0,#0                 ;1322
001146  e8bd81f0          POP      {r4-r8,pc}
;;;1324   
                          ENDP

                  MENU__SetItemFlags PROC
;;;1328   */
;;;1329   void MENU__SetItemFlags(MENU_Obj* pObj, unsigned Index, U16 Mask, U16 Flags) {
00114a  b570              PUSH     {r4-r6,lr}
00114c  4614              MOV      r4,r2
00114e  461d              MOV      r5,r3
;;;1330     MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
001150  3058              ADDS     r0,r0,#0x58
001152  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;1331     pItem->Flags &= ~Mask;
001156  8881              LDRH     r1,[r0,#4]
001158  43a1              BICS     r1,r1,r4
;;;1332     pItem->Flags |= Flags;
00115a  4329              ORRS     r1,r1,r5
00115c  8081              STRH     r1,[r0,#4]
;;;1333   }
00115e  bd70              POP      {r4-r6,pc}
;;;1334   
                          ENDP

                  MENU_AddItem PROC
;;;1366   */
;;;1367   void MENU_AddItem(MENU_Handle hObj, const MENU_ITEM_DATA* pItemData) {
001160  e92d41f0          PUSH     {r4-r8,lr}
001164  4606              MOV      r6,r0
001166  460f              MOV      r7,r1
;;;1368     if (hObj && pItemData) {
001168  2e00              CMP      r6,#0
00116a  d028              BEQ      |L1.4542|
00116c  2f00              CMP      r7,#0
00116e  d026              BEQ      |L1.4542|
;;;1369       MENU_Obj* pObj;
;;;1370       WM_LOCK();
001170  f7fffffe          BL       GUI_Lock
;;;1371       pObj = MENU_H2P(hObj);
001174  4630              MOV      r0,r6
001176  f7fffffe          BL       GUI_ALLOC_h2p
00117a  4604              MOV      r4,r0
;;;1372       if (pObj) {
00117c  b1ac              CBZ      r4,|L1.4522|
;;;1373         if (GUI_ARRAY_AddItem(&pObj->ItemArray, NULL, 0) == 0) {
00117e  2200              MOVS     r2,#0
001180  4611              MOV      r1,r2
001182  f1040058          ADD      r0,r4,#0x58
001186  f7fffffe          BL       GUI_ARRAY_AddItem
00118a  b970              CBNZ     r0,|L1.4522|
;;;1374           unsigned Index;
;;;1375           Index = MENU__GetNumItems(pObj) - 1;
00118c  4620              MOV      r0,r4
00118e  f7fffffe          BL       MENU__GetNumItems
001192  1e45              SUBS     r5,r0,#1
;;;1376           if (MENU__SetItem(hObj, pObj, Index, pItemData) == 0) {
001194  463b              MOV      r3,r7
001196  462a              MOV      r2,r5
001198  4621              MOV      r1,r4
00119a  4630              MOV      r0,r6
00119c  f7fffffe          BL       MENU__SetItem
0011a0  b138              CBZ      r0,|L1.4530|
;;;1377             GUI_ARRAY_DeleteItem(&pObj->ItemArray, Index);
;;;1378           } else {
;;;1379             MENU__ResizeMenu(hObj, pObj);
0011a2  4621              MOV      r1,r4
0011a4  4630              MOV      r0,r6
0011a6  f7fffffe          BL       MENU__ResizeMenu
                  |L1.4522|
;;;1380           }
;;;1381         }
;;;1382       }
;;;1383       WM_UNLOCK();
0011aa  e8bd41f0          POP      {r4-r8,lr}
0011ae  f7ffbffe          B.W      GUI_Unlock
                  |L1.4530|
0011b2  4629              MOV      r1,r5                 ;1377
0011b4  f1040058          ADD      r0,r4,#0x58           ;1377
0011b8  f7fffffe          BL       GUI_ARRAY_DeleteItem
0011bc  e7f5              B        |L1.4522|
                  |L1.4542|
;;;1384     }
;;;1385   }
0011be  e8bd81f0          POP      {r4-r8,pc}
;;;1386   
                          ENDP

0011c2  0000              DCW      0x0000
                  |L1.4548|
                          DCD      ||.data||
                  |L1.4552|
0011c8  00                DCB      0
0011c9  00                DCB      0
0011ca  00                DCB      0
0011cb  00                DCB      0

                          AREA ||.data||, DATA, ALIGN=2

                  MENU__pDefaultEffect
                          DCD      WIDGET_Effect_3D1L
                  MENU__DefaultProps
                          DCD      0x00000000
                          DCD      0x00ffffff
                          DCD      0x007c7c7c
                          DCD      0x00d3d3d3
                          DCD      0x00ffffff
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x007c7c7c
00002c  04040202          DCB      0x04,0x04,0x02,0x02
                          DCD      GUI_Font13_1
