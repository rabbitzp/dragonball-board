; generated by ARM C/C++ Compiler, 4.1 [Build 481]
; commandline ArmCC [--debug -c --asm --interleave -o.\rvmdk\wm_setfocus.o --depend=.\rvmdk\wm_setfocus.d --cpu=Cortex-M3 --apcs=interwork -O1 -Otime -I. -I..\BSP -I..\..\..\..\..\uCOS-II\Ports\arm-cortex-m3\Generic\RealView -I..\..\..\..\..\uCOS-II\Source -I..\..\..\..\..\CPU\ST\STM32\inc -I..\..\..\..\..\uC-CPU -I..\..\..\..\..\uC-CPU\Arm-Cortex-M3\RealView -I..\..\..\..\..\uC-LIB -I..\..\..\..\..\uC-Probe\Target\Plugins\uCOS-II -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\Source -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Ports\ST\STM32 -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Source -I..\..\..\..\..\User\inc -I..\..\..\..\..\uCGUI\Config -I..\..\..\..\..\uCGUI\GUIDemo -I..\..\..\..\..\uCGUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\AntiAlias -I..\..\..\..\..\uCGUI\GUI\ConvertColor -I..\..\..\..\..\uCGUI\GUI\ConvertMono -I..\..\..\..\..\uCGUI\GUI\Core -I..\..\..\..\..\uCGUI\GUI\Font -I..\..\..\..\..\uCGUI\GUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\MemDev -I..\..\..\..\..\uCGUI\GUI\MultiLayer -I..\..\..\..\..\uCGUI\GUI\Widget -I..\..\..\..\..\uCGUI\GUI\WM -Id:\Keil-stm32\ARM\INC -Id:\Keil-stm32\ARM\INC\ST\STM32F10x -D__MICROLIB --omf_browse=.\rvmdk\wm_setfocus.crf ..\..\..\..\..\uCGUI\GUI\WM\WM_SetFocus.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  WM_SetFocus PROC
;;;42     */
;;;43     int WM_SetFocus(WM_HWIN hWin) {
000000  b5f0              PUSH     {r4-r7,lr}
000002  b085              SUB      sp,sp,#0x14
000004  4604              MOV      r4,r0
;;;44       int r;
;;;45       WM_MESSAGE Msg = {0};
000006  2500              MOVS     r5,#0
000008  9502              STR      r5,[sp,#8]
00000a  9503              STR      r5,[sp,#0xc]
00000c  9504              STR      r5,[sp,#0x10]
;;;46       WM_LOCK();
00000e  f7fffffe          BL       GUI_Lock
;;;47       if ((hWin) && (hWin != WM__hWinFocus)) {
000012  b3f4              CBZ      r4,|L1.146|
000014  4e25              LDR      r6,|L1.172|
000016  f9b60000          LDRSH    r0,[r6,#0]  ; WM__hWinFocus
00001a  4284              CMP      r4,r0
00001c  d040              BEQ      |L1.160|
;;;48         WM_NOTIFY_CHILD_HAS_FOCUS_INFO Info;
;;;49         Info.hOld = WM__hWinFocus;
00001e  f8ad0004          STRH     r0,[sp,#4]
;;;50         Info.hNew = hWin;
000022  f8ad4006          STRH     r4,[sp,#6]
;;;51         Msg.MsgId  = WM_SET_FOCUS;
000026  211e              MOVS     r1,#0x1e
000028  9102              STR      r1,[sp,#8]
;;;52         /* Send a "no more focus" message to window losing focus */
;;;53         Msg.Data.v = 0;
00002a  9504              STR      r5,[sp,#0x10]
;;;54         if (WM__hWinFocus) {
00002c  b110              CBZ      r0,|L1.52|
;;;55           WM__SendMessage(WM__hWinFocus, &Msg);
00002e  a902              ADD      r1,sp,#8
000030  f7fffffe          BL       WM__SendMessage
                  |L1.52|
;;;56         }
;;;57         /* Send "You have the focus now" message to the window */
;;;58         Msg.Data.v = 1;
000034  2001              MOVS     r0,#1
000036  9004              STR      r0,[sp,#0x10]
;;;59         WM__SendMessage(WM__hWinFocus = hWin, &Msg);
000038  8034              STRH     r4,[r6,#0]
00003a  a902              ADD      r1,sp,#8
00003c  4620              MOV      r0,r4
00003e  f7fffffe          BL       WM__SendMessage
;;;60         if ((r = Msg.Data.v) == 0) { /* On success only */
000042  9e04              LDR      r6,[sp,#0x10]
000044  bb36              CBNZ     r6,|L1.148|
;;;61           /* Set message to ancestors of window getting the focus */
;;;62           while ((hWin = WM_GetParent(hWin)) != 0) {
000046  4620              MOV      r0,r4
000048  f7fffffe          BL       WM_GetParent
00004c  0007              MOVS     r7,r0
00004e  ac01              ADD      r4,sp,#4              ;48
;;;63             Msg.MsgId   = WM_NOTIFY_CHILD_HAS_FOCUS;
000050  f04f0520          MOV      r5,#0x20
000054  d00a              BEQ      |L1.108|
                  |L1.86|
000056  9502              STR      r5,[sp,#8]
;;;64             Msg.Data.p = &Info;
000058  9404              STR      r4,[sp,#0x10]
;;;65             WM__SendMessage(hWin, &Msg);
00005a  a902              ADD      r1,sp,#8
00005c  4638              MOV      r0,r7
00005e  f7fffffe          BL       WM__SendMessage
000062  4638              MOV      r0,r7                 ;62
000064  f7fffffe          BL       WM_GetParent
000068  0007              MOVS     r7,r0                 ;62
00006a  d1f4              BNE      |L1.86|
                  |L1.108|
;;;66           }
;;;67           /* Set message to ancestors of window loosing the focus */
;;;68           hWin = Info.hOld;
00006c  f9bd7004          LDRSH    r7,[sp,#4]
;;;69           if (WM_IsWindow(hWin)) {    /* Make sure window has not been deleted in the mean time. Can be optimized: _DeleteWindow could clear the handle to avoid this check (RS) */
000070  4638              MOV      r0,r7
000072  f7fffffe          BL       WM_IsWindow
000076  b168              CBZ      r0,|L1.148|
;;;70             while ((hWin = WM_GetParent(hWin)) != 0) {
000078  4638              MOV      r0,r7
00007a  f7fffffe          BL       WM_GetParent
00007e  0007              MOVS     r7,r0
000080  d00f              BEQ      |L1.162|
                  |L1.130|
;;;71               Msg.MsgId  = WM_NOTIFY_CHILD_HAS_FOCUS;
000082  9502              STR      r5,[sp,#8]
;;;72               Msg.Data.p = &Info;
000084  9404              STR      r4,[sp,#0x10]
;;;73               WM__SendMessage(hWin, &Msg);
000086  a902              ADD      r1,sp,#8
000088  4638              MOV      r0,r7
00008a  f7fffffe          BL       WM__SendMessage
00008e  4638              MOV      r0,r7                 ;70
000090  e001              B        |L1.150|
                  |L1.146|
000092  e005              B        |L1.160|
                  |L1.148|
000094  e005              B        |L1.162|
                  |L1.150|
000096  f7fffffe          BL       WM_GetParent
00009a  0007              MOVS     r7,r0                 ;70
00009c  d1f1              BNE      |L1.130|
00009e  e000              B        |L1.162|
                  |L1.160|
;;;74             }
;;;75           }
;;;76         }
;;;77       } else {
;;;78         r = 1;
0000a0  2601              MOVS     r6,#1
                  |L1.162|
;;;79         if (!hWin) {
;;;80           //WM__hWinFocus = 0;
;;;81         }
;;;82       }
;;;83       WM_UNLOCK();
0000a2  f7fffffe          BL       GUI_Unlock
;;;84       return r;
;;;85     }
0000a6  b005              ADD      sp,sp,#0x14
0000a8  4630              MOV      r0,r6                 ;84
0000aa  bdf0              POP      {r4-r7,pc}
;;;86     
                          ENDP

                  |L1.172|
                          DCD      WM__hWinFocus
