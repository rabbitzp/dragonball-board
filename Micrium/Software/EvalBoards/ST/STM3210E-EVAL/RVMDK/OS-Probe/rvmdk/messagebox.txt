; generated by ARM C/C++ Compiler, 4.1 [Build 481]
; commandline ArmCC [--debug -c --asm --interleave -o.\rvmdk\messagebox.o --depend=.\rvmdk\messagebox.d --cpu=Cortex-M3 --apcs=interwork -O1 -Otime -I. -I..\BSP -I..\..\..\..\..\uCOS-II\Ports\arm-cortex-m3\Generic\RealView -I..\..\..\..\..\uCOS-II\Source -I..\..\..\..\..\CPU\ST\STM32\inc -I..\..\..\..\..\uC-CPU -I..\..\..\..\..\uC-CPU\Arm-Cortex-M3\RealView -I..\..\..\..\..\uC-LIB -I..\..\..\..\..\uC-Probe\Target\Plugins\uCOS-II -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\Source -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Ports\ST\STM32 -I..\..\..\..\..\uC-Probe\Target\Communication\Generic\RS-232\Source -I..\..\..\..\..\User\inc -I..\..\..\..\..\uCGUI\Config -I..\..\..\..\..\uCGUI\GUIDemo -I..\..\..\..\..\uCGUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\AntiAlias -I..\..\..\..\..\uCGUI\GUI\ConvertColor -I..\..\..\..\..\uCGUI\GUI\ConvertMono -I..\..\..\..\..\uCGUI\GUI\Core -I..\..\..\..\..\uCGUI\GUI\Font -I..\..\..\..\..\uCGUI\GUI\LCDDriver -I..\..\..\..\..\uCGUI\GUI\MemDev -I..\..\..\..\..\uCGUI\GUI\MultiLayer -I..\..\..\..\..\uCGUI\GUI\Widget -I..\..\..\..\..\uCGUI\GUI\WM -Id:\Keil-stm32\ARM\INC -Id:\Keil-stm32\ARM\INC\ST\STM32F10x -D__MICROLIB --omf_browse=.\rvmdk\messagebox.crf ..\..\..\..\..\uCGUI\GUI\Widget\MESSAGEBOX.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  MESSAGEBOX_Callback PROC
;;;65     */
;;;66     void MESSAGEBOX_Callback(WM_MESSAGE * pMsg) {
000000  b570              PUSH     {r4-r6,lr}
;;;67       WM_HWIN hWin = pMsg->hWin;
000002  f9b05004          LDRSH    r5,[r0,#4]
;;;68       switch (pMsg->MsgId) {
000006  6801              LDR      r1,[r0,#0]
000008  290e              CMP      r1,#0xe
00000a  d00e              BEQ      |L1.42|
00000c  291d              CMP      r1,#0x1d
00000e  d005              BEQ      |L1.28|
000010  2926              CMP      r1,#0x26
000012  d01f              BEQ      |L1.84|
;;;69         case WM_INIT_DIALOG:
;;;70           FRAMEWIN_SetClientColor(hWin, MESSAGEBOX_BKCOLOR);
;;;71           break;
;;;72         case WM_KEY:
;;;73           {
;;;74             int Key = ((const WM_KEY_INFO*)(pMsg->Data.p))->Key;
;;;75             if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt) {
;;;76               switch (Key) {
;;;77               case GUI_KEY_ESCAPE:
;;;78                 GUI_EndDialog(hWin, 1);             /* End dialog with return value 1 if <ESC> is pressed */
;;;79                 break;
;;;80               case GUI_KEY_ENTER:
;;;81                 GUI_EndDialog(hWin, 0);             /* End dialog with return value 0 if <ENTER> is pressed */
;;;82                 break;
;;;83               }
;;;84             }
;;;85           }
;;;86           break;
;;;87         case WM_NOTIFY_PARENT:
;;;88           {
;;;89             int NCode = pMsg->Data.v;             /* Get notification code */
;;;90             int Id    = WM_GetId(pMsg->hWinSrc);  /* Get control ID */
;;;91             switch (NCode) {
;;;92               case WM_NOTIFICATION_RELEASED:      /* React only if released */
;;;93                 if (Id == GUI_ID_OK) {
;;;94                   GUI_EndDialog(hWin, 0);         /* End dialog with return value 0 if OK */
;;;95                 }
;;;96                 break;
;;;97             }
;;;98           }
;;;99           break;
;;;100        default:
;;;101          WM_DefaultProc(pMsg);
000014  e8bd4070          POP      {r4-r6,lr}
000018  f7ffbffe          B.W      WM_DefaultProc
                  |L1.28|
00001c  4628              MOV      r0,r5                 ;70
00001e  e8bd4070          POP      {r4-r6,lr}            ;70
000022  f06f417f          MVN      r1,#0xff000000        ;70
000026  f7ffbffe          B.W      FRAMEWIN_SetClientColor
                  |L1.42|
00002a  6880              LDR      r0,[r0,#8]            ;74
00002c  6801              LDR      r1,[r0,#0]            ;74
00002e  6840              LDR      r0,[r0,#4]            ;75
000030  2800              CMP      r0,#0                 ;75
000032  d01e              BEQ      |L1.114|
000034  290d              CMP      r1,#0xd               ;76
000036  d007              BEQ      |L1.72|
000038  291b              CMP      r1,#0x1b              ;76
00003a  d11a              BNE      |L1.114|
00003c  4628              MOV      r0,r5                 ;78
00003e  e8bd4070          POP      {r4-r6,lr}            ;78
000042  2101              MOVS     r1,#1                 ;78
000044  f7ffbffe          B.W      GUI_EndDialog
                  |L1.72|
000048  4628              MOV      r0,r5                 ;81
00004a  e8bd4070          POP      {r4-r6,lr}            ;81
00004e  2100              MOVS     r1,#0                 ;81
000050  f7ffbffe          B.W      GUI_EndDialog
                  |L1.84|
000054  6884              LDR      r4,[r0,#8]            ;89
000056  f9b00006          LDRSH    r0,[r0,#6]            ;90
00005a  f7fffffe          BL       WM_GetId
00005e  2c02              CMP      r4,#2                 ;91
000060  d107              BNE      |L1.114|
000062  2801              CMP      r0,#1                 ;93
000064  d105              BNE      |L1.114|
000066  4628              MOV      r0,r5                 ;94
000068  e8bd4070          POP      {r4-r6,lr}            ;94
00006c  2100              MOVS     r1,#0                 ;94
00006e  f7ffbffe          B.W      GUI_EndDialog
                  |L1.114|
;;;102      }
;;;103    }
000072  bd70              POP      {r4-r6,pc}
;;;104    
                          ENDP

                  MESSAGEBOX_Create PROC
;;;108    */
;;;109    WM_HWIN MESSAGEBOX_Create(const char * sMessage, const char * sCaption, int Flags) {
000074  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
000078  b098              SUB      sp,sp,#0x60
00007a  4691              MOV      r9,r2
;;;110      GUI_WIDGET_CREATE_INFO _aDialogCreate[3];                                     /* 0: FrameWin, 1: Text, 2: Button */
;;;111      int BorderSize = FRAMEWIN_GetDefaultBorderSize();                             /* Default border size of frame window */
00007c  f7fffffe          BL       FRAMEWIN_GetDefaultBorderSize
000080  4607              MOV      r7,r0
;;;112      int xSizeFrame = MESSAGEBOX_XSIZEOK + 2 * BorderSize + MESSAGEBOX_BORDER * 2; /* XSize of frame window */
000082  203a              MOVS     r0,#0x3a
000084  eb000447          ADD      r4,r0,r7,LSL #1
;;;113      int ySizeFrame;                                                               /* YSize of frame window */
;;;114      int x0, y0;                                                                   /* Position of frame window */
;;;115      int xSizeMessage;                                                             /* Length in pixels of message */
;;;116      int xSizeCaption;                                                             /* Length in pixels of caption */
;;;117      int ySizeCaption;                                                             /* YSize of caption */
;;;118      int ySizeMessage;                                                             /* YSize of message */
;;;119      WM_HWIN hBox;
;;;120      GUI_RECT Rect;
;;;121      const GUI_FONT GUI_UNI_PTR * pOldFont;
;;;122      /* Zeroinit variables */
;;;123      memset(_aDialogCreate, 0, sizeof(_aDialogCreate));
000088  2148              MOVS     r1,#0x48
00008a  a806              ADD      r0,sp,#0x18
00008c  f7fffffe          BL       __aeabi_memclr4
;;;124      /* Get dimension of message */
;;;125      pOldFont = GUI_SetFont(TEXT_GetDefaultFont());
000090  f7fffffe          BL       TEXT_GetDefaultFont
000094  f7fffffe          BL       GUI_SetFont
000098  9003              STR      r0,[sp,#0xc]
;;;126      GUI_GetTextExtend(&Rect, sMessage, 255);
00009a  22ff              MOVS     r2,#0xff
00009c  a804              ADD      r0,sp,#0x10
00009e  9918              LDR      r1,[sp,#0x60]
0000a0  f7fffffe          BL       GUI_GetTextExtend
;;;127      xSizeMessage = Rect.x1 - Rect.x0 + MESSAGEBOX_BORDER * 2;
0000a4  f9bd0014          LDRSH    r0,[sp,#0x14]
0000a8  f9bd1010          LDRSH    r1,[sp,#0x10]
0000ac  1a40              SUBS     r0,r0,r1
0000ae  f1000508          ADD      r5,r0,#8
;;;128      ySizeMessage = Rect.y1 - Rect.y0 + 1;
0000b2  f9bd0016          LDRSH    r0,[sp,#0x16]
0000b6  f9bd1012          LDRSH    r1,[sp,#0x12]
0000ba  1a40              SUBS     r0,r0,r1
0000bc  f1000801          ADD      r8,r0,#1
;;;129      if (xSizeFrame < (xSizeMessage + 4 + MESSAGEBOX_BORDER * 2)) {
0000c0  f105000c          ADD      r0,r5,#0xc
0000c4  4284              CMP      r4,r0
0000c6  da00              BGE      |L1.202|
;;;130        xSizeFrame = xSizeMessage + 4 + MESSAGEBOX_BORDER * 2;
0000c8  4604              MOV      r4,r0
                  |L1.202|
;;;131      }
;;;132      ySizeCaption = GUI_GetYSizeOfFont(FRAMEWIN_GetDefaultFont());
0000ca  f7fffffe          BL       FRAMEWIN_GetDefaultFont
0000ce  f7fffffe          BL       GUI_GetYSizeOfFont
;;;133      ySizeFrame = ySizeMessage +            /* size of message */
0000d2  4440              ADD      r0,r0,r8
0000d4  eb000047          ADD      r0,r0,r7,LSL #1
0000d8  f1000621          ADD      r6,r0,#0x21
;;;134                   MESSAGEBOX_YSIZEOK +      /* size of button */
;;;135                   ySizeCaption +            /* caption size */
;;;136                   MESSAGEBOX_BORDER * 3 +   /* inner border - text, text - button, button - bottom */
;;;137                   BorderSize * 2 +          /* top & bottom border */
;;;138                   1;                        /* inner border */
;;;139      /* Get xsize of caption */
;;;140      xSizeCaption = GUI_GetStringDistX(sCaption);
0000dc  9819              LDR      r0,[sp,#0x64]
0000de  f7fffffe          BL       GUI_GetStringDistX
;;;141      if (xSizeFrame < xSizeCaption + BorderSize * 2) {
0000e2  eb000047          ADD      r0,r0,r7,LSL #1
0000e6  42a0              CMP      r0,r4
0000e8  dd00              BLE      |L1.236|
;;;142        xSizeFrame = xSizeCaption + BorderSize * 2;
0000ea  4604              MOV      r4,r0
                  |L1.236|
;;;143      }
;;;144      /* Check maximum */
;;;145      if (xSizeFrame > LCD_GET_XSIZE()) {
0000ec  f7fffffe          BL       LCD_GetXSize
0000f0  42a0              CMP      r0,r4
0000f2  da02              BGE      |L1.250|
;;;146        xSizeFrame = LCD_GET_XSIZE();
0000f4  f7fffffe          BL       LCD_GetXSize
0000f8  4604              MOV      r4,r0
                  |L1.250|
;;;147      }
;;;148      if (ySizeFrame > LCD_GET_YSIZE()) {
0000fa  f7fffffe          BL       LCD_GetYSize
0000fe  42b0              CMP      r0,r6
000100  da02              BGE      |L1.264|
;;;149        ySizeFrame = LCD_GET_YSIZE();
000102  f7fffffe          BL       LCD_GetYSize
000106  4606              MOV      r6,r0
                  |L1.264|
;;;150      }
;;;151      /* Calculate position of framewin */
;;;152      x0 = GUI_OrgX + (LCD_GET_XSIZE() - xSizeFrame) / 2;
000108  f7fffffe          BL       LCD_GetXSize
00010c  4937              LDR      r1,|L1.492|
00010e  1b00              SUBS     r0,r0,r4
000110  eb0070d0          ADD      r0,r0,r0,LSR #31
000114  8809              LDRH     r1,[r1,#0]  ; GUI_OrgX
000116  eb010a60          ADD      r10,r1,r0,ASR #1
;;;153      y0 = GUI_OrgY + (LCD_GET_YSIZE() - ySizeFrame) / 2;
00011a  f7fffffe          BL       LCD_GetYSize
00011e  4934              LDR      r1,|L1.496|
000120  1b80              SUBS     r0,r0,r6
000122  eb0070d0          ADD      r0,r0,r0,LSR #31
000126  8809              LDRH     r1,[r1,#0]  ; GUI_OrgY
000128  eb010b60          ADD      r11,r1,r0,ASR #1
;;;154      /* restore modified Context */
;;;155      GUI_SetFont(pOldFont);
00012c  9803              LDR      r0,[sp,#0xc]
00012e  f7fffffe          BL       GUI_SetFont
;;;156      /* Fill frame win resource */
;;;157      _aDialogCreate[0].pfCreateIndirect = FRAMEWIN_CreateIndirect;
000132  4830              LDR      r0,|L1.500|
000134  9006              STR      r0,[sp,#0x18]
;;;158      _aDialogCreate[0].pName            = sCaption;
000136  9819              LDR      r0,[sp,#0x64]
000138  9007              STR      r0,[sp,#0x1c]
;;;159      _aDialogCreate[0].x0               = x0;
00013a  f8ada022          STRH     r10,[sp,#0x22]
;;;160      _aDialogCreate[0].y0               = y0;
00013e  f8adb024          STRH     r11,[sp,#0x24]
;;;161      _aDialogCreate[0].xSize            = xSizeFrame;
000142  f8ad4026          STRH     r4,[sp,#0x26]
;;;162      _aDialogCreate[0].ySize            = ySizeFrame;
000146  f8ad6028          STRH     r6,[sp,#0x28]
;;;163      if (Flags & GUI_MESSAGEBOX_CF_MOVEABLE) {
00014a  f0190f01          TST      r9,#1
00014e  d002              BEQ      |L1.342|
;;;164        _aDialogCreate[0].Flags          = FRAMEWIN_CF_MOVEABLE;
000150  2010              MOVS     r0,#0x10
000152  f8ad002a          STRH     r0,[sp,#0x2a]
                  |L1.342|
;;;165      }
;;;166      /* Fill text resource */
;;;167      _aDialogCreate[1].pfCreateIndirect = TEXT_CreateIndirect;
000156  4828              LDR      r0,|L1.504|
000158  900c              STR      r0,[sp,#0x30]
;;;168      _aDialogCreate[1].pName            = sMessage;
00015a  9818              LDR      r0,[sp,#0x60]
00015c  900d              STR      r0,[sp,#0x34]
;;;169      _aDialogCreate[1].x0               = (xSizeFrame - xSizeMessage - BorderSize * 2) / 2;
00015e  1b61              SUBS     r1,r4,r5
000160  4278              RSBS     r0,r7,#0
000162  eb010140          ADD      r1,r1,r0,LSL #1
000166  eb0171d1          ADD      r1,r1,r1,LSR #31
00016a  1049              ASRS     r1,r1,#1
00016c  f8ad103a          STRH     r1,[sp,#0x3a]
;;;170      _aDialogCreate[1].y0               = MESSAGEBOX_BORDER;
000170  2104              MOVS     r1,#4
000172  f8ad103c          STRH     r1,[sp,#0x3c]
;;;171      _aDialogCreate[1].xSize            = xSizeMessage;
000176  f8ad503e          STRH     r5,[sp,#0x3e]
;;;172      _aDialogCreate[1].ySize            = ySizeMessage;
00017a  f8ad8040          STRH     r8,[sp,#0x40]
;;;173      _aDialogCreate[1].Para             = GUI_TA_TOP | GUI_TA_HCENTER;
00017e  2102              MOVS     r1,#2
000180  9111              STR      r1,[sp,#0x44]
;;;174      /* Fill button resource */
;;;175      _aDialogCreate[2].pfCreateIndirect = BUTTON_CreateIndirect;
000182  491e              LDR      r1,|L1.508|
000184  9112              STR      r1,[sp,#0x48]
;;;176      _aDialogCreate[2].pName            = "OK";
000186  a11e              ADR      r1,|L1.512|
000188  9113              STR      r1,[sp,#0x4c]
;;;177      _aDialogCreate[2].Id               = GUI_ID_OK;
00018a  2101              MOVS     r1,#1
00018c  f8ad1050          STRH     r1,[sp,#0x50]
;;;178      _aDialogCreate[2].x0               = (xSizeFrame - MESSAGEBOX_XSIZEOK - BorderSize * 2) / 2;
000190  eb040040          ADD      r0,r4,r0,LSL #1
000194  3832              SUBS     r0,r0,#0x32
000196  eb0070d0          ADD      r0,r0,r0,LSR #31
00019a  1040              ASRS     r0,r0,#1
00019c  f8ad0052          STRH     r0,[sp,#0x52]
;;;179      _aDialogCreate[2].y0               = MESSAGEBOX_BORDER * 2 + ySizeMessage;
0001a0  f1080008          ADD      r0,r8,#8
0001a4  f8ad0054          STRH     r0,[sp,#0x54]
;;;180      _aDialogCreate[2].xSize            = MESSAGEBOX_XSIZEOK;
0001a8  2032              MOVS     r0,#0x32
0001aa  f8ad0056          STRH     r0,[sp,#0x56]
;;;181      _aDialogCreate[2].ySize            = MESSAGEBOX_YSIZEOK;
0001ae  2014              MOVS     r0,#0x14
0001b0  f8ad0058          STRH     r0,[sp,#0x58]
;;;182      /* Create dialog */
;;;183      hBox = GUI_CreateDialogBox(_aDialogCreate, GUI_COUNTOF(_aDialogCreate), MESSAGEBOX_Callback, 0, 0, 0);
0001b4  2300              MOVS     r3,#0
0001b6  9300              STR      r3,[sp,#0]
0001b8  f2af12bb          ADR      r2,MESSAGEBOX_Callback + 1
0001bc  2103              MOVS     r1,#3
0001be  a806              ADD      r0,sp,#0x18
0001c0  9301              STR      r3,[sp,#4]
0001c2  f7fffffe          BL       GUI_CreateDialogBox
0001c6  4604              MOV      r4,r0
;;;184      if (Flags & GUI_MESSAGEBOX_CF_MODAL) {
0001c8  f0190f02          TST      r9,#2
0001cc  d002              BEQ      |L1.468|
;;;185        WM_MakeModal(hBox);
0001ce  4620              MOV      r0,r4
0001d0  f7fffffe          BL       WM_MakeModal
                  |L1.468|
;;;186      }
;;;187      return hBox;
;;;188    }
0001d4  b01b              ADD      sp,sp,#0x6c
0001d6  4620              MOV      r0,r4                 ;187
0001d8  e8bd8ff0          POP      {r4-r11,pc}
;;;189    
                          ENDP

                  GUI_MessageBox PROC
;;;193    */
;;;194    int GUI_MessageBox(const char * sMessage, const char * sCaption, int Flags) {
0001dc  b510              PUSH     {r4,lr}
;;;195      WM_HWIN hWin;
;;;196      hWin = MESSAGEBOX_Create(sMessage, sCaption, Flags);
0001de  f7fffffe          BL       MESSAGEBOX_Create
;;;197      /* Exec dialog */
;;;198      return GUI_ExecCreatedDialog(hWin);
0001e2  e8bd4010          POP      {r4,lr}
0001e6  f7ffbffe          B.W      GUI_ExecCreatedDialog
;;;199    }
;;;200    
                          ENDP

0001ea  0000              DCW      0x0000
                  |L1.492|
                          DCD      GUI_OrgX
                  |L1.496|
                          DCD      GUI_OrgY
                  |L1.500|
                          DCD      FRAMEWIN_CreateIndirect
                  |L1.504|
                          DCD      TEXT_CreateIndirect
                  |L1.508|
                          DCD      BUTTON_CreateIndirect
                  |L1.512|
000200  4f4b00            DCB      "OK",0
000203  00                DCB      0
